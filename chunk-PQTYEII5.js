import{a as ae}from"./chunk-7UL3RCZW.js";import{a as _e}from"./chunk-YC3E622U.js";import{a as de}from"./chunk-M5EXVPEQ.js";import{a as he}from"./chunk-O2VZXNLJ.js";import"./chunk-E7WCFS4V.js";import{a as ue,b as fe}from"./chunk-QPRLUAWP.js";import{b as se,d as ce,e as le,f as pe,h as me,j as B}from"./chunk-OZBYPAFL.js";import{b as V}from"./chunk-V5VFZZ6S.js";import{a as O}from"./chunk-QMSCXWF6.js";import{a as R}from"./chunk-HT2TXY4M.js";import{Aa as G,Ca as k,Ea as z,Ja as L,Ka as A,Q as y,R as re,S as I,ma as E,oa as T,qa as M,ra as D,ta as j,va as F,ya as Q,za as N}from"./chunk-RBHTY4FE.js";import"./chunk-4N6BO7AP.js";import{h as ie,l as oe,p as ne}from"./chunk-KCCSOALX.js";import{Aa as m,Ba as d,Bb as f,Hb as _,Ia as q,Jb as W,Kb as Y,Lb as r,Mb as a,Nb as x,Rb as b,Ub as h,Wb as c,_b as Z,bb as X,ed as te,fb as s,gb as g,gc as p,hc as ee,ic as v,ja as J,oc as P,sa as S,ta as K,xb as u}from"./chunk-QNTGE4BG.js";var ge=(i,n)=>n.id;function ve(i,n){if(i&1){let o=b();r(0,"button",14),h("click",function(){m(o);let t=c(2);return d(t.changeSpeciesEditableState())}),r(1,"mat-icon"),p(2,"lock_open"),a()()}}function Pe(i,n){if(i&1){let o=b();r(0,"button",14),h("click",function(){m(o);let t=c(2);return d(t.changeSpeciesEditableState())}),r(1,"mat-icon"),p(2,"lock"),a()()}}function ye(i,n){if(i&1&&(r(0,"mat-list-option",16),p(1),a()),i&2){let o=n.$implicit;f("value",o),s(),v(" ",o.official_name," ")}}function Ie(i,n){if(i&1&&(r(0,"mat-selection-list",15),W(1,ye,2,2,"mat-list-option",16,ge),a()),i&2){let o=c(3);f("multiple",!1),s(),Y(o.speciesQuery.results)}}function Ve(i,n){if(i&1&&u(0,Ie,3,1,"mat-selection-list",15),i&2){let o=c(2);_(o.speciesQuery.results.length>0?0:-1)}}function Ee(i,n){if(i&1&&(r(0,"mat-list-item")(1,"a",18),p(2),a(),x(3,"hr"),a()),i&2){let o=n.$implicit;s(),Z("href","/#/analysis-group/",o.id,"",X),s(),ee(o.name)}}function Te(i,n){if(i&1&&(r(0,"mat-list"),W(1,Ee,4,3,"mat-list-item",null,ge),a()),i&2){let o=c(3);s(),Y(o.analysisGroupQuery.results)}}function Me(i,n){i&1&&(r(0,"p"),p(1,"No analysis groups found."),a())}function De(i,n){if(i&1){let o=b();r(0,"div",13)(1,"p"),p(2,"Associated Analysis Group"),a(),u(3,Te,3,0,"mat-list")(4,Me,2,0,"p"),r(5,"mat-paginator",17,0),h("page",function(t){m(o);let l=c(2);return d(l.handlePageChange(t))}),a()()}if(i&2){let o=c(2);s(3),_(o.analysisGroupQuery.results.length>0?3:4),s(2),f("length",o.analysisGroupQuery.count)("pageSize",o.pageSize)("showFirstLastButtons",!0)("hidePageSize",!0)("pageIndex",o.currentPage)}}function Fe(i,n){if(i&1){let o=b();r(0,"form",3),h("ngSubmit",function(){m(o);let t=c();return d(t.updateProject())}),r(1,"mat-form-field",2),x(2,"input",4),r(3,"mat-label"),p(4,"Project Name"),a()(),r(5,"mat-form-field",2),x(6,"textarea",5),r(7,"mat-label"),p(8,"Project Description"),a()(),r(9,"div",6)(10,"mat-form-field",2),x(11,"input",7),r(12,"mat-label"),p(13,"Species Name Search"),a()(),u(14,ve,3,0,"button",8)(15,Pe,3,0,"button",8),a(),u(16,Ve,1,1),r(17,"div",9)(18,"button",10),p(19,"Update"),a(),r(20,"button",11),h("click",function(){m(o);let t=c();return d(t.openAnalysisGroupCreateModal())}),r(21,"mat-icon"),p(22,"add"),a(),p(23," Analysis Group"),a(),r(24,"button",12),h("click",function(){m(o);let t=c();return d(t.deleteProject())}),p(25,"Delete"),a()()(),u(26,De,7,6,"div",13)}if(i&2){let o=c();f("formGroup",o.form),s(14),_(o.speciesEditable?14:15),s(2),_(o.speciesQuery&&o.speciesEditable?16:-1),s(2),f("disabled",!o.accounts.loggedIn),s(2),f("disabled",!o.accounts.loggedIn),s(4),f("disabled",!o.accounts.loggedIn),s(2),_(o.analysisGroupQuery?26:-1)}}var be=(()=>{let n=class n{set project(e){this._project=e,e&&(this.titleService.setTitle(`Project - ${e.name}`),this.form.controls.name.setValue(e.name),this.form.controls.description.setValue(e.description),this.web.getAnalysisGroups(void 0,this.pageSize,0,void 0,e.id).subscribe(t=>{this.analysisGroupQuery=t}),e.species&&(console.log(e.species),this.web.getSpeciesByID(e.species).subscribe(t=>{this.form.controls.species_name.enable(),this.form.controls.species.enable(),this.form.controls.species_name.setValue(t.official_name),this.form.controls.species.setValue([t]),this.form.controls.species.disable(),this.form.controls.species_name.disable(),this.speciesEditable=!1})))}get project(){return this._project}constructor(e,t,l,w,$){this.titleService=e,this.fb=t,this.web=l,this.dialog=w,this.accounts=$,this.speciesEditable=!1,this.form=this.fb.group({name:new j({value:"",disabled:!this.accounts.loggedIn},T.required),description:new j({value:"",disabled:!this.accounts.loggedIn},T.required),species_name:new j({value:"",disabled:!this.accounts.loggedIn||!this.speciesEditable}),species:new j({value:null,disabled:!this.accounts.loggedIn},T.required)}),this.deleted=new q,this.updated=new q,this.pageSize=10,this.currentPage=0,this.form.controls.species_name.valueChanges.subscribe(C=>{C&&this.web.getSpecies(void 0,20,0,C).subscribe(U=>{this.speciesQuery=U})}),this.form.controls.species.valueChanges.subscribe(C=>{C&&this.form.controls.species_name.setValue(C[0].official_name)})}updateProject(){this.form.invalid||(this.form.value.species?this.web.updateProject(this.project.id,this.form.value.name,this.form.value.description,this.form.value.species[0].id).subscribe(e=>{this.project=e,this.updated.emit(e)}):this.web.updateProject(this.project.id,this.form.value.name,this.form.value.description).subscribe(e=>{this.project=e,this.updated.emit(e)}))}deleteProject(){this.dialog.open(he).afterClosed().subscribe(e=>{e&&this.web.deleteProject(this.project.id).subscribe(()=>{this.project=void 0,this.deleted.emit(!0)})})}openAnalysisGroupCreateModal(){let e=this.dialog.open(de);e.componentInstance.project=this.project,e.afterClosed().subscribe(t=>{t&&window.open(`/#/analysis-group/${t.id}`,"_blank")})}handlePageChange(e){let t=e.pageIndex*e.pageSize;this.currentPage=e.pageIndex,this.web.getAnalysisGroups(void 0,e.pageSize,t,void 0,this.project.id).subscribe(l=>{this.analysisGroupQuery=l})}changeSpeciesEditableState(){this.speciesEditable=!this.speciesEditable,this.speciesEditable?(this.form.controls.species.enable(),this.form.controls.species_name.enable()):(this.form.controls.species.disable(),this.form.controls.species_name.disable())}};n.\u0275fac=function(t){return new(t||n)(g(ie),g(G),g(O),g(V),g(R))},n.\u0275cmp=S({type:n,selectors:[["app-project-view"]],inputs:{project:"project"},outputs:{deleted:"deleted",updated:"updated"},standalone:!0,features:[P],decls:3,vars:1,consts:[["paginator",""],[2,"display","flex","flex-direction","row","justify-content","center","padding","50px"],[2,"width","100%"],[2,"display","flex","flex-direction","column","gap","20px",3,"ngSubmit","formGroup"],["matInput","","formControlName","name","type","text","placeholder","Project Name"],["matInput","","formControlName","description","placeholder","Project Description"],[2,"display","flex","flex-direction","row","gap","10px","align-items","center"],["matInput","","formControlName","species_name","placeholder","Species Name","type","search"],["mat-icon-button",""],[2,"display","flex","flex-direction","row","gap","20px"],["mat-flat-button","","color","primary","type","submit",3,"disabled"],["mat-flat-button","","color","accent",3,"click","disabled"],["mat-flat-button","","color","warn",3,"click","disabled"],[2,"padding","20px"],["mat-icon-button","",3,"click"],["formControlName","species",2,"max-height","200px","overflow","auto",3,"multiple"],[3,"value"],["aria-label","Select page",3,"page","length","pageSize","showFirstLastButtons","hidePageSize","pageIndex"],["matListItemTitle","","target","_blank",3,"href"]],template:function(t,l){t&1&&(r(0,"div",1)(1,"div",2),u(2,Fe,27,7),a()()),t&2&&(s(2),_(l.project?2:-1))},dependencies:[k,F,E,M,D,Q,N,L,A,z,re,y,ce,le,B,se,me,pe,I]});let i=n;return i})();function Qe(i,n){if(i&1){let o=b();r(0,"div",12)(1,"app-project-list",13),h("projectSelected",function(t){m(o);let l=c(3);return d(l.handleProjectSelect(t))}),a()(),r(2,"mat-paginator",14,0),h("page",function(t){m(o);let l=c(3);return d(l.handlePageEvent(t))}),a()}if(i&2){let o=c(3);s(),f("projectQuery",o.projectQuery),s(),f("length",o.projectQuery.count)("pageSize",o.limit)("showFirstLastButtons",!0)("hidePageSize",!0)("pageIndex",o.pageIndex)}}function Ne(i,n){i&1&&(r(0,"p"),p(1,"No projects found."),a())}function Ge(i,n){if(i&1&&u(0,Qe,4,6)(1,Ne,2,0,"p"),i&2){let o=c(2);_(o.projectQuery.count>0?0:1)}}function ke(i,n){if(i&1){let o=b();r(0,"div",2)(1,"mat-toolbar")(2,"mat-toolbar-row")(3,"span"),p(4,"Project"),a(),r(5,"button",5),h("click",function(){m(o);let t=c();return d(t.openCreateProjectDialog())}),r(6,"mat-icon"),p(7,"create_new_folder"),a()()()(),r(8,"div",8)(9,"form",9)(10,"mat-form-field",10),x(11,"input",11),r(12,"mat-label"),p(13,"Search Project"),a()()(),u(14,Ge,2,1),a()()}if(i&2){let o=c();s(9),f("formGroup",o.form),s(5),_(o.projectQuery?14:-1)}}function ze(i,n){if(i&1&&p(0),i&2){let o=c();v(" ",o.selectedProject.name," ")}}function Le(i,n){i&1&&p(0," Select Project ")}function Ae(i,n){if(i&1){let o=b();r(0,"app-project-view",15),h("deleted",function(){m(o);let t=c();return d(t.refreshData())})("updated",function(t){m(o);let l=c();return d(l.handleUpdateData(t))}),a()}if(i&2){let o=c();f("project",o.selectedProject)}}var H=(()=>{let n=class n{set projectID(e){this._projectID=e,e&&this.web.getProject(e).subscribe(t=>{this.selectedProject=t})}get projectID(){return this._projectID}constructor(e,t,l,w,$){this.router=e,this.web=t,this.dialog=l,this.fb=w,this.accounts=$,this.sidebarOpen=!0,this.pageIndex=0,this.limit=15,this.offset=0,this.form=this.fb.group({name:new j}),this.web.getProjects(void 0,this.limit,this.offset).subscribe(C=>{this.projectQuery=C}),this.form.controls.name.valueChanges.subscribe(C=>{C&&this.web.getProjects(void 0,this.limit,this.offset,C).subscribe(U=>{this.projectQuery=U})}),this.web.updateFromLabGroupSelection.subscribe(C=>{C&&this.refreshData()})}openCreateProjectDialog(){this.dialog.open(ae).afterClosed().subscribe(t=>{t&&this.accounts.loggedIn&&this.web.createProject(t.name,t.description).subscribe(l=>{this.selectedProject=l,this.web.getProjects(void 0,this.limit,this.offset).subscribe(w=>{this.projectQuery=w})})})}handlePageEvent(e){this.offset=e.pageIndex*e.pageSize,this.limit=e.pageSize,this.form.controls.name.value?this.web.getProjects(void 0,this.limit,this.offset,this.form.controls.name.value).subscribe(t=>{this.projectQuery=t}):this.web.getProjects(void 0,this.limit,this.offset).subscribe(t=>{this.projectQuery=t})}handleProjectSelect(e){this.router.navigate(["/project",e.id])}refreshData(){if(this.form.controls.name.value){this.web.getProjects(void 0,this.limit,this.offset,this.form.controls.name.value).subscribe(e=>{this.projectQuery=e});return}this.web.getProjects(void 0,this.limit,this.offset).subscribe(e=>{this.projectQuery=e})}handleUpdateData(e){this.projectQuery.results=this.projectQuery.results.map(t=>t.id===e.id?e:t)}toggleSidePanel(){this.sidebarOpen=!this.sidebarOpen}};n.\u0275fac=function(t){return new(t||n)(g(oe),g(O),g(V),g(G),g(R))},n.\u0275cmp=S({type:n,selectors:[["app-project"]],inputs:{projectID:"projectID"},standalone:!0,features:[P],decls:14,vars:3,consts:[["paginator",""],[2,"display","flex","flex-direction","row"],[1,"project-side-nav"],[1,"project-main-content"],[2,"display","flex","flex-direction","row","justify-content","center","align-items","center"],["mat-icon-button","",3,"click"],[2,"height","calc(100vh - 64px*2 - 20px)","overflow","auto"],[3,"project"],[2,"display","flex","flex-direction","column","padding","5px"],[3,"formGroup"],[2,"width","100%"],["matInput","","formControlName","name","type","search","placeholder","Search Project"],[2,"height","calc(100vh - 64px*4 - 20px)","overflow","auto"],[3,"projectSelected","projectQuery"],["aria-label","Select page",3,"page","length","pageSize","showFirstLastButtons","hidePageSize","pageIndex"],[3,"deleted","updated","project"]],template:function(t,l){t&1&&(r(0,"div",1),u(1,ke,15,2,"div",2),r(2,"div",3)(3,"mat-toolbar")(4,"mat-toolbar-row")(5,"div",4)(6,"button",5),h("click",function(){return l.toggleSidePanel()}),r(7,"mat-icon"),p(8,"menu"),a()(),r(9,"span"),u(10,ze,1,1)(11,Le,1,0),a()()()(),r(12,"div",6),u(13,Ae,1,1,"app-project-view",7),a()()()),t&2&&(s(),_(l.sidebarOpen?1:-1),s(9),_(l.selectedProject?10:11),s(3),_(l.selectedProject?13:-1))},dependencies:[fe,ue,I,y,_e,k,F,E,M,D,Q,N,L,A,z,B,be],styles:[".project-side-nav[_ngcontent-%COMP%]{width:300px;border-right:1px solid #000000;display:flex;flex-direction:column;height:calc(100vh - 64px)}.project-main-content[_ngcontent-%COMP%]{flex:1}"]});let i=n;return i})();var Be=[{path:"",component:H},{path:":projectID",component:H}],gt=(()=>{let n=class n{};n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=K({type:n}),n.\u0275inj=J({imports:[te,ne.forChild(Be)]});let i=n;return i})();export{gt as ProjectModule};
