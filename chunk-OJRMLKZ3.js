import{a as se}from"./chunk-W7TZ24ZB.js";import{a as he}from"./chunk-BUZBHT4J.js";import{a as ue}from"./chunk-VR42HVXH.js";import{a as Ce}from"./chunk-OI7TM5YO.js";import"./chunk-E7WCFS4V.js";import{a as fe,b as _e}from"./chunk-GFOHTBHX.js";import{a as ce,c as le,d as pe,e as me,g as de}from"./chunk-HFZSANZE.js";import{c as B}from"./chunk-IAQYASUB.js";import{c as V,g as R}from"./chunk-NIVJTLF2.js";import{Aa as G,Ca as k,Ea as z,Ga as ae,Ja as L,Ka as A,Ma as O,Q as y,R as re,S as I,ma as E,oa as T,qa as M,ra as D,ta as j,va as F,ya as Q,za as N}from"./chunk-KVGTURXN.js";import"./chunk-4N6BO7AP.js";import{h as ie,l as oe,p as ne}from"./chunk-KCCSOALX.js";import{Aa as f,Ba as _,Bb as g,Hb as d,Ia as q,Jb as W,Kb as Y,Lb as r,Mb as a,Nb as b,Rb as x,Ub as C,Wb as l,_b as Z,bb as X,ed as te,fb as c,gb as h,gc as p,hc as ee,ic as P,ja as J,oc as v,sa as S,ta as K,xb as m}from"./chunk-QNTGE4BG.js";var xe=(t,n)=>n.id;function ve(t,n){t&1&&(r(0,"mat-icon"),p(1,"lock_open"),a())}function ye(t,n){t&1&&(r(0,"mat-icon"),p(1,"lock"),a())}function Ie(t,n){if(t&1&&(r(0,"mat-list-option",12),p(1),a()),t&2){let o=n.$implicit;g("value",o),c(),P(" ",o.official_name," ")}}function Ve(t,n){if(t&1&&(r(0,"mat-selection-list",11),W(1,Ie,2,2,"mat-list-option",12,xe),a()),t&2){let o=l(3);g("multiple",!1),c(),Y(o.speciesQuery.results)}}function Ee(t,n){if(t&1&&m(0,Ve,3,1,"mat-selection-list",11),t&2){let o=l(2);d(o.speciesQuery.results.length>0?0:-1)}}function Te(t,n){if(t&1){let o=x();r(0,"button",13),C("click",function(){f(o);let i=l(2);return _(i.openAnalysisGroupCreateModal())}),r(1,"mat-icon"),p(2,"add"),a(),p(3," Analysis Group"),a(),r(4,"button",14),C("click",function(){f(o);let i=l(2);return _(i.deleteProject())}),p(5,"Delete"),a()}}function Me(t,n){if(t&1&&(r(0,"mat-list-item")(1,"a",16),p(2),a(),b(3,"hr"),a()),t&2){let o=n.$implicit;c(),Z("href","/#/analysis-group/",o.id,"",X),c(),ee(o.name)}}function De(t,n){if(t&1&&(r(0,"mat-list"),W(1,Me,4,3,"mat-list-item",null,xe),a()),t&2){let o=l(3);c(),Y(o.analysisGroupQuery.results)}}function Fe(t,n){t&1&&(r(0,"p"),p(1,"No analysis groups found."),a())}function Qe(t,n){if(t&1){let o=x();r(0,"div",10)(1,"p"),p(2,"Associated Analysis Group"),a(),m(3,De,3,0,"mat-list")(4,Fe,2,0,"p"),r(5,"mat-paginator",15,0),C("page",function(i){f(o);let s=l(2);return _(s.handlePageChange(i))}),a()()}if(t&2){let o=l(2);c(3),d(o.analysisGroupQuery.results.length>0?3:4),c(2),g("length",o.analysisGroupQuery.count)("pageSize",o.pageSize)("showFirstLastButtons",!0)("hidePageSize",!0)("pageIndex",o.currentPage)}}function Ne(t,n){if(t&1){let o=x();r(0,"form",3),C("ngSubmit",function(){f(o);let i=l();return _(i.updateProject())}),r(1,"mat-form-field",2),b(2,"input",4),r(3,"mat-label"),p(4,"Project Name"),a()(),r(5,"mat-form-field",2),b(6,"textarea",5),r(7,"mat-label"),p(8,"Project Description"),a()(),r(9,"mat-form-field",2),b(10,"input",6),r(11,"mat-label"),p(12,"Species Name Search"),a(),r(13,"button",7),C("click",function(){f(o);let i=l();return _(i.changeSpeciesEditableState())}),m(14,ve,2,0,"mat-icon")(15,ye,2,0,"mat-icon"),a()(),m(16,Ee,1,1),r(17,"div",8)(18,"button",9),p(19,"Update"),a(),m(20,Te,6,0),a()(),m(21,Qe,7,6,"div",10)}if(t&2){let o=l();g("formGroup",o.form),c(14),d(o.speciesEditable?14:15),c(2),d(o.speciesQuery&&o.speciesEditable?16:-1),c(2),g("disabled",!o.canEdit),c(2),d(o.canEdit?20:-1),c(),d(o.analysisGroupQuery?21:-1)}}var be=(()=>{let n=class n{set project(e){this._project=e,e&&(this.accounts.getProjectPermissions(e.id).subscribe(i=>{this.canEdit=i.edit}),this.titleService.setTitle(`Project - ${e.name}`),this.form.controls.name.setValue(e.name),this.form.controls.description.setValue(e.description),this.web.getAnalysisGroups(void 0,this.pageSize,0,void 0,e.id).subscribe(i=>{this.analysisGroupQuery=i}),e.species&&(console.log(e.species),this.web.getSpeciesByID(e.species).subscribe(i=>{this.form.controls.species_name.enable(),this.form.controls.species.enable(),this.form.controls.species_name.setValue(i.official_name),this.form.controls.species.setValue([i]),this.form.controls.species.disable(),this.form.controls.species_name.disable(),this.speciesEditable=!1})))}get project(){return this._project}constructor(e,i,s,w,$){this.titleService=e,this.fb=i,this.web=s,this.dialog=w,this.accounts=$,this.canEdit=!1,this.speciesEditable=!1,this.form=this.fb.group({name:new j({value:"",disabled:!this.accounts.loggedIn},T.required),description:new j({value:"",disabled:!this.accounts.loggedIn},T.required),species_name:new j({value:"",disabled:!this.accounts.loggedIn||!this.speciesEditable}),species:new j({value:null,disabled:!this.accounts.loggedIn},T.required)}),this.deleted=new q,this.updated=new q,this.pageSize=10,this.currentPage=0,this.form.controls.species_name.valueChanges.subscribe(u=>{u&&this.web.getSpecies(void 0,20,0,u).subscribe(U=>{this.speciesQuery=U})}),this.form.controls.species.valueChanges.subscribe(u=>{u&&this.form.controls.species_name.setValue(u[0].official_name)})}updateProject(){this.form.invalid||(this.form.value.species?this.web.updateProject(this.project.id,this.form.value.name,this.form.value.description,this.form.value.species[0].id).subscribe(e=>{this.project=e,this.updated.emit(e)}):this.web.updateProject(this.project.id,this.form.value.name,this.form.value.description).subscribe(e=>{this.project=e,this.updated.emit(e)}))}deleteProject(){this.dialog.open(Ce).afterClosed().subscribe(e=>{e&&this.web.deleteProject(this.project.id).subscribe(()=>{this.project=void 0,this.deleted.emit(!0)})})}openAnalysisGroupCreateModal(){let e=this.dialog.open(ue);e.componentInstance.project=this.project,e.afterClosed().subscribe(i=>{i&&window.open(`/#/analysis-group/${i.id}`,"_blank")})}handlePageChange(e){let i=e.pageIndex*e.pageSize;this.currentPage=e.pageIndex,this.web.getAnalysisGroups(void 0,e.pageSize,i,void 0,this.project.id).subscribe(s=>{this.analysisGroupQuery=s})}changeSpeciesEditableState(){this.speciesEditable=!this.speciesEditable,this.speciesEditable?(this.form.controls.species.enable(),this.form.controls.species_name.enable()):(this.form.controls.species.disable(),this.form.controls.species_name.disable())}};n.\u0275fac=function(i){return new(i||n)(h(ie),h(G),h(O),h(V),h(R))},n.\u0275cmp=S({type:n,selectors:[["app-project-view"]],inputs:{project:"project"},outputs:{deleted:"deleted",updated:"updated"},standalone:!0,features:[v],decls:3,vars:1,consts:[["paginator",""],[2,"display","flex","flex-direction","row","justify-content","center","padding","50px"],[2,"width","100%"],[2,"display","flex","flex-direction","column","gap","20px",3,"ngSubmit","formGroup"],["matInput","","formControlName","name","type","text","placeholder","Project Name"],["matInput","","formControlName","description","placeholder","Project Description"],["matInput","","formControlName","species_name","placeholder","Species Name","type","search"],["mat-icon-button","","matSuffix","",3,"click"],[2,"display","flex","flex-direction","row","gap","20px"],["mat-flat-button","","color","primary","type","submit",3,"disabled"],[2,"padding","20px"],["formControlName","species",2,"max-height","200px","overflow","auto",3,"multiple"],[3,"value"],["mat-flat-button","","color","accent",3,"click"],["mat-flat-button","","color","warn",3,"click"],["aria-label","Select page",3,"page","length","pageSize","showFirstLastButtons","hidePageSize","pageIndex"],["matListItemTitle","","target","_blank",3,"href"]],template:function(i,s){i&1&&(r(0,"div",1)(1,"div",2),m(2,Ne,22,6),a()()),i&2&&(c(2),d(s.project?2:-1))},dependencies:[k,F,E,M,D,Q,N,L,A,z,re,y,le,pe,B,ce,de,me,I,ae]});let t=n;return t})();function Ge(t,n){if(t&1){let o=x();r(0,"div",12)(1,"app-project-list",13),C("projectSelected",function(i){f(o);let s=l(3);return _(s.handleProjectSelect(i))}),a()(),r(2,"mat-paginator",14,0),C("page",function(i){f(o);let s=l(3);return _(s.handlePageEvent(i))}),a()}if(t&2){let o=l(3);c(),g("projectQuery",o.projectQuery),c(),g("length",o.projectQuery.count)("pageSize",o.limit)("showFirstLastButtons",!0)("hidePageSize",!0)("pageIndex",o.pageIndex)}}function ke(t,n){t&1&&(r(0,"p"),p(1,"No projects found."),a())}function ze(t,n){if(t&1&&m(0,Ge,4,6)(1,ke,2,0,"p"),t&2){let o=l(2);d(o.projectQuery.count>0?0:1)}}function Le(t,n){if(t&1){let o=x();r(0,"div",2)(1,"mat-toolbar")(2,"mat-toolbar-row")(3,"span"),p(4,"Project"),a(),r(5,"button",5),C("click",function(){f(o);let i=l();return _(i.openCreateProjectDialog())}),r(6,"mat-icon"),p(7,"create_new_folder"),a()()()(),r(8,"div",8)(9,"form",9)(10,"mat-form-field",10),b(11,"input",11),r(12,"mat-label"),p(13,"Search Project"),a()()(),m(14,ze,2,1),a()()}if(t&2){let o=l();c(9),g("formGroup",o.form),c(5),d(o.projectQuery?14:-1)}}function Ae(t,n){if(t&1&&p(0),t&2){let o=l();P(" ",o.selectedProject.name," ")}}function Be(t,n){t&1&&p(0," Select Project ")}function Oe(t,n){if(t&1){let o=x();r(0,"app-project-view",15),C("deleted",function(){f(o);let i=l();return _(i.refreshData())})("updated",function(i){f(o);let s=l();return _(s.handleUpdateData(i))}),a()}if(t&2){let o=l();g("project",o.selectedProject)}}var H=(()=>{let n=class n{set projectID(e){this._projectID=e,e&&this.web.getProject(e).subscribe(i=>{this.selectedProject=i})}get projectID(){return this._projectID}constructor(e,i,s,w,$){this.router=e,this.web=i,this.dialog=s,this.fb=w,this.accounts=$,this.sidebarOpen=!0,this.pageIndex=0,this.limit=15,this.offset=0,this.form=this.fb.group({name:new j}),this.web.getProjects(void 0,this.limit,this.offset).subscribe(u=>{this.projectQuery=u}),this.form.controls.name.valueChanges.subscribe(u=>{u&&this.web.getProjects(void 0,this.limit,this.offset,u).subscribe(U=>{this.projectQuery=U})}),this.web.updateFromLabGroupSelection.subscribe(u=>{u&&this.refreshData()})}openCreateProjectDialog(){this.dialog.open(se).afterClosed().subscribe(i=>{i&&this.accounts.loggedIn&&this.web.createProject(i.name,i.description).subscribe(s=>{this.selectedProject=s,this.web.getProjects(void 0,this.limit,this.offset).subscribe(w=>{this.projectQuery=w})})})}handlePageEvent(e){this.offset=e.pageIndex*e.pageSize,this.limit=e.pageSize,this.form.controls.name.value?this.web.getProjects(void 0,this.limit,this.offset,this.form.controls.name.value).subscribe(i=>{this.projectQuery=i}):this.web.getProjects(void 0,this.limit,this.offset).subscribe(i=>{this.projectQuery=i})}handleProjectSelect(e){this.router.navigate(["/project",e.id])}refreshData(){if(this.form.controls.name.value){this.web.getProjects(void 0,this.limit,this.offset,this.form.controls.name.value).subscribe(e=>{this.projectQuery=e});return}this.web.getProjects(void 0,this.limit,this.offset).subscribe(e=>{this.projectQuery=e})}handleUpdateData(e){this.projectQuery.results=this.projectQuery.results.map(i=>i.id===e.id?e:i)}toggleSidePanel(){this.sidebarOpen=!this.sidebarOpen}};n.\u0275fac=function(i){return new(i||n)(h(oe),h(O),h(V),h(G),h(R))},n.\u0275cmp=S({type:n,selectors:[["app-project"]],inputs:{projectID:"projectID"},standalone:!0,features:[v],decls:14,vars:3,consts:[["paginator",""],[2,"display","flex","flex-direction","row"],[1,"project-side-nav"],[1,"project-main-content"],[2,"display","flex","flex-direction","row","justify-content","center","align-items","center"],["mat-icon-button","",3,"click"],[2,"height","calc(100vh - 64px*2 - 20px)","overflow","auto"],[3,"project"],[2,"display","flex","flex-direction","column","padding","5px"],[3,"formGroup"],[2,"width","100%"],["matInput","","formControlName","name","type","search","placeholder","Search Project"],[2,"height","calc(100vh - 64px*4 - 20px)","overflow","auto"],[3,"projectSelected","projectQuery"],["aria-label","Select page",3,"page","length","pageSize","showFirstLastButtons","hidePageSize","pageIndex"],[3,"deleted","updated","project"]],template:function(i,s){i&1&&(r(0,"div",1),m(1,Le,15,2,"div",2),r(2,"div",3)(3,"mat-toolbar")(4,"mat-toolbar-row")(5,"div",4)(6,"button",5),C("click",function(){return s.toggleSidePanel()}),r(7,"mat-icon"),p(8,"menu"),a()(),r(9,"span"),m(10,Ae,1,1)(11,Be,1,0),a()()()(),r(12,"div",6),m(13,Oe,1,1,"app-project-view",7),a()()()),i&2&&(c(),d(s.sidebarOpen?1:-1),c(9),d(s.selectedProject?10:11),c(3),d(s.selectedProject?13:-1))},dependencies:[_e,fe,I,y,he,k,F,E,M,D,Q,N,L,A,z,B,be],styles:[".project-side-nav[_ngcontent-%COMP%]{width:300px;border-right:1px solid #000000;display:flex;flex-direction:column;height:calc(100vh - 64px)}.project-main-content[_ngcontent-%COMP%]{flex:1}"]});let t=n;return t})();var Re=[{path:"",component:H},{path:":projectID",component:H}],bt=(()=>{let n=class n{};n.\u0275fac=function(i){return new(i||n)},n.\u0275mod=K({type:n}),n.\u0275inj=J({imports:[te,ne.forChild(Re)]});let t=n;return t})();export{bt as ProjectModule};
