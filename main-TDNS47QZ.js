import{a as Ze}from"./chunk-5FZDEB73.js";import{a as Qe,b as Xe,c as Ke,d as Ye}from"./chunk-YE4PZOJH.js";import{a as Ee}from"./chunk-I7KSBDRZ.js";import{a as Ne,b as Fe,c as Re}from"./chunk-ON4LJNYO.js";import{a as Ue,b as Ve,c as je,d as Pe,e as Be,f as Oe,g as We,h as He,i as $e,j as ze}from"./chunk-LE3F4ORG.js";import{a as Y}from"./chunk-DZJ2KETN.js";import{a as L,c as Ge,d as I,e as T,f as G,g as y}from"./chunk-NPOKFU2J.js";import{Ba as F,Ca as R,Da as U,Fa as V,Ha as j,Ja as ke,Ma as P,Na as B,Qa as Ae,Sa as _,V as X,W as D,X as K,pa as k,ra as $,ta as A,ua as E,wa as J,ya as N}from"./chunk-G4XN575R.js";import"./chunk-3CIC7QKD.js";import{d as Se,e as ve,f as xe,g as we,j as De,k as ye,l as Me,m as Le,n as Ie,o as Te}from"./chunk-OTVSX5VU.js";import{Ba as le,Bc as _e,Eb as f,Fa as ce,Kb as h,Mb as de,Na as me,Nb as fe,Ob as r,Pb as a,Qb as g,Qc as be,Rb as W,Sb as H,Ub as v,Xb as u,Zb as d,ca as ie,ea as ne,eb as c,f as te,fb as m,gb as ue,ha as oe,id as Ce,jc as Q,ka as M,kb as pe,kc as s,la as re,lc as he,mc as w,nc as ge,qa as b,ra as C,rb as S,va as ae,xb as p,ya as se}from"./chunk-ZY3XLMOC.js";var Je=[{path:"accounts",loadChildren:()=>import("./chunk-G7PKWHEX.js").then(t=>t.AccountsModule)},{path:"home",loadChildren:()=>import("./chunk-5OJUTWHA.js").then(t=>t.HomeModule)},{path:"project",loadChildren:()=>import("./chunk-3ROSCV4Y.js").then(t=>t.ProjectModule)},{path:"analysis-group",loadChildren:()=>import("./chunk-EP37Q5GS.js").then(t=>t.AnalysisGroupModule)},{path:"search-session",loadChildren:()=>import("./chunk-PS3MA56Y.js").then(t=>t.SearchSessionModule)},{path:"collate",loadChildren:()=>import("./chunk-LXI3F7RF.js").then(t=>t.CollateModule)},{path:"admin",loadChildren:()=>import("./chunk-NGJ6LPEL.js").then(t=>t.AdminModule)},{path:"user",loadChildren:()=>import("./chunk-EFRAMSGB.js").then(t=>t.UserModule)},{path:"**",redirectTo:"home"}];var ct="@",mt=(()=>{class t{doc;delegate;zone;animationType;moduleImpl;_rendererFactoryPromise=null;scheduler=null;injector=M(ae);loadingSchedulerFn=M(ut,{optional:!0});_engine;constructor(e,i,n,l,x){this.doc=e,this.delegate=i,this.zone=n,this.animationType=l,this.moduleImpl=x}ngOnDestroy(){this._engine?.flush()}loadImpl(){let e=()=>this.moduleImpl??import("./chunk-2PTORTE2.js").then(n=>n),i;return this.loadingSchedulerFn?i=this.loadingSchedulerFn(e):i=e(),i.catch(n=>{throw new ie(5300,!1)}).then(({\u0275createEngine:n,\u0275AnimationRendererFactory:l})=>{this._engine=n(this.animationType,this.doc);let x=new l(this.delegate,this._engine,this.zone);return this.delegate=x,x})}createRenderer(e,i){let n=this.delegate.createRenderer(e,i);if(n.\u0275type===0)return n;typeof n.throwOnSyntheticProps=="boolean"&&(n.throwOnSyntheticProps=!1);let l=new q(n);return i?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(x=>{let O=x.createRenderer(e,i);l.use(O),this.scheduler??=this.injector.get(se,null,{optional:!0}),this.scheduler?.notify(11)}).catch(x=>{l.use(n)}),l}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}componentReplaced(e){this._engine?.flush(),this.delegate.componentReplaced?.(e)}static \u0275fac=function(i){ue()};static \u0275prov=ne({token:t,factory:t.\u0275fac})}return t})(),q=class{delegate;replay=[];\u0275type=1;constructor(o){this.delegate=o}use(o){if(this.delegate=o,this.replay!==null){for(let e of this.replay)e(o);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(o,e){return this.delegate.createElement(o,e)}createComment(o){return this.delegate.createComment(o)}createText(o){return this.delegate.createText(o)}get destroyNode(){return this.delegate.destroyNode}appendChild(o,e){this.delegate.appendChild(o,e)}insertBefore(o,e,i,n){this.delegate.insertBefore(o,e,i,n)}removeChild(o,e,i){this.delegate.removeChild(o,e,i)}selectRootElement(o,e){return this.delegate.selectRootElement(o,e)}parentNode(o){return this.delegate.parentNode(o)}nextSibling(o){return this.delegate.nextSibling(o)}setAttribute(o,e,i,n){this.delegate.setAttribute(o,e,i,n)}removeAttribute(o,e,i){this.delegate.removeAttribute(o,e,i)}addClass(o,e){this.delegate.addClass(o,e)}removeClass(o,e){this.delegate.removeClass(o,e)}setStyle(o,e,i,n){this.delegate.setStyle(o,e,i,n)}removeStyle(o,e,i){this.delegate.removeStyle(o,e,i)}setProperty(o,e,i){this.shouldReplay(e)&&this.replay.push(n=>n.setProperty(o,e,i)),this.delegate.setProperty(o,e,i)}setValue(o,e){this.delegate.setValue(o,e)}listen(o,e,i,n){return this.shouldReplay(e)&&this.replay.push(l=>l.listen(o,e,i,n)),this.delegate.listen(o,e,i,n)}shouldReplay(o){return this.replay!==null&&o.startsWith(ct)}},ut=new oe("");function qe(t="animations"){return ce("NgAsyncAnimations"),re([{provide:pe,useFactory:(o,e,i)=>new mt(o,e,i,t),deps:[be,xe,le]},{provide:me,useValue:t==="noop"?"NoopAnimations":"BrowserAnimations"}])}var et=(t,o)=>{let e=M(y),i=M(_);t=t.clone({setHeaders:{"X-Cinder-Instance-Id":i.cinderInstanceID}});let n=i.getCSRFTokenFromCookies();console.log(n),n&&(t=t.clone({setHeaders:{"X-CSRFToken":n}}));let l=i.getSessionIDFromCookies();return l&&(t=t.clone({setHeaders:{"X-Session-Token":l}})),e.loggedIn&&(t=t.clone({withCredentials:!0})),e.userAccount.token&&(t=t.clone({setHeaders:{Authorization:`Token ${e.userAccount.token}`}})),o(t)};var tt={providers:[_e({eventCoalescing:!0}),Le(Je,Ie(),Te()),Se(ve([et])),qe()]};var ot=(()=>{class t{constructor(e,i,n,l){this.accounts=e,this.fb=i,this.dialogRef=n,this.web=l,this.form=this.fb.group({username:new J("",$.required),password:new J("",$.required)})}close(){this.dialogRef.close()}login(){this.form.invalid||this.form.value.username&&this.form.value.password&&this.accounts.login(this.form.value.username,this.form.value.password).subscribe(e=>{this.accounts.loggedIn=!0,this.accounts.userAccount.token=e.token,this.accounts.userAccount.username=this.form.value.username,this.accounts.saveToStorage(),this.dialogRef.close(),this.web.getCurrentUser().subscribe(i=>{i&&(this.accounts.currentUser=i)})},e=>{console.log(e)})}connectKeycloak(){this.web.getLoginProviderRedirect()}static{this.\u0275fac=function(i){return new(i||t)(m(y),m(U),m(L),m(_))}}static{this.\u0275cmp=S({type:t,selectors:[["app-login-dialog"]],decls:19,vars:1,consts:[["mat-dialog-title",""],[2,"display","flex","flex-direction","column",3,"formGroup"],["matInput","","type","text","formControlName","username","id","username",1,"form-control"],["matInput","","type","password","formControlName","password","id","password",1,"form-control"],["mat-button","",3,"click"]],template:function(i,n){i&1&&(r(0,"h2",0),s(1,"Login"),a(),r(2,"mat-dialog-content")(3,"form",1)(4,"mat-form-field"),g(5,"input",2),r(6,"mat-label"),s(7,"Username"),a()(),r(8,"mat-form-field"),g(9,"input",3),r(10,"mat-label"),s(11,"Password"),a()()()(),r(12,"mat-dialog-actions")(13,"button",4),u("click",function(){return n.login()}),s(14,"Login"),a(),r(15,"button",4),u("click",function(){return n.close()}),s(16,"Close"),a(),r(17,"button",4),u("click",function(){return n.connectKeycloak()}),s(18,"Keycloak"),a()()),i&2&&(c(3),f("formGroup",n.form))},dependencies:[I,T,V,N,k,A,E,F,R,P,B,G,D,j],encapsulation:2})}}return t})();var rt=(()=>{class t{constructor(e,i,n,l){this.snackBar=e,this.dialogRef=i,this.web=n,this.fb=l,this.form=this.fb.group({name:["",$.required]})}submit(){if(this.form.invalid)return;let e=this.form.value.name;e&&this.web.getLabGroups(e).subscribe({next:i=>{i.results.length>0?this.snackBar.open("Lab group with this name already exists","Close",{duration:3e3}):this.web.createLabGroup(e).subscribe({next:()=>{this.snackBar.open("Lab group created successfully","Close",{duration:3e3}),this.dialogRef.close(!0)},error:()=>{this.snackBar.open("Error creating lab group","Close",{duration:3e3})}})},error:()=>{this.snackBar.open("Error checking lab group name","Close",{duration:3e3})}})}close(){this.dialogRef.close()}static{this.\u0275fac=function(i){return new(i||t)(m(Y),m(L),m(_),m(U))}}static{this.\u0275cmp=S({type:t,selectors:[["app-lab-group-create-dialog"]],decls:13,vars:1,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[3,"ngSubmit","formGroup"],["matInput","","formControlName","name"],["mat-dialog-actions",""],["mat-button","",3,"click"]],template:function(i,n){i&1&&(r(0,"h1",0),s(1,"Add Lab Group"),a(),r(2,"div",1)(3,"form",2),u("ngSubmit",function(){return n.submit()}),r(4,"mat-form-field")(5,"mat-label"),s(6,"Lab Group Name"),a(),g(7,"input",3),a()()(),r(8,"div",4)(9,"button",5),u("click",function(){return n.submit()}),s(10,"Submit"),a(),r(11,"button",5),u("click",function(){return n.close()}),s(12,"Cancel"),a()()),i&2&&(c(3),f("formGroup",n.form))},dependencies:[I,T,V,N,k,A,E,F,R,j,B,P,G,D],encapsulation:2})}}return t})();function dt(t,o){t&1&&(r(0,"th",17),s(1," ID "),a())}function ft(t,o){if(t&1&&(r(0,"td",18),s(1),a()),t&2){let e=o.$implicit;c(),w(" ",e.id," ")}}function ht(t,o){t&1&&(r(0,"th",17),s(1," Username "),a())}function gt(t,o){if(t&1&&(r(0,"td",18),s(1),a()),t&2){let e=o.$implicit;c(),w(" ",e.username," ")}}function _t(t,o){t&1&&(r(0,"th",17),s(1," First Name "),a())}function bt(t,o){if(t&1&&(r(0,"td",18),s(1),a()),t&2){let e=o.$implicit;c(),w(" ",e.first_name," ")}}function Ct(t,o){t&1&&(r(0,"th",17),s(1," Last Name "),a())}function St(t,o){if(t&1&&(r(0,"td",18),s(1),a()),t&2){let e=o.$implicit;c(),w(" ",e.last_name," ")}}function vt(t,o){t&1&&g(0,"tr",19)}function xt(t,o){if(t&1){let e=v();r(0,"tr",20),u("click",function(){let n=b(e).$implicit,l=d(2);return C(l.submit(n))}),a()}}function wt(t,o){if(t&1){let e=v();r(0,"table",7),W(1,8),p(2,dt,2,0,"th",9)(3,ft,2,1,"td",10),H(),W(4,11),p(5,ht,2,0,"th",9)(6,gt,2,1,"td",10),H(),W(7,12),p(8,_t,2,0,"th",9)(9,bt,2,1,"td",10),H(),W(10,13),p(11,Ct,2,0,"th",9)(12,St,2,1,"td",10),H(),p(13,vt,1,0,"tr",14)(14,xt,1,0,"tr",15),a(),r(15,"mat-paginator",16),u("page",function(n){b(e);let l=d();return C(l.onPageChange(n))}),a()}if(t&2){let e=d();f("dataSource",e.memberQuery.results),c(13),f("matHeaderRowDef",e.displayedColumns),c(),f("matRowDefColumns",e.displayedColumns),c(),f("length",e.memberQuery.count)("pageSize",e.limit)("pageIndex",e.offset)}}var at=(()=>{class t{set labGroupID(e){this._labGroupID=e,this.fetchMembers()}get labGroupID(){return this._labGroupID}constructor(e,i,n){this.dialogRef=e,this.web=i,this.fb=n,this._labGroupID=0,this.memberQuery=null,this.limit=10,this.offset=0,this.form=this.fb.group({selectedUser:[null],searchTerm:[""]}),this.displayedColumns=["id","username","first_name","last_name"],this.fetchMembers()}close(){this.dialogRef.close()}submit(e){this.dialogRef.close(e)}fetchMembers(){this.web.getUsers(this.form.value.searchTerm,this.limit,this.offset,this.labGroupID).subscribe(e=>{this.memberQuery=e})}onPageChange(e){this.limit=e.pageSize,this.offset=e.pageIndex*e.pageSize,this.fetchMembers()}selectAll(){this.dialogRef.close({all:!0})}static{this.\u0275fac=function(i){return new(i||t)(m(L),m(_),m(U))}}static{this.\u0275cmp=S({type:t,selectors:[["app-lab-group-user-list-dialog"]],inputs:{labGroupID:"labGroupID"},decls:17,vars:2,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[2,"display","flex","flex-direction","column","gap","20px",3,"ngSubmit","formGroup"],["matInput","","formControlName","searchTerm"],["mat-icon-button","","matSuffix","",3,"click"],["mat-dialog-actions",""],["mat-button","",3,"click"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","username"],["matColumnDef","first_name"],["matColumnDef","last_name"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"click",4,"matRowDef","matRowDefColumns"],[3,"page","length","pageSize","pageIndex"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row","",3,"click"]],template:function(i,n){i&1&&(r(0,"h1",0),s(1,"Select Lab Member"),a(),r(2,"div",1)(3,"form",2),u("ngSubmit",function(){return n.fetchMembers()}),r(4,"mat-form-field"),g(5,"input",3),r(6,"mat-label"),s(7,"Search Term"),a(),r(8,"button",4),u("click",function(){return n.fetchMembers()}),r(9,"mat-icon"),s(10,"search"),a()()()(),p(11,wt,16,6),a(),r(12,"div",5)(13,"button",6),u("click",function(){return n.close()}),s(14,"Cancel"),a(),r(15,"button",6),u("click",function(){return n.selectAll()}),s(16,"Revert Default"),a()()),i&2&&(c(3),f("formGroup",n.form),c(8),h(n.memberQuery?11:-1))},dependencies:[I,T,V,N,k,A,E,F,R,j,B,P,Oe,Ve,Pe,Be,$e,We,ze,He,Ue,Ae,G,D,je,X,K,ke],styles:[".mat-mdc-row[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%]{border-bottom:1px solid transparent;border-top:1px solid transparent;cursor:pointer}.mat-mdc-row[_ngcontent-%COMP%]:hover   .mat-mdc-cell[_ngcontent-%COMP%]{border-color:currentColor}.highlighted-row[_ngcontent-%COMP%]{background-color:#009dff}"]})}}return t})();var Dt=(t,o)=>o.id;function yt(t,o){if(t&1&&s(0),t&2){let e=d(2);ge(" (",e.currentUser.first_name," ",e.currentUser.last_name,")")}}function Mt(t,o){if(t&1&&s(0),t&2){let e=d(2);w(" ",e.currentLabGroup.name," ")}}function Lt(t,o){t&1&&s(0,"All Lab Group Selected")}function It(t,o){t&1&&(r(0,"mat-icon"),s(1,"shield_person"),a())}function Tt(t,o){t&1&&(r(0,"mat-icon"),s(1,"person"),a())}function Gt(t,o){if(t&1&&(r(0,"button",9),s(1),p(2,It,2,0,"mat-icon")(3,Tt,2,0,"mat-icon"),a()),t&2){d();let e=Q(45),i=d();f("matMenuTriggerFor",e),c(),w("Logged in as: ",i.accounts.currentUser.username," "),c(),h(i.accounts.currentUser.is_staff?2:3)}}function kt(t,o){if(t&1){let e=v();r(0,"button",22),u("click",function(){b(e);let n=d(2);return C(n.logout())}),r(1,"mat-icon"),s(2,"logout"),a()()}}function At(t,o){if(t&1){let e=v();r(0,"button",23),u("click",function(){b(e);let n=d(2);return C(n.openLoginDialog())}),r(1,"mat-icon"),s(2,"login"),a()()}}function Et(t,o){if(t&1){let e=v();r(0,"a",24),u("click",function(){let n=b(e).$implicit,l=d(2);return C(l.selectLabGroup(n))}),r(1,"span"),s(2),a()()}if(t&2){let e=o.$implicit;c(2),he(e.name)}}function Nt(t,o){if(t&1){let e=v();r(0,"a",24),u("click",function(){b(e);let n=d(2);return C(n.selectAllLabGroups())}),r(1,"span"),s(2,"All Lab Group"),a()()}}function Ft(t,o){if(t&1){let e=v();r(0,"a",24),u("click",function(){b(e);let n=d(3);return C(n.openLabGroupCreateDialog())}),s(1," + Create New Lab Group "),a()}}function Rt(t,o){if(t&1&&p(0,Ft,2,0,"a",18),t&2){let e=d(2);h(e.accounts.currentUser.is_staff?0:-1)}}function Ut(t,o){t&1&&(r(0,"a",21),s(1," Administration "),a())}function Vt(t,o){if(t&1){let e=v();r(0,"mat-toolbar")(1,"mat-toolbar-row")(2,"div",3),g(3,"img",4),r(4,"a",5)(5,"span",6)(6,"b"),s(7,"C|nder"),a()()()(),g(8,"span",7),r(9,"button",8),u("click",function(){b(e);let n=d();return C(n.openLabMemberDialog())}),s(10,"Filter By Lab Member "),p(11,yt,1,2),a(),r(12,"button",9),p(13,Mt,1,1)(14,Lt,1,0),a(),p(15,Gt,4,3,"button",9),r(16,"mat-slide-toggle",10),u("change",function(){b(e);let n=d();return C(n.switchDarkMode())}),r(17,"mat-icon"),s(18,"lightbulb"),a()(),r(19,"button",11)(20,"mat-icon"),s(21,"view_list"),a()(),p(22,kt,3,0,"button",12)(23,At,3,0,"button",13),a()(),r(24,"mat-menu",null,0)(26,"a",14)(27,"span"),s(28,"Project"),a()(),r(29,"a",15)(30,"span"),s(31,"Analysis Group"),a()(),r(32,"a",16)(33,"span"),s(34,"Search Session"),a()(),r(35,"a",17)(36,"span"),s(37,"Collate"),a()()(),r(38,"mat-menu",null,1),de(40,Et,3,1,"a",18,Dt),p(42,Nt,3,0,"a",18)(43,Rt,1,1),a(),r(44,"mat-menu",null,2)(46,"a",19)(47,"span"),s(48,"Profile"),a()(),r(49,"a",20)(50,"span"),s(51,"Change Password"),a()(),p(52,Ut,2,0,"a",21),a()}if(t&2){let e=Q(25),i=Q(39),n=d();c(3),f("width",25)("height",25)("ngSrc","/assets/logo.png"),c(8),h(n.currentUser?11:-1),c(),f("matMenuTriggerFor",i),c(),h(n.currentLabGroup?13:14),c(2),h(n.accounts.loggedIn&&n.accounts.currentUser?15:-1),c(),f("color","primary")("checked",n.accounts.userAccount.darkMode),c(3),f("matMenuTriggerFor",e),c(3),h(n.accounts.loggedIn?22:23),c(18),fe(n.labGroups),c(2),h(n.currentLabGroup?42:-1),c(),h(n.accounts.loggedIn&&n.accounts.currentUser?43:-1),c(9),h(n.accounts.currentUser!=null&&n.accounts.currentUser.is_staff?52:-1)}}var st=(()=>{class t{constructor(e,i,n,l,x){this.webService=e,this.router=i,this.accounts=n,this.dialog=l,this.graphService=x,this.labGroups=[],this.isCollateView=!1,this.accounts.userAccount.currentUser&&this.webService.getUser(this.accounts.userAccount.currentUser).subscribe({next:O=>{this.currentUser=O},error:O=>{console.error("Error fetching user:",O)}})}ngOnInit(){this.fetchLabGroups(),this.router.events.subscribe(e=>{e instanceof De&&(this.isCollateView=e.urlAfterRedirects.includes("/collate/view"))})}openLoginDialog(){let e=this.dialog.open(ot)}switchDarkMode(){let e=document.getElementsByTagName("body")[0];console.log(this.accounts.userAccount.darkMode),this.accounts.userAccount.darkMode?(e.classList.remove("dark-theme"),e.classList.add("light-theme")):(e.classList.add("dark-theme"),e.classList.remove("light-theme")),this.accounts.userAccount.darkMode=!this.accounts.userAccount.darkMode,this.accounts.saveToStorage(),this.graphService.redrawTrigger.next(!0)}fetchLabGroups(){this.webService.getLabGroups().subscribe({next:e=>{this.labGroups=e.results,this.accounts.userAccount.currentLabGroup&&(this.currentLabGroup=this.labGroups.find(i=>i.id===this.accounts.userAccount.currentLabGroup))},error:e=>{console.error("Error fetching lab groups:",e)}})}selectLabGroup(e){this.currentLabGroup=e,this.accounts.userAccount.currentLabGroup=e.id,this.accounts.saveToStorage(),this.webService.updateFromLabGroupSelection.next(!0)}selectAllLabGroups(){this.currentLabGroup=void 0,this.accounts.userAccount.currentLabGroup=null,this.accounts.saveToStorage(),this.webService.updateFromLabGroupSelection.next(!0)}openLabGroupCreateDialog(){this.dialog.open(rt).afterClosed().subscribe(i=>{i&&this.fetchLabGroups()})}openLabMemberDialog(){let e=this.dialog.open(at);this.currentLabGroup&&(e.componentInstance.labGroupID=this.currentLabGroup.id),e.afterClosed().subscribe(i=>{"all"in i?(this.currentUser=void 0,this.accounts.userAccount.currentUser=null):(this.currentUser=i,this.accounts.userAccount.currentUser=i.id),this.accounts.saveToStorage(),this.webService.updateFromLabGroupSelection.next(!0)})}logout(){this.webService.userLogoutProvider().subscribe({next:e=>{this.webService.logoutProvider().subscribe(),this.accounts.logout()},error:e=>{console.error("Error logging out:",e)}})}static{this.\u0275fac=function(i){return new(i||t)(m(_),m(Me),m(y),m(Ge),m(Qe))}}static{this.\u0275cmp=S({type:t,selectors:[["app-navbar"]],decls:1,vars:1,consts:[["menu","matMenu"],["labGroupMenu","matMenu"],["userMenu","matMenu"],[2,"display","flex","justify-content","center","align-items","center"],[3,"width","height","ngSrc"],["href","/#/home"],[2,"color","#ba0000"],[1,"spacer"],["mat-button","",3,"click"],["mat-button","",3,"matMenuTriggerFor"],[1,"example-margin",3,"change","color","checked"],["mat-icon-button","","aria-label","View Project or Analysis Group",2,"color","rgb(172,110,110)",3,"matMenuTriggerFor"],["mat-icon-button","","aria-label","Logout",2,"color","rgb(186,104,166)"],["mat-icon-button","","aria-label","Login",2,"color","rgb(172,110,110)"],["mat-menu-item","","href","/#/project"],["mat-menu-item","","href","/#/analysis-group"],["mat-menu-item","","href","/#/search-session"],["mat-menu-item","","href","/#/collate"],["mat-menu-item",""],["mat-menu-item","","href","/#/user"],["mat-menu-item","","href","/#/user/change-password"],["mat-menu-item","","href","/#/admin"],["mat-icon-button","","aria-label","Logout",2,"color","rgb(186,104,166)",3,"click"],["mat-icon-button","","aria-label","Login",2,"color","rgb(172,110,110)",3,"click"],["mat-menu-item","",3,"click"]],template:function(i,n){i&1&&p(0,Vt,53,14),i&2&&h(n.isCollateView?-1:0)},dependencies:[Re,Fe,Ne,K,X,Ke,Xe,Ye,Ce,Ze,D],encapsulation:2})}}return t})();function jt(t,o){t&1&&g(0,"router-outlet")}var lt=(()=>{class t{constructor(e,i,n,l){this.web=e,this.accounts=i,this.ws=n,this.sb=l,this.title="CinderNG",this.ready=!1}ngAfterViewInit(){this.ws.lostConnectionSubject.subscribe(e=>{e&&this.sb.open("Lost push notification connection to server. Refresh to restore.","Dismiss")}),this.web.searchSessionID=localStorage.getItem("cinderSearchSessionID"),this.login().then(e=>{this.web.searchSessionID?(this.ws.connectSearchWS(this.web.searchSessionID),this.ws.searchWSConnection?.subscribe(i=>{i&&(console.log(i),i.type==="logout"&&this.accounts.logout())}),this.ws.connectCurtainWS(this.web.searchSessionID),this.ws.curtainWSConnection?.subscribe(i=>{})):this.web.getSearchSessionID().subscribe(i=>{this.ws.connectSearchWS(i),localStorage.setItem("cinderSearchSessionID",i),this.web.searchSessionID=i,this.ws.searchWSConnection?.subscribe(n=>{if(n&&n.type==="search_status")switch(n.status){case"error":this.sb.open("Search failed","Dismiss",{duration:2e3});break;case"started":this.sb.open("Search started","Dismiss",{duration:2e3});break;case"in_progress":this.sb.open(`Search in progress: ${n.current_progress}/${n.found_files}`,"Dismiss",{duration:2e3})}}),this.ws.connectSearchWS(i),this.ws.curtainWSConnection?.subscribe(n=>{})}),this.ready=!0,e&&this.web.getCurrentUser().subscribe(i=>{i&&(this.accounts.currentUser=i)})})}login(){return te(this,null,function*(){if(this.accounts.loadAuthFromStorage(),!this.accounts.loggedIn)try{let e=yield this.web.getCSRFToken().toPromise();if(e&&e.status===200)try{let i=yield this.web.getAuthenticationStatus().toPromise();i&&i.status===200&&(this.accounts.userSession=i,this.accounts.loggedIn=!0)}catch(i){console.log(i)}}catch(e){console.log(e)}return this.accounts.loggedIn})}static{this.\u0275fac=function(i){return new(i||t)(m(_),m(y),m(Ee),m(Y))}}static{this.\u0275cmp=S({type:t,selectors:[["app-root"]],decls:3,vars:1,consts:[[1,"container"]],template:function(i,n){i&1&&(g(0,"app-navbar"),r(1,"div",0),p(2,jt,1,0,"router-outlet"),a()),i&2&&(c(2),h(n.ready?2:-1))},dependencies:[ye,st],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:calc(100vh - 64px)}"]})}}return t})();we(lt,tt).catch(t=>console.error(t));
