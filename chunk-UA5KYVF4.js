import{a as pe,b as ue,c as fe,d as _e,e as he,f as Ce,g as ge,h as ve,i as Se,j as xe}from"./chunk-YO5BEYK2.js";import{a as ie,c as ne}from"./chunk-TSMHSBKG.js";import{a as be,b as Me}from"./chunk-NRDRSNHV.js";import{a as W}from"./chunk-26ZFRSQG.js";import{a as le,c as se}from"./chunk-IAQYASUB.js";import{a as w,b as F,c as R,d as N,e as j,f as L,g as de}from"./chunk-NIVJTLF2.js";import{Aa as z,Ba as re,Ca as $,Ea as Q,Ga as me,Ja as O,Ka as P,La as ce,Ma as M,Q as oe,R as b,S as ae,ma as A,oa as v,qa as B,ra as V,va as G,ya as q,za as H}from"./chunk-KVGTURXN.js";import"./chunk-4N6BO7AP.js";import{c as ee,p as te}from"./chunk-KCCSOALX.js";import{Aa as y,Ba as E,Bb as _,Hb as k,Lb as i,Mb as o,Nb as d,Ob as T,Pb as D,Rb as I,Ub as p,Wb as x,ed as Z,fb as c,gb as s,gc as r,ia as Y,ic as S,ja as J,na as K,oc as g,sa as C,ta as X,xb as f}from"./chunk-QNTGE4BG.js";var De=(()=>{let e=class e{constructor(a,n,m){this.dialogRef=a,this.data=n,this.webService=m}onCancel(){this.dialogRef.close(!1)}onConfirm(){this.dialogRef.close(!0)}};e.\u0275fac=function(n){return new(n||e)(s(w),s(F),s(M))},e.\u0275cmp=C({type:e,selectors:[["app-delete-user-confirmation"]],standalone:!0,features:[g],decls:10,vars:1,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["mat-dialog-actions",""],["mat-button","",3,"click"],["mat-button","","color","warn",3,"click"]],template:function(n,m){n&1&&(i(0,"h1",0),r(1,"Confirm Delete"),o(),i(2,"div",1)(3,"p"),r(4),o()(),i(5,"div",2)(6,"button",3),p("click",function(){return m.onCancel()}),r(7,"Cancel"),o(),i(8,"button",4),p("click",function(){return m.onConfirm()}),r(9,"Delete"),o()()),n&2&&(c(4),S('Are you sure you want to delete user "',m.data.username,'"?'))},dependencies:[b,L,j,N]});let t=e;return t})();var Ue=(()=>{let e=class e{constructor(a,n,m,u,h,we){this.fb=a,this.webService=n,this.snackBar=m,this.dialogRef=u,this.data=h,this.dialog=we,this.form=this.fb.group({id:[h.id],username:[h.username,v.required],first_name:[h.first_name,v.required],last_name:[h.last_name,v.required],email:[h.email,[v.required,v.email]]})}save(){this.form.invalid||this.webService.updateUser(this.form.value.id,this.form.value.email,null,this.form.value.last_name,this.form.value.first_name,this.form.value.username).subscribe({next:a=>{this.snackBar.open("User updated successfully","Close",{duration:2e3}),this.dialogRef.close(a)},error:()=>{this.snackBar.open("Error updating user","Close",{duration:2e3})}})}cancel(){this.dialogRef.close()}delete(){this.dialog.open(De,{data:this.data}).afterClosed().subscribe(n=>{n&&this.webService.removeUser(this.data.id).subscribe({next:()=>{this.snackBar.open("User deleted successfully","Close",{duration:2e3}),this.dialogRef.close()},error:()=>{this.snackBar.open("Error deleting user","Close",{duration:2e3})}})})}};e.\u0275fac=function(n){return new(n||e)(s(z),s(M),s(W),s(w),s(F),s(R))},e.\u0275cmp=C({type:e,selectors:[["app-edit-user-dialog"]],standalone:!0,features:[g],decls:27,vars:1,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[2,"display","flex","flex-direction","column","gap","20px",3,"formGroup"],["matInput","","formControlName","username","placeholder","Username"],["matInput","","formControlName","first_name","placeholder","First Name"],["matInput","","formControlName","last_name","placeholder","Last Name"],["matInput","","formControlName","email","placeholder","Email"],["mat-dialog-actions",""],["mat-button","",3,"click"],["mat-button","","color","primary",3,"click"]],template:function(n,m){n&1&&(i(0,"h1",0),r(1,"Edit User"),o(),i(2,"div",1)(3,"form",2)(4,"mat-form-field"),d(5,"input",3),i(6,"mat-label"),r(7,"Username"),o()(),i(8,"mat-form-field"),d(9,"input",4),i(10,"mat-label"),r(11,"First Name"),o()(),i(12,"mat-form-field"),d(13,"input",5),i(14,"mat-label"),r(15,"Last Name"),o()(),i(16,"mat-form-field"),d(17,"input",6),i(18,"mat-label"),r(19,"Email"),o()()()(),i(20,"div",7)(21,"button",8),p("click",function(){return m.delete()}),r(22,"Delete"),o(),i(23,"button",8),p("click",function(){return m.cancel()}),r(24,"Cancel"),o(),i(25,"button",9),p("click",function(){return m.save()}),r(26,"Save"),o()()),n&2&&(c(3),_("formGroup",m.form))},dependencies:[Q,P,$,G,A,B,V,q,H,O,j,N,b,L]});let t=e;return t})();var ye=(()=>{let e=class e{constructor(a){this.http=a,this.baseURL=ce.baseURL}generateUserToken(a){return this.http.post(`${this.baseURL}/api/users/generate_token/`,{username:a},{responseType:"json",observe:"body"})}};e.\u0275fac=function(n){return new(n||e)(K(ee))},e.\u0275prov=Y({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function je(t,e){if(t&1){let l=I();i(0,"mat-card",3)(1,"mat-card-content"),r(2," Registration Link and Information "),i(3,"mat-form-field",5),d(4,"input",6),i(5,"mat-label"),r(6,"Registration Link"),o(),i(7,"button",7),p("click",function(){y(l);let n=x();return E(n.copyTokenLink())}),i(8,"mat-icon"),r(9,"content_paste"),o()()()()()}if(t&2){let l=x();c(4),_("value",l.userTokenLink)}}function Le(t,e){t&1&&(i(0,"th",18),r(1," ID "),o())}function Ae(t,e){if(t&1&&(i(0,"td",19),r(1),o()),t&2){let l=e.$implicit;c(),S(" ",l.id," ")}}function Be(t,e){t&1&&(i(0,"th",18),r(1," Username "),o())}function Ve(t,e){if(t&1&&(i(0,"td",19),r(1),o()),t&2){let l=e.$implicit;c(),S(" ",l.username," ")}}function Ge(t,e){t&1&&(i(0,"th",18),r(1," First Name "),o())}function qe(t,e){if(t&1&&(i(0,"td",19),r(1),o()),t&2){let l=e.$implicit;c(),S(" ",l.first_name," ")}}function He(t,e){t&1&&(i(0,"th",18),r(1," Last Name "),o())}function ze(t,e){if(t&1&&(i(0,"td",19),r(1),o()),t&2){let l=e.$implicit;c(),S(" ",l.last_name," ")}}function $e(t,e){t&1&&d(0,"tr",20)}function Qe(t,e){if(t&1){let l=I();i(0,"tr",21),p("click",function(){let n=y(l).$implicit,m=x(2);return E(m.openEditUserDialog(n))}),o()}}function Oe(t,e){if(t&1){let l=I();i(0,"table",8),T(1,9),f(2,Le,2,0,"th",10)(3,Ae,2,1,"td",11),D(),T(4,12),f(5,Be,2,0,"th",10)(6,Ve,2,1,"td",11),D(),T(7,13),f(8,Ge,2,0,"th",10)(9,qe,2,1,"td",11),D(),T(10,14),f(11,He,2,0,"th",10)(12,ze,2,1,"td",11),D(),f(13,$e,1,0,"tr",15)(14,Qe,1,0,"tr",16),o(),i(15,"mat-paginator",17),p("page",function(n){y(l);let m=x();return E(m.onPageChange(n))}),o()}if(t&2){let l=x();_("dataSource",l.userQuery.results),c(13),_("matHeaderRowDef",l.displayedColumns),c(),_("matRowDefColumns",l.displayedColumns),c(),_("length",l.userQuery.count)("pageSize",l.limit)("pageIndex",l.offset)}}function Pe(t,e){t&1&&(i(0,"p"),r(1,"No users found."),o())}var Ee=(()=>{let e=class e{constructor(a,n,m,u,h){this.dialog=a,this.adminService=n,this.fb=m,this.snackBar=u,this.webService=h,this.userTokenForm=this.fb.group({username:["",v.required]}),this.userTokenLink="",this.userSearchForm=this.fb.group({query:[""]}),this.limit=10,this.offset=0,this.userQuery=null,this.displayedColumns=["id","username","first_name","last_name"]}ngOnInit(){this.fetchUsers()}createUserToken(){this.userTokenForm.invalid||this.userTokenForm.value.username&&this.adminService.generateUserToken(this.userTokenForm.value.username).subscribe(a=>{this.userTokenLink=location.protocol+"//"+location.host+"#/user/register/"+a.token})}copyTokenLink(){navigator.clipboard.writeText(this.userTokenLink).then(()=>{this.snackBar.open("Link copied to clipboard","Close",{duration:2e3})})}fetchUsers(){this.webService.getUsers(this.userSearchForm.value.query,this.limit,this.offset).subscribe(a=>{this.userQuery=a})}onPageChange(a){this.limit=a.pageSize,this.offset=a.pageIndex*a.pageSize,this.fetchUsers()}openEditUserDialog(a){this.dialog.open(Ue,{data:a}).afterClosed().subscribe(m=>{m&&this.fetchUsers()})}};e.\u0275fac=function(n){return new(n||e)(s(R),s(ye),s(z),s(W),s(M))},e.\u0275cmp=C({type:e,selectors:[["app-user-management"]],standalone:!0,features:[g],decls:21,vars:4,consts:[[2,"display","flex","flex-direction","column","gap","20px","padding","20px",3,"ngSubmit","formGroup"],["matInput","","formControlName","username","placeholder","Username","type","text"],["mat-raised-button","","color","primary","type","submit"],["appearance","outlined"],["matInput","","formControlName","query","placeholder","Search","type","text"],[2,"width","100%"],["matInput","","type","text","readonly","",3,"value"],["mat-icon-button","","matSuffix","",3,"click"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","username"],["matColumnDef","first_name"],["matColumnDef","last_name"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"click",4,"matRowDef","matRowDefColumns"],[3,"page","length","pageSize","pageIndex"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row","",3,"click"]],template:function(n,m){n&1&&(i(0,"h1"),r(1,"Generate Registration Link"),o(),i(2,"form",0),p("ngSubmit",function(){return m.createUserToken()}),i(3,"mat-form-field"),d(4,"input",1),i(5,"mat-label"),r(6,"Username"),o()(),i(7,"div")(8,"button",2),r(9,"Create User Registration Token Link"),o()(),f(10,je,10,1,"mat-card",3),o(),d(11,"mat-divider"),i(12,"h1"),r(13,"Manage Users"),o(),i(14,"form",0),p("ngSubmit",function(){return m.fetchUsers()}),i(15,"mat-form-field"),d(16,"input",4),i(17,"mat-label"),r(18,"Search Term"),o()()(),f(19,Oe,16,6)(20,Pe,2,0,"p")),n&2&&(c(2),_("formGroup",m.userTokenForm),c(8),k(m.userTokenLink?10:-1),c(4),_("formGroup",m.userSearchForm),c(5),k(m.userQuery?19:20))},dependencies:[$,G,A,B,V,q,H,Q,P,O,b,ie,ne,oe,re,me,ae,le,xe,Se,Ce,he,_e,pe,ue,fe,ge,ve,se]});let t=e;return t})();function We(t,e){t&1&&(i(0,"div",0)(1,"div",1)(2,"mat-tab-group")(3,"mat-tab",2),d(4,"app-user-management"),o()()()())}function Ye(t,e){t&1&&(i(0,"div",0)(1,"p"),r(2," You are not authorized to view this page. "),o()())}var Ie=(()=>{let e=class e{constructor(a){this.accounts=a,this.isStaff=!1,console.log(this.accounts.currentUser),this.isStaff=this.accounts.currentUser?.is_staff||!1}};e.\u0275fac=function(n){return new(n||e)(s(de))},e.\u0275cmp=C({type:e,selectors:[["app-admin"]],standalone:!0,features:[g],decls:2,vars:1,consts:[[2,"display","flex","flex-direction","column","align-items","center","gap","20px"],[2,"width","600px"],["label","User Management"]],template:function(n,m){n&1&&f(0,We,5,0,"div",0)(1,Ye,3,0,"div",0),n&2&&k(m.isStaff?0:1)},dependencies:[Me,be,Ee]});let t=e;return t})();var Je=[{path:"",component:Ie}],Ut=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=X({type:e}),e.\u0275inj=J({imports:[Z,te.forChild(Je)]});let t=e;return t})();export{Ut as AdminModule};
