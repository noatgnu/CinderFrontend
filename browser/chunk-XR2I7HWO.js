import{ya as b}from"./chunk-H4GRKNEN.js";import{a as j,c as v}from"./chunk-ZOIK2NCC.js";import{ca as d,e as y,f as w,h as k,ha as m,k as p,l as I,n as u}from"./chunk-EU3335TE.js";var x=(()=>{let t=class t{constructor(e){this.http=e,this.token="",this.loggedIn=!1,this.baseURL=b.baseURL,this.username="",this.lastVisited=new Date,this.triggerLoginSubject=new p,this.is_staff=!1}login(e,s){this.loggedIn=!1;let o=new j;return o.append("Content-Type","application/json"),o.append("Accept","application/json"),this.http.post(`${this.baseURL}/api/token-auth/`,{username:e,password:s},{responseType:"json",observe:"body"})}logout(){this.loggedIn=!1,this.token="",localStorage.removeItem("cinderToken"),localStorage.removeItem("cinderUsername")}loadLastVisited(){let e=new Date,s=localStorage.getItem("cinderLastVisited");s?(this.lastVisited=new Date(JSON.parse(s)),this.saveDate(e)):(this.lastVisited=e,this.saveDate(e))}loadAuthFromStorage(){let e=localStorage.getItem("cinderToken"),s=localStorage.getItem("cinderUsername");e&&s&&(this.token=e,this.username=s,this.loggedIn=!0)}saveToStorage(){localStorage.setItem("cinderToken",this.token),localStorage.setItem("cinderUsername",this.username)}saveDate(e){localStorage.setItem("cinderLastVisited",JSON.stringify(e))}};t.\u0275fac=function(s){return new(s||t)(m(v))},t.\u0275prov=d({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();var L={url:"",deserializer:n=>JSON.parse(n.data),serializer:n=>JSON.stringify(n)},O="WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }",S=class n extends I{constructor(t,r){if(super(),this._socket=null,t instanceof k)this.destination=r,this.source=t;else{let e=this._config=Object.assign({},L);if(this._output=new p,typeof t=="string")e.url=t;else for(let s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);if(!e.WebSocketCtor&&WebSocket)e.WebSocketCtor=WebSocket;else if(!e.WebSocketCtor)throw new Error("no WebSocket constructor can be found");this.destination=new u}}lift(t){let r=new n(this._config,this.destination);return r.operator=t,r.source=this,r}_resetState(){this._socket=null,this.source||(this.destination=new u),this._output=new p}multiplex(t,r,e){let s=this;return new k(o=>{try{s.next(t())}catch(a){o.error(a)}let i=s.subscribe({next:a=>{try{e(a)&&o.next(a)}catch(c){o.error(c)}},error:a=>o.error(a),complete:()=>o.complete()});return()=>{try{s.next(r())}catch(a){o.error(a)}i.unsubscribe()}})}_connectSocket(){let{WebSocketCtor:t,protocol:r,url:e,binaryType:s}=this._config,o=this._output,i=null;try{i=r?new t(e,r):new t(e),this._socket=i,s&&(this._socket.binaryType=s)}catch(c){o.error(c);return}let a=new y(()=>{this._socket=null,i&&i.readyState===1&&i.close()});i.onopen=c=>{let{_socket:l}=this;if(!l){i.close(),this._resetState();return}let{openObserver:_}=this._config;_&&_.next(c);let g=this.destination;this.destination=w.create(h=>{if(i.readyState===1)try{let{serializer:f}=this._config;i.send(f(h))}catch(f){this.destination.error(f)}},h=>{let{closingObserver:f}=this._config;f&&f.next(void 0),h&&h.code?i.close(h.code,h.reason):o.error(new TypeError(O)),this._resetState()},()=>{let{closingObserver:h}=this._config;h&&h.next(void 0),i.close(),this._resetState()}),g&&g instanceof u&&a.add(g.subscribe(this.destination))},i.onerror=c=>{this._resetState(),o.error(c)},i.onclose=c=>{i===this._socket&&this._resetState();let{closeObserver:l}=this._config;l&&l.next(c),c.wasClean?o.complete():o.error(c)},i.onmessage=c=>{try{let{deserializer:l}=this._config;o.next(l(c))}catch(l){o.error(l)}}}_subscribe(t){let{source:r}=this;return r?r.subscribe(t):(this._socket||this._connectSocket(),this._output.subscribe(t),t.add(()=>{let{_socket:e}=this;this._output.observers.length===0&&(e&&(e.readyState===1||e.readyState===0)&&e.close(),this._resetState())}),t)}unsubscribe(){let{_socket:t}=this;t&&(t.readyState===1||t.readyState===0)&&t.close(),this._resetState(),super.unsubscribe()}};var $=(()=>{let t=class t{constructor(e){this.accounts=e,this.baseURL=b.baseURL.replace("http","ws")}connectSearchWS(e){this.searchWSConnection=new S({url:`${this.baseURL}/ws/search/${e}/?token=${this.accounts.token}`,openObserver:{next:()=>{console.log("Connected to search websocket")}},closeObserver:{next:()=>{console.log("Closed connection to search websocket")}}})}closeSearchWS(){this.searchWSConnection&&this.searchWSConnection.unsubscribe()}};t.\u0275fac=function(s){return new(s||t)(m(x))},t.\u0275prov=d({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();export{x as a,$ as b};
