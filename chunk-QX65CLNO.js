import{a as te,b as ie,d as re}from"./chunk-LU7HVNBM.js";import{a as ee,f as R,h as V,j as q}from"./chunk-OZBYPAFL.js";import{a as D}from"./chunk-ZF457RPY.js";import{a as j}from"./chunk-HQFSCXZS.js";import{Aa as N,Ca as U,Ea as T,Fa as Z,Ga as B,Ja as Q,Ka as z,Q as y,R as x,S as I,ma as E,oa as p,qa as P,ra as L,ta as A,va as k,ya as F,za as M}from"./chunk-RBHTY4FE.js";import"./chunk-4N6BO7AP.js";import{p as Y}from"./chunk-KCCSOALX.js";import{Aa as O,Ab as _,Ba as W,Bb as f,Jb as v,Kb as S,Lb as e,Mb as r,Nb as d,Rb as J,Ub as c,Wb as K,ed as X,fb as s,gb as b,gc as a,hc as g,ic as w,ja as $,oc as G,sa as C,ta as H}from"./chunk-QNTGE4BG.js";var ae=(l,n)=>n.id;function de(l,n){if(l&1){let h=J();e(0,"mat-chip",16),c("removed",function(){let o=O(h).$implicit,t=K();return W(t.removeLabGroup(o))}),a(1),e(2,"mat-icon",17),a(3,"cancel"),r()()}if(l&2){let h=n.$implicit;s(),w(" ",h.name," ")}}function ce(l,n){if(l&1&&(e(0,"mat-list-option",10),a(1),r()),l&2){let h=n.$implicit;f("value",h),s(),w(" ",h.name," ")}}var ne=(()=>{let n=class n{set user(i){i?this._user=i:this.web.getCurrentUser().subscribe(o=>{this._user=o}),this.form.patchValue(i),this.web.getCurrentUserLabGroups().subscribe(o=>{this.labGroupForm.controls.lab_group.setValue(o)}),this.fetchLabGroups(),console.log(i),console.log(this._user)}get user(){return this._user}constructor(i,o,t){this.fb=i,this.web=o,this.snackBar=t,this._user=null,this.hidePassword=!0,this.hideConfirmPassword=!0,this.form=this.fb.group({username:["",p.required],first_name:["",p.required],last_name:["",p.required],email:["",p.required]}),this.passwordForm=this.fb.group({new_password:["",p.required],confirm_password:["",p.required]}),this.labGroupForm=this.fb.group({lab_group:new A([]),search_term:new A("")}),this.labGroupQuery=null,this.currentIndex=0,this.size=5}updateUser(){this.web.updateUser(this.user.id,this.form.value.email,null,this.form.value.last_name,this.form.value.first_name).subscribe(i=>{this.user=i,this.snackBar.open("User updated","Close",{duration:2e3})},i=>{this.snackBar.open("Error updating user","Close",{duration:2e3})})}updatePassword(){this.web.updateUser(this.user.id,null,this.passwordForm.value.new_password,null,null).subscribe(i=>{this.user=i,this.snackBar.open("Password updated","Close",{duration:2e3})},i=>{this.snackBar.open("Error updating password","Close",{duration:2e3})})}fetchLabGroups(){this.labGroupForm.controls.search_term.value?this.web.getLabGroups(this.labGroupForm.controls.search_term.value,this.size,this.currentIndex).subscribe(i=>{this.labGroupQuery=i}):this.web.getLabGroups(void 0,this.size,this.currentIndex).subscribe(i=>{this.labGroupQuery=i})}removeLabGroup(i){if(!this.labGroupForm.controls.lab_group.value)return;let o=this.labGroupForm.controls.lab_group.value.filter(t=>t.id!==i.id);this.labGroupForm.controls.lab_group.setValue(o)}previousPage(){this.currentIndex>0&&(this.currentIndex-=this.size,this.fetchLabGroups())}nextPage(){this.labGroupQuery&&this.labGroupQuery.results.length===this.size&&(this.currentIndex+=this.size,this.fetchLabGroups())}onLabGroupSelect(i){let o=i.options,t=this.labGroupForm.controls.lab_group.value||[];o.forEach(m=>{let u=m.value;t.some(le=>le.id===u.id)||t.push(u)}),this.labGroupForm.controls.lab_group.setValue(t)}onPageChange(i){this.size=i.pageSize,this.currentIndex=i.pageIndex*this.size,this.fetchLabGroups()}updateLabGroups(){this.web.getCurrentUserLabGroups().subscribe(i=>{let o=this.labGroupForm.controls.lab_group.value||[],t=new Set(o.map(u=>u.id)),m=new Set(i.map(u=>u.id));t.forEach(u=>{m.has(u)||this.web.addLabGroupMember(u,this.user.id).subscribe()}),o.forEach(u=>{m.has(u.id)||this.web.removeLabGroupMember(u.id,this.user.id).subscribe()})})}};n.\u0275fac=function(o){return new(o||n)(b(N),b(D),b(j))},n.\u0275cmp=C({type:n,selectors:[["app-user"]],inputs:{user:"user"},standalone:!0,features:[G],decls:59,vars:13,consts:[[2,"display","flex","flex-direction","column","align-items","center","gap","20px"],[2,"width","600px"],[2,"display","flex","flex-direction","column","gap","20px","padding","20px",3,"ngSubmit","formGroup"],["matInput","","formControlName","first_name"],["matInput","","formControlName","last_name"],["matInput","","formControlName","email"],["mat-raised-button","","color","primary","type","submit"],[2,"display","flex","flex-direction","column","gap","20px","padding","20px",3,"formGroup"],["matInput","","formControlName","search_term",3,"input"],[3,"selectionChange"],[3,"value"],[3,"page","length","pageSize"],["mat-raised-button","","color","primary",3,"click"],["matInput","","formControlName","new_password","placeholder","Password",3,"type"],["mat-icon-button","","matSuffix","",3,"click"],["matInput","","formControlName","confirm_password","placeholder","Confirm Password",3,"type"],[3,"removed"],["matChipRemove",""]],template:function(o,t){o&1&&(e(0,"div",0)(1,"div",1)(2,"h1"),a(3,"Basic Information"),r(),e(4,"form",2),c("ngSubmit",function(){return t.updateUser()}),e(5,"mat-form-field"),d(6,"input",3),e(7,"mat-label"),a(8,"First Name"),r()(),e(9,"mat-form-field"),d(10,"input",4),e(11,"mat-label"),a(12,"Last Name"),r()(),e(13,"mat-form-field"),d(14,"input",5),e(15,"mat-label"),a(16,"Email Address"),r()(),e(17,"div")(18,"button",6),a(19,"Update Basic Information"),r()()(),d(20,"mat-divider"),e(21,"h1"),a(22,"Lab Group"),r(),e(23,"form",7),a(24," User Belongs To Lab Groups: "),e(25,"mat-chip-set"),v(26,de,4,1,"mat-chip",null,ae),r(),a(28," Search Lab Groups: "),e(29,"mat-form-field")(30,"input",8),c("input",function(){return t.fetchLabGroups()}),r()(),e(31,"mat-selection-list",9),c("selectionChange",function(u){return t.onLabGroupSelect(u)}),v(32,ce,2,2,"mat-list-option",10,ae),r(),e(34,"mat-paginator",11),c("page",function(u){return t.onPageChange(u)}),r(),e(35,"div")(36,"button",12),c("click",function(){return t.updateLabGroups()}),a(37,"Update Lab Groups"),r()()(),d(38,"mat-divider"),e(39,"h1"),a(40,"Change Password"),r(),e(41,"form",2),c("ngSubmit",function(){return t.updatePassword()}),e(42,"mat-form-field"),d(43,"input",13),e(44,"mat-label"),a(45,"Password"),r(),e(46,"button",14),c("click",function(){return t.hidePassword=!t.hidePassword}),e(47,"mat-icon"),a(48),r()()(),e(49,"mat-form-field"),d(50,"input",15),e(51,"mat-label"),a(52,"Confirm Password"),r(),e(53,"button",14),c("click",function(){return t.hideConfirmPassword=!t.hideConfirmPassword}),e(54,"mat-icon"),a(55),r()()(),e(56,"div")(57,"button",6),a(58,"Submit"),r()()()()()),o&2&&(s(4),f("formGroup",t.form),s(19),f("formGroup",t.labGroupForm),s(3),S(t.labGroupForm.controls.lab_group.value),s(6),S(t.labGroupQuery==null?null:t.labGroupQuery.results),s(2),f("length",t.labGroupQuery==null?null:t.labGroupQuery.count)("pageSize",t.size),s(7),f("formGroup",t.passwordForm),s(2),f("type",t.hidePassword?"password":"text"),s(3),_("aria-label","Hide password")("aria-pressed",t.hidePassword),s(2),g(t.hidePassword?"visibility_off":"visibility"),s(2),f("type",t.hideConfirmPassword?"password":"text"),s(3),_("aria-label","Hide confirm password")("aria-pressed",t.hideConfirmPassword),s(2),g(t.hideConfirmPassword?"visibility_off":"visibility"))},dependencies:[ee,U,k,E,P,L,F,M,T,z,Q,x,R,V,te,y,re,ie,q,I,B]});let l=n;return l})();var fe=(l,n)=>n.id;function he(l,n){if(l&1&&(e(0,"mat-list-option",13),a(1),r()),l&2){let h=n.$implicit;f("value",h),s(),w(" ",h.name," ")}}var se=(()=>{let n=class n{set token(i){this._token=i,this.form.controls.username.setValue(i.split(":")[0]),this.form.controls.token.setValue(this._token)}get token(){return this._token}constructor(i,o,t){this.webService=i,this.fb=o,this.snackBar=t,this._token="",this.hidePassword=!0,this.hideConfirmPassword=!0,this.form=this.fb.group({email:["",[p.required,p.email]],password:["",[p.required,p.minLength(8)]],confirm_password:["",[p.required,p.minLength(8)]],token:["",p.required],username:["",p.required],first_name:["",p.required],last_name:["",p.required],lab_group:[null],search_lab_group:[""]}),this.labGroupQuery=null,this.limit=5,this.offset=0,this.webService.getLabGroups("",this.limit,this.offset).subscribe(m=>{this.labGroupQuery=m}),this.form.controls.search_lab_group.valueChanges.subscribe(m=>{m&&this.webService.getLabGroups(m,this.limit,this.offset).subscribe(u=>{this.labGroupQuery=u})})}createAccount(){if(this.form.value.password!==this.form.value.confirm_password){this.snackBar.open("Passwords do not match","Close",{duration:2e3});return}this.form.invalid||this.form.value.username&&this.form.value.token&&this.form.value.email&&this.form.value.last_name&&this.form.value.password&&this.form.value.first_name&&this.webService.createUserWithToken(this.form.value.username,this.form.value.token,this.form.value.email,this.form.value.last_name,this.form.value.password,this.form.value.first_name).subscribe(i=>{this.snackBar.open("Account created","Close",{duration:2e3})},i=>{this.snackBar.open("Failed to create account","Close",{duration:2e3})})}onPageChange(i){this.limit=i.pageSize,this.offset=i.pageIndex*this.limit,this.form.controls.search_lab_group.value?this.webService.getLabGroups(this.form.controls.search_lab_group.value,this.limit,this.offset).subscribe(o=>{this.labGroupQuery=o}):this.webService.getLabGroups("",this.limit,this.offset).subscribe(o=>{this.labGroupQuery=o})}};n.\u0275fac=function(o){return new(o||n)(b(D),b(N),b(j))},n.\u0275cmp=C({type:n,selectors:[["app-register"]],inputs:{token:"token"},standalone:!0,features:[G],decls:60,vars:12,consts:[[2,"display","flex","flex-direction","column","align-items","center","gap","20px"],[2,"width","600px"],[2,"display","flex","flex-direction","column","gap","20px","padding","20px",3,"ngSubmit","formGroup"],["matInput","","formControlName","username","placeholder","Username","type","text","readonly",""],["matInput","","formControlName","email","placeholder","Email","type","email"],["matInput","","formControlName","password","placeholder","Password",3,"type"],["mat-icon-button","","matSuffix","",3,"click"],["matInput","","formControlName","confirm_password","placeholder","Confirm Password",3,"type"],["matInput","","formControlName","first_name","placeholder","First Name","type","text"],["matInput","","formControlName","last_name","placeholder","Last Name","type","text"],[2,"display","flex","flex-direction","column","gap","10px"],["matInput","","formControlName","search_lab_group"],["formControlName","lab_group"],[3,"value"],[3,"page","length","pageSize","pageIndex"],["matInput","","formControlName","token","type","text","readonly",""],["mat-raised-button","","color","primary"]],template:function(o,t){o&1&&(e(0,"div",0)(1,"div",1)(2,"h1"),a(3,"User Registration"),r(),e(4,"form",2),c("ngSubmit",function(){return t.createAccount()}),e(5,"mat-form-field"),d(6,"input",3),e(7,"mat-label"),a(8,"Username"),r(),e(9,"mat-hint"),a(10,"Username automatically assigned"),r()(),e(11,"mat-form-field"),d(12,"input",4),e(13,"mat-label"),a(14,"Email"),r(),e(15,"mat-hint"),a(16,"Must be a valid email"),r()(),e(17,"mat-form-field"),d(18,"input",5),e(19,"mat-label"),a(20,"Password"),r(),e(21,"button",6),c("click",function(){return t.hidePassword=!t.hidePassword}),e(22,"mat-icon"),a(23),r()(),e(24,"mat-hint"),a(25,"Password must be at least 8 characters long"),r()(),e(26,"mat-form-field"),d(27,"input",7),e(28,"mat-label"),a(29,"Confirm Password"),r(),e(30,"button",6),c("click",function(){return t.hideConfirmPassword=!t.hideConfirmPassword}),e(31,"mat-icon"),a(32),r()(),e(33,"mat-hint"),a(34,"Confirm password must match"),r()(),e(35,"mat-form-field"),d(36,"input",8),e(37,"mat-label"),a(38,"First Name"),r()(),e(39,"mat-form-field"),d(40,"input",9),e(41,"mat-label"),a(42,"Last Name"),r()(),e(43,"div",10)(44,"mat-form-field"),d(45,"input",11),e(46,"mat-label"),a(47,"Search Lab Group"),r()(),e(48,"mat-selection-list",12),v(49,he,2,2,"mat-list-option",13,fe),r(),e(51,"mat-paginator",14),c("page",function(u){return t.onPageChange(u)}),r()(),e(52,"mat-form-field"),d(53,"input",15),e(54,"mat-label"),a(55,"Registration token"),r(),e(56,"mat-hint"),a(57,"Automatically assigned"),r()(),e(58,"button",16),a(59,"Register"),r()()()()),o&2&&(s(4),f("formGroup",t.form),s(14),f("type",t.hidePassword?"password":"text"),s(3),_("aria-label","Hide password")("aria-pressed",t.hidePassword),s(2),g(t.hidePassword?"visibility_off":"visibility"),s(4),f("type",t.hideConfirmPassword?"password":"text"),s(3),_("aria-label","Hide confirm password")("aria-pressed",t.hideConfirmPassword),s(2),g(t.hideConfirmPassword?"visibility_off":"visibility"),s(17),S(t.labGroupQuery==null?null:t.labGroupQuery.results),s(2),f("length",t.labGroupQuery==null?null:t.labGroupQuery.count)("pageSize",t.limit)("pageIndex",t.offset))},dependencies:[U,k,E,P,L,F,M,Q,z,T,x,y,I,B,Z,R,V,q]});let l=n;return l})();var be=[{path:"",component:ne},{path:"register/:token",component:se}],qe=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=H({type:n}),n.\u0275inj=$({imports:[X,Y.forChild(be)]});let l=n;return l})();export{qe as UserModule};
