import{a as re,b as oe,d as ae}from"./chunk-KARQ7XMH.js";import{a as H}from"./chunk-CW7PRDWL.js";import{a as q,f as D,h as j}from"./chunk-NRWZH6HA.js";import{Ba as U,Ca as N,Da as T,Fa as V,Ha as B,Ia as ie,Ja as Q,Ma as R,Na as z,Qa as A,Sa as $,V as I,W as P,X as E,pa as L,ra as p,ta as M,ua as k,wa as G,ya as F}from"./chunk-VTP4KRAS.js";import"./chunk-3CIC7QKD.js";import{p as te}from"./chunk-7KPORB6Q.js";import{Db as _,Eb as d,Kb as W,Mb as w,Nb as S,Ob as e,Pb as r,Qb as u,Ub as J,Xb as c,Zb as b,bb as X,bc as Z,cd as ee,eb as s,fa as K,fb as h,kc as o,lc as g,mc as x,qa as v,ra as C,rb as y,sb as Y,xb as O}from"./chunk-V2ERZPMC.js";var ne=(n,f)=>f.id;function fe(n,f){if(n&1){let t=J();e(0,"mat-chip",13),c("removed",function(){let i=v(t).$implicit,l=b();return C(l.removeLabGroup(i))}),o(1),e(2,"mat-icon",14),o(3,"cancel"),r()()}if(n&2){let t=f.$implicit;s(),x(" ",t.name," ")}}function he(n,f){if(n&1&&(e(0,"mat-list-option",10),o(1),r()),n&2){let t=f.$implicit;d("value",t),s(),x(" ",t.name," ")}}function be(n,f){if(n&1){let t=J();u(0,"mat-divider"),e(1,"h1"),o(2,"Change Password"),r(),e(3,"form",2),c("ngSubmit",function(){v(t);let i=b(2);return C(i.updatePassword())}),e(4,"mat-form-field"),u(5,"input",15),e(6,"mat-label"),o(7,"Password"),r(),e(8,"button",16),c("click",function(){v(t);let i=b(2);return C(i.hidePassword=!i.hidePassword)}),e(9,"mat-icon"),o(10),r()()(),e(11,"mat-form-field"),u(12,"input",17),e(13,"mat-label"),o(14,"Confirm Password"),r(),e(15,"button",16),c("click",function(){v(t);let i=b(2);return C(i.hideConfirmPassword=!i.hideConfirmPassword)}),e(16,"mat-icon"),o(17),r()()(),e(18,"div")(19,"button",6),o(20,"Submit"),r()()()}if(n&2){let t=b(2);s(3),d("formGroup",t.passwordForm),s(2),d("type",t.hidePassword?"password":"text"),s(3),_("aria-label","Hide password")("aria-pressed",t.hidePassword),s(2),g(t.hidePassword?"visibility_off":"visibility"),s(2),d("type",t.hideConfirmPassword?"password":"text"),s(3),_("aria-label","Hide confirm password")("aria-pressed",t.hideConfirmPassword),s(2),g(t.hideConfirmPassword?"visibility_off":"visibility")}}function _e(n,f){if(n&1&&O(0,be,21,9),n&2){let t=b();W(t.userProfile.created_by_allauth?-1:0)}}var le=(()=>{class n{set user(t){t?(this._user=t,this.form.patchValue({username:this._user.username,first_name:this._user.first_name,last_name:this._user.last_name,email:this._user.email})):this.web.getCurrentUser().subscribe(a=>{this._user=a,this.form.patchValue({username:this._user.username,first_name:this._user.first_name,last_name:this._user.last_name,email:this._user.email})}),this.web.getUserProfile().subscribe(a=>{this.userProfile=a}),this.web.getCurrentUserLabGroups().subscribe(a=>{this.labGroupForm.controls.lab_group.setValue(a)}),this.fetchLabGroups()}get user(){return this._user}constructor(t,a,i){this.fb=t,this.web=a,this.snackBar=i,this._user=null,this.hidePassword=!0,this.hideConfirmPassword=!0,this.form=this.fb.group({username:["",p.required],first_name:["",p.required],last_name:["",p.required],email:["",p.required]}),this.passwordForm=this.fb.group({new_password:["",p.required],confirm_password:["",p.required]}),this.labGroupForm=this.fb.group({lab_group:new G([]),search_term:new G("")}),this.labGroupQuery=null,this.currentIndex=0,this.size=5}updateUser(){this.web.updateUser(this.user.id,this.form.value.email,null,this.form.value.last_name,this.form.value.first_name).subscribe(t=>{this.user=t,this.snackBar.open("User updated","Close",{duration:2e3})},t=>{this.snackBar.open("Error updating user","Close",{duration:2e3})})}updatePassword(){this.web.updateUser(this.user.id,null,this.passwordForm.value.new_password,null,null).subscribe(t=>{this.user=t,this.snackBar.open("Password updated","Close",{duration:2e3})},t=>{this.snackBar.open("Error updating password","Close",{duration:2e3})})}fetchLabGroups(){this.labGroupForm.controls.search_term.value?this.web.getLabGroups(this.labGroupForm.controls.search_term.value,this.size,this.currentIndex).subscribe(t=>{this.labGroupQuery=t}):this.web.getLabGroups(void 0,this.size,this.currentIndex).subscribe(t=>{this.labGroupQuery=t})}removeLabGroup(t){if(!this.labGroupForm.controls.lab_group.value)return;let a=this.labGroupForm.controls.lab_group.value.filter(i=>i.id!==t.id);this.labGroupForm.controls.lab_group.setValue(a)}previousPage(){this.currentIndex>0&&(this.currentIndex-=this.size,this.fetchLabGroups())}nextPage(){this.labGroupQuery&&this.labGroupQuery.results.length===this.size&&(this.currentIndex+=this.size,this.fetchLabGroups())}onLabGroupSelect(t){let a=t.options,i=this.labGroupForm.controls.lab_group.value||[];a.forEach(l=>{let m=l.value;i.some(ue=>ue.id===m.id)||i.push(m)}),this.labGroupForm.controls.lab_group.setValue(i)}onPageChange(t){this.size=t.pageSize,this.currentIndex=t.pageIndex*this.size,this.fetchLabGroups()}updateLabGroups(){this.web.getCurrentUserLabGroups().subscribe(t=>{let a=this.labGroupForm.controls.lab_group.value||[],i=new Set(a.map(m=>m.id)),l=new Set(t.map(m=>m.id));i.forEach(m=>{l.has(m)||this.web.addLabGroupMember(m,this.user.id).subscribe()}),l.forEach(m=>{i.has(m)||this.web.removeLabGroupMember(m,this.user.id).subscribe()})})}static{this.\u0275fac=function(a){return new(a||n)(h(T),h($),h(H))}}static{this.\u0275cmp=y({type:n,selectors:[["app-user"]],inputs:{user:"user"},decls:39,vars:5,consts:[[2,"display","flex","flex-direction","column","align-items","center","gap","20px"],[2,"width","600px"],[2,"display","flex","flex-direction","column","gap","20px","padding","20px",3,"ngSubmit","formGroup"],["matInput","","formControlName","first_name"],["matInput","","formControlName","last_name"],["matInput","","formControlName","email"],["mat-raised-button","","color","primary","type","submit"],[2,"display","flex","flex-direction","column","gap","20px","padding","20px",3,"formGroup"],["matInput","","formControlName","search_term",3,"input"],[3,"selectionChange"],[3,"value"],[3,"page","length","pageSize"],["mat-raised-button","","color","primary",3,"click"],[3,"removed"],["matChipRemove",""],["matInput","","formControlName","new_password","placeholder","Password",3,"type"],["mat-icon-button","","matSuffix","",3,"click"],["matInput","","formControlName","confirm_password","placeholder","Confirm Password",3,"type"]],template:function(a,i){a&1&&(e(0,"div",0)(1,"div",1)(2,"h1"),o(3,"Basic Information"),r(),e(4,"form",2),c("ngSubmit",function(){return i.updateUser()}),e(5,"mat-form-field"),u(6,"input",3),e(7,"mat-label"),o(8,"First Name"),r()(),e(9,"mat-form-field"),u(10,"input",4),e(11,"mat-label"),o(12,"Last Name"),r()(),e(13,"mat-form-field"),u(14,"input",5),e(15,"mat-label"),o(16,"Email Address"),r()(),e(17,"div")(18,"button",6),o(19,"Update Basic Information"),r()()(),u(20,"mat-divider"),e(21,"h1"),o(22,"Lab Group"),r(),e(23,"form",7),o(24," User Belongs To Lab Groups: "),e(25,"mat-chip-set"),w(26,fe,4,1,"mat-chip",null,ne),r(),o(28," Search Lab Groups: "),e(29,"mat-form-field")(30,"input",8),c("input",function(){return i.fetchLabGroups()}),r()(),e(31,"mat-selection-list",9),c("selectionChange",function(m){return i.onLabGroupSelect(m)}),w(32,he,2,2,"mat-list-option",10,ne),r(),e(34,"mat-paginator",11),c("page",function(m){return i.onPageChange(m)}),r(),e(35,"div")(36,"button",12),c("click",function(){return i.updateLabGroups()}),o(37,"Update Lab Groups"),r()()(),O(38,_e,1,1),r()()),a&2&&(s(4),d("formGroup",i.form),s(19),d("formGroup",i.labGroupForm),s(3),S(i.labGroupForm.controls.lab_group.value),s(6),S(i.labGroupQuery==null?null:i.labGroupQuery.results),s(2),d("length",i.labGroupQuery==null?null:i.labGroupQuery.count)("pageSize",i.size),s(4),W(i.userProfile?38:-1))},dependencies:[q,V,F,L,M,k,U,N,B,z,R,P,D,j,re,I,ae,oe,A,E,Q],encapsulation:2})}}return n})();var ge=(n,f)=>f.id;function ve(n,f){if(n&1&&(e(0,"mat-list-option",15),o(1),r()),n&2){let t=f.$implicit;d("value",t),s(),x(" ",t.name," ")}}var me=(()=>{class n{set token(t){this._token=t,this.form.controls.username.setValue(t.split(":")[0]);let a=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;this.form.controls.username.value&&a.test(this.form.controls.username.value)&&this.form.controls.email.setValue(this.form.controls.username.value),this.form.controls.token.setValue(this._token)}get token(){return this._token}constructor(t,a,i){this.webService=t,this.fb=a,this.snackBar=i,this._token="",this.hidePassword=!0,this.hideConfirmPassword=!0,this.form=this.fb.group({email:["",[p.required,p.email]],password:["",[p.required,p.minLength(8)]],confirm_password:["",[p.required,p.minLength(8)]],token:["",p.required],username:["",p.required],first_name:["",p.required],last_name:["",p.required],lab_group:new G([]),search_lab_group:[""]}),this.labGroupQuery=null,this.limit=5,this.offset=0,this.webService.getLabGroups("",this.limit,this.offset).subscribe(l=>{this.labGroupQuery=l}),this.form.controls.search_lab_group.valueChanges.subscribe(l=>{l&&this.webService.getLabGroups(l,this.limit,this.offset).subscribe(m=>{this.labGroupQuery=m})})}createAccount(){if(this.form.value.password!==this.form.value.confirm_password){this.snackBar.open("Passwords do not match","Close",{duration:2e3});return}this.form.invalid||this.form.value.username&&this.form.value.token&&this.form.value.email&&this.form.value.last_name&&this.form.value.password&&this.form.value.first_name&&this.webService.createUserWithToken(this.form.value.username,this.form.value.token,this.form.value.email,this.form.value.last_name,this.form.value.password,this.form.value.first_name,this.form.value.lab_group).subscribe(t=>{this.snackBar.open("Account created","Close",{duration:2e3})},t=>{this.snackBar.open("Failed to create account","Close",{duration:2e3})})}onPageChange(t){this.limit=t.pageSize,this.offset=t.pageIndex*this.limit,this.form.controls.search_lab_group.value?this.webService.getLabGroups(this.form.controls.search_lab_group.value,this.limit,this.offset).subscribe(a=>{this.labGroupQuery=a}):this.webService.getLabGroups("",this.limit,this.offset).subscribe(a=>{this.labGroupQuery=a})}static{this.\u0275fac=function(a){return new(a||n)(h($),h(T),h(H))}}static{this.\u0275cmp=y({type:n,selectors:[["app-register"]],inputs:{token:"token"},decls:66,vars:15,consts:[[2,"display","flex","flex-direction","column","align-items","center","gap","20px"],[2,"width","600px"],[3,"href"],[2,"color","#ba0000"],[2,"display","flex","flex-direction","column","gap","20px","padding","20px",3,"ngSubmit","formGroup"],["matInput","","formControlName","username","placeholder","Username","type","text","readonly",""],["matInput","","formControlName","email","placeholder","Email","type","email"],["matInput","","formControlName","password","placeholder","Password",3,"type"],["mat-icon-button","","matSuffix","",3,"click"],["matInput","","formControlName","confirm_password","placeholder","Confirm Password",3,"type"],["matInput","","formControlName","first_name","placeholder","First Name","type","text"],["matInput","","formControlName","last_name","placeholder","Last Name","type","text"],[2,"display","flex","flex-direction","column","gap","10px"],["matInput","","formControlName","search_lab_group"],["formControlName","lab_group",3,"multiple"],[3,"value"],[3,"page","length","pageSize","pageIndex"],["matInput","","formControlName","token","type","text","readonly",""],["mat-raised-button","","color","primary"]],template:function(a,i){a&1&&(e(0,"div",0)(1,"div",1)(2,"h1")(3,"a",2)(4,"span",3),o(5,"Registration"),r()()(),e(6,"form",4),c("ngSubmit",function(){return i.createAccount()}),e(7,"mat-form-field"),u(8,"input",5),e(9,"mat-label"),o(10,"Username"),r(),e(11,"mat-hint"),o(12,"Username automatically assigned"),r()(),e(13,"mat-form-field"),u(14,"input",6),e(15,"mat-label"),o(16,"Email"),r(),e(17,"mat-hint"),o(18,"Must be a valid email"),r()(),e(19,"mat-form-field"),u(20,"input",7),e(21,"mat-label"),o(22,"Password"),r(),e(23,"button",8),c("click",function(){return i.hidePassword=!i.hidePassword}),e(24,"mat-icon"),o(25),r()(),e(26,"mat-hint"),o(27,"Password must be at least 8 characters long"),r()(),e(28,"mat-form-field"),u(29,"input",9),e(30,"mat-label"),o(31,"Confirm Password"),r(),e(32,"button",8),c("click",function(){return i.hideConfirmPassword=!i.hideConfirmPassword}),e(33,"mat-icon"),o(34),r()(),e(35,"mat-hint"),o(36,"Confirm password must match"),r()(),e(37,"mat-form-field"),u(38,"input",10),e(39,"mat-label"),o(40,"First Name"),r()(),e(41,"mat-form-field"),u(42,"input",11),e(43,"mat-label"),o(44,"Last Name"),r()(),u(45,"mat-divider"),e(46,"div",12)(47,"div"),o(48," Lab Group Selection: "),r(),e(49,"mat-form-field"),u(50,"input",13),e(51,"mat-label"),o(52,"Search Lab Group"),r()(),e(53,"mat-selection-list",14),w(54,ve,2,2,"mat-list-option",15,ge),r(),e(56,"mat-paginator",16),c("page",function(m){return i.onPageChange(m)}),r()(),u(57,"mat-divider"),e(58,"mat-form-field"),u(59,"input",17),e(60,"mat-label"),o(61,"Registration token"),r(),e(62,"mat-hint"),o(63,"Automatically assigned"),r()(),e(64,"button",18),o(65,"Register"),r()()()()),a&2&&(s(3),Z("href","/#/user/register/",i.token,"",X),s(3),d("formGroup",i.form),s(14),d("type",i.hidePassword?"password":"text"),s(3),_("aria-label","Hide password")("aria-pressed",i.hidePassword),s(2),g(i.hidePassword?"visibility_off":"visibility"),s(4),d("type",i.hideConfirmPassword?"password":"text"),s(3),_("aria-label","Hide confirm password")("aria-pressed",i.hideConfirmPassword),s(2),g(i.hideConfirmPassword?"visibility_off":"visibility"),s(19),d("multiple",!1),s(),S(i.labGroupQuery==null?null:i.labGroupQuery.results),s(2),d("length",i.labGroupQuery==null?null:i.labGroupQuery.count)("pageSize",i.limit)("pageIndex",i.offset))},dependencies:[V,F,L,M,k,U,N,R,z,B,P,I,E,Q,ie,D,j,A,q],encapsulation:2})}}return n})();var Ce=[{path:"",component:le},{path:"register/:token",component:me}],He=(()=>{class n{static{this.\u0275fac=function(a){return new(a||n)}}static{this.\u0275mod=Y({type:n})}static{this.\u0275inj=K({imports:[ee,te.forChild(Ce)]})}}return n})();export{He as UserModule};
