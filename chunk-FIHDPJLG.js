import{a as W}from"./chunk-A6LUJ5IH.js";import{za as x}from"./chunk-3ISCNT2B.js";import{ea as w,g as m,h as k,j as d,ja as g,m as S,n as y,p as l}from"./chunk-SHGYA7ZZ.js";var E={url:"",deserializer:a=>JSON.parse(a.data),serializer:a=>JSON.stringify(a)},O="WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }",b=class a extends y{constructor(t,n){if(super(),this._socket=null,t instanceof d)this.destination=n,this.source=t;else{let e=this._config=Object.assign({},E);if(this._output=new S,typeof t=="string")e.url=t;else for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);if(!e.WebSocketCtor&&WebSocket)e.WebSocketCtor=WebSocket;else if(!e.WebSocketCtor)throw new Error("no WebSocket constructor can be found");this.destination=new l}}lift(t){let n=new a(this._config,this.destination);return n.operator=t,n.source=this,n}_resetState(){this._socket=null,this.source||(this.destination=new l),this._output=new S}multiplex(t,n,e){let i=this;return new d(o=>{try{i.next(t())}catch(c){o.error(c)}let s=i.subscribe({next:c=>{try{e(c)&&o.next(c)}catch(r){o.error(r)}},error:c=>o.error(c),complete:()=>o.complete()});return()=>{try{i.next(n())}catch(c){o.error(c)}s.unsubscribe()}})}_connectSocket(){let{WebSocketCtor:t,protocol:n,url:e,binaryType:i}=this._config,o=this._output,s=null;try{s=n?new t(e,n):new t(e),this._socket=s,i&&(this._socket.binaryType=i)}catch(r){o.error(r);return}let c=new m(()=>{this._socket=null,s&&s.readyState===1&&s.close()});s.onopen=r=>{let{_socket:u}=this;if(!u){s.close(),this._resetState();return}let{openObserver:_}=this._config;_&&_.next(r);let p=this.destination;this.destination=k.create(h=>{if(s.readyState===1)try{let{serializer:f}=this._config;s.send(f(h))}catch(f){this.destination.error(f)}},h=>{let{closingObserver:f}=this._config;f&&f.next(void 0),h&&h.code?s.close(h.code,h.reason):o.error(new TypeError(O)),this._resetState()},()=>{let{closingObserver:h}=this._config;h&&h.next(void 0),s.close(),this._resetState()}),p&&p instanceof l&&c.add(p.subscribe(this.destination))},s.onerror=r=>{this._resetState(),o.error(r)},s.onclose=r=>{s===this._socket&&this._resetState();let{closeObserver:u}=this._config;u&&u.next(r),r.wasClean?o.complete():o.error(r)},s.onmessage=r=>{try{let{deserializer:u}=this._config;o.next(u(r))}catch(u){o.error(u)}}}_subscribe(t){let{source:n}=this;return n?n.subscribe(t):(this._socket||this._connectSocket(),this._output.subscribe(t),t.add(()=>{let{_socket:e}=this;this._output.observers.length===0&&(e&&(e.readyState===1||e.readyState===0)&&e.close(),this._resetState())}),t)}unsubscribe(){let{_socket:t}=this;t&&(t.readyState===1||t.readyState===0)&&t.close(),this._resetState(),super.unsubscribe()}};var B=(()=>{let t=class t{constructor(e){this.accounts=e,this.baseURL=x.baseURL.replace("http","ws")}connectSearchWS(e){this.searchWSConnection=new b({url:`${this.baseURL}/ws/search/${e}/?token=${this.accounts.token}`,openObserver:{next:()=>{console.log("Connected to search websocket")}},closeObserver:{next:()=>{console.log("Closed connection to search websocket")}}})}closeSearchWS(){this.searchWSConnection&&this.searchWSConnection.unsubscribe()}};t.\u0275fac=function(i){return new(i||t)(g(W))},t.\u0275prov=w({token:t,factory:t.\u0275fac,providedIn:"root"});let a=t;return a})();export{B as a};
