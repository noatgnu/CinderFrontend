import{a as Le,b as qt,c as ae,d as oe,e as re,f as le}from"./chunk-K4YNXZPA.js";import{a as St}from"./chunk-VRTDKVJQ.js";import{a as Lt,b as Li,c as We,d as ge,e as Qe,f as Je,g as Ze,h as ti,i as ei}from"./chunk-742N5BBS.js";import{a as Xe,b as pe,c as de,d as ue}from"./chunk-RGZJJD2X.js";import{a as Nt}from"./chunk-LDVA2FBO.js";import{a as zt}from"./chunk-SPRJMRVK.js";import{b as Ke,c as Ye}from"./chunk-KJAGX5TY.js";import{a as Pe,b as Re,c as $e,d as Be,e as Ue,f as je,g as He,h as Oe,i as qe,j as ze}from"./chunk-VK4ZCWZV.js";import{g as se,h as ce}from"./chunk-MHEZ5PLA.js";import{a as Vt}from"./chunk-IOQZKRPJ.js";import{a as ne,c as Ie,f as ke,h as Ve}from"./chunk-5VEOMT4C.js";import{a as rt,c as te,d as lt,e as st,f as ct,g as me}from"./chunk-NYRSFDTJ.js";import{Ba as tt,Ca as et,Da as it,Ea as kt,Fa as X,Ha as nt,Ia as ie,Ja as Te,Ma as at,Na as pt,Oa as Ct,Pa as Ne,Q as dt,Sa as Q,V as Mt,W as O,X as vt,pa as mt,ra as R,ta as Z,ua as Y,wa as I,ya as W,za as ee}from"./chunk-S5BPLZ7M.js";import{h as Ee}from"./chunk-H7YWWURD.js";import{Aa as z,Eb as y,H as Se,Kb as v,Lb as k,Mb as E,Nb as T,Ob as r,Pb as l,Qb as V,Rb as Ut,Sb as jt,Ub as N,Xb as x,Z as Fe,Zb as u,_ as De,ac as Jt,ad as Zt,bb as ye,bc as Ae,cc as Ge,e as Ni,eb as m,ec as Et,f as wt,fc as Tt,gc as It,jc as K,kb as G,kc as c,lc as L,mc as $,qa as b,ra as w,rb as j,sc as xe,t as ht,vc as Ht,wc as Ot,x as J,xb as F}from"./chunk-DS46NKJA.js";var Pi=(n,a)=>a.id;function Ri(n,a){if(n&1){let t=N();r(0,"mat-list-option",1),x("click",function(){let i=b(t).$implicit,o=u(2);return w(o.selectAnalysisGroup(i))}),r(1,"b"),c(2),l(),r(3,"span",2),c(4),l()(),V(5,"mat-divider")}if(n&2){let t=a.$implicit,e=u(2);y("value",t),m(2),L(t.name),m(2),$(" ",e.dataService.getAnalysisGroupTypeLabel(t.analysis_group_type)," ")}}function $i(n,a){if(n&1&&(r(0,"mat-selection-list",0),E(1,Ri,6,3,null,null,Pi),l()),n&2){let t=u();y("multiple",!1),m(),T(t.analysisGroupQuery.results)}}var Ao=(()=>{class n{constructor(t){this.dataService=t,this.selectedAnalysisGroup=new z}selectAnalysisGroup(t){this.selectedAnalysisGroup.emit(t)}static{this.\u0275fac=function(e){return new(e||n)(G(St))}}static{this.\u0275cmp=j({type:n,selectors:[["app-analysis-group-list"]],inputs:{analysisGroupQuery:"analysisGroupQuery"},outputs:{selectedAnalysisGroup:"selectedAnalysisGroup"},decls:1,vars:1,consts:[[3,"multiple"],[3,"click","value"],["matListItemLine",""]],template:function(e,i){e&1&&F(0,$i,3,1,"mat-selection-list",0),e&2&&v(i.analysisGroupQuery?0:-1)},dependencies:[ne,ke,Ve,Ie],encapsulation:2})}}return n})();var di="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ui="ARRAYBUFFER not supported by this environment",_i="UINT8ARRAY not supported by this environment";function ii(n,a,t,e){let i,o,s,d=a||[0],p=(t=t||0)>>>3,f=e===-1?3:0;for(i=0;i<n.length;i+=1)s=i+p,o=s>>>2,d.length<=o&&d.push(0),d[o]|=n[i]<<8*(f+e*(s%4));return{value:d,binLen:8*n.length+t}}function Bt(n,a,t){switch(a){case"UTF8":case"UTF16BE":case"UTF16LE":break;default:throw new Error("encoding must be UTF8, UTF16BE, or UTF16LE")}switch(n){case"HEX":return function(e,i,o){return function(s,d,p,f){let C,h,g,D;if(s.length%2!=0)throw new Error("String of HEX type must be in byte increments");let A=d||[0],P=(p=p||0)>>>3,B=f===-1?3:0;for(C=0;C<s.length;C+=2){if(h=parseInt(s.substr(C,2),16),isNaN(h))throw new Error("String of HEX type contains invalid characters");for(D=(C>>>1)+P,g=D>>>2;A.length<=g;)A.push(0);A[g]|=h<<8*(B+f*(D%4))}return{value:A,binLen:4*s.length+p}}(e,i,o,t)};case"TEXT":return function(e,i,o){return function(s,d,p,f,C){let h,g,D,A,P,B,M,H,U=0,q=p||[0],_t=(f=f||0)>>>3;if(d==="UTF8")for(M=C===-1?3:0,D=0;D<s.length;D+=1)for(h=s.charCodeAt(D),g=[],128>h?g.push(h):2048>h?(g.push(192|h>>>6),g.push(128|63&h)):55296>h||57344<=h?g.push(224|h>>>12,128|h>>>6&63,128|63&h):(D+=1,h=65536+((1023&h)<<10|1023&s.charCodeAt(D)),g.push(240|h>>>18,128|h>>>12&63,128|h>>>6&63,128|63&h)),A=0;A<g.length;A+=1){for(B=U+_t,P=B>>>2;q.length<=P;)q.push(0);q[P]|=g[A]<<8*(M+C*(B%4)),U+=1}else for(M=C===-1?2:0,H=d==="UTF16LE"&&C!==1||d!=="UTF16LE"&&C===1,D=0;D<s.length;D+=1){for(h=s.charCodeAt(D),H===!0&&(A=255&h,h=A<<8|h>>>8),B=U+_t,P=B>>>2;q.length<=P;)q.push(0);q[P]|=h<<8*(M+C*(B%4)),U+=2}return{value:q,binLen:8*U+f}}(e,a,i,o,t)};case"B64":return function(e,i,o){return function(s,d,p,f){let C,h,g,D,A,P,B,M=0,H=d||[0],U=(p=p||0)>>>3,q=f===-1?3:0,_t=s.indexOf("=");if(s.search(/^[a-zA-Z0-9=+/]+$/)===-1)throw new Error("Invalid character in base-64 string");if(s=s.replace(/=/g,""),_t!==-1&&_t<s.length)throw new Error("Invalid '=' found in base-64 string");for(h=0;h<s.length;h+=4){for(A=s.substr(h,4),D=0,g=0;g<A.length;g+=1)C=di.indexOf(A.charAt(g)),D|=C<<18-6*g;for(g=0;g<A.length-1;g+=1){for(B=M+U,P=B>>>2;H.length<=P;)H.push(0);H[P]|=(D>>>16-8*g&255)<<8*(q+f*(B%4)),M+=1}}return{value:H,binLen:8*M+p}}(e,i,o,t)};case"BYTES":return function(e,i,o){return function(s,d,p,f){let C,h,g,D,A=d||[0],P=(p=p||0)>>>3,B=f===-1?3:0;for(h=0;h<s.length;h+=1)C=s.charCodeAt(h),D=h+P,g=D>>>2,A.length<=g&&A.push(0),A[g]|=C<<8*(B+f*(D%4));return{value:A,binLen:8*s.length+p}}(e,i,o,t)};case"ARRAYBUFFER":try{new ArrayBuffer(0)}catch{throw new Error(ui)}return function(e,i,o){return function(s,d,p,f){return ii(new Uint8Array(s),d,p,f)}(e,i,o,t)};case"UINT8ARRAY":try{new Uint8Array(0)}catch{throw new Error(_i)}return function(e,i,o){return ii(e,i,o,t)};default:throw new Error("format must be HEX, TEXT, B64, BYTES, ARRAYBUFFER, or UINT8ARRAY")}}function ni(n,a,t,e){switch(n){case"HEX":return function(i){return function(o,s,d,p){let f="0123456789abcdef",C,h,g="",D=s/8,A=d===-1?3:0;for(C=0;C<D;C+=1)h=o[C>>>2]>>>8*(A+d*(C%4)),g+=f.charAt(h>>>4&15)+f.charAt(15&h);return p.outputUpper?g.toUpperCase():g}(i,a,t,e)};case"B64":return function(i){return function(o,s,d,p){let f,C,h,g,D,A="",P=s/8,B=d===-1?3:0;for(f=0;f<P;f+=3)for(g=f+1<P?o[f+1>>>2]:0,D=f+2<P?o[f+2>>>2]:0,h=(o[f>>>2]>>>8*(B+d*(f%4))&255)<<16|(g>>>8*(B+d*((f+1)%4))&255)<<8|D>>>8*(B+d*((f+2)%4))&255,C=0;C<4;C+=1)A+=8*f+6*C<=s?di.charAt(h>>>6*(3-C)&63):p.b64Pad;return A}(i,a,t,e)};case"BYTES":return function(i){return function(o,s,d){let p,f,C="",h=s/8,g=d===-1?3:0;for(p=0;p<h;p+=1)f=o[p>>>2]>>>8*(g+d*(p%4))&255,C+=String.fromCharCode(f);return C}(i,a,t)};case"ARRAYBUFFER":try{new ArrayBuffer(0)}catch{throw new Error(ui)}return function(i){return function(o,s,d){let p,f=s/8,C=new ArrayBuffer(f),h=new Uint8Array(C),g=d===-1?3:0;for(p=0;p<f;p+=1)h[p]=o[p>>>2]>>>8*(g+d*(p%4))&255;return C}(i,a,t)};case"UINT8ARRAY":try{new Uint8Array(0)}catch{throw new Error(_i)}return function(i){return function(o,s,d){let p,f=s/8,C=d===-1?3:0,h=new Uint8Array(f);for(p=0;p<f;p+=1)h[p]=o[p>>>2]>>>8*(C+d*(p%4))&255;return h}(i,a,t)};default:throw new Error("format must be HEX, B64, BYTES, ARRAYBUFFER, or UINT8ARRAY")}}var Wt=4294967296,S=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],gt=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428],bt=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],Xt="Chosen SHA variant is not supported",fi="Cannot set numRounds with MAC";function fe(n,a){let t,e,i=n.binLen>>>3,o=a.binLen>>>3,s=i<<3,d=4-i<<3;if(i%4!=0){for(t=0;t<o;t+=4)e=i+t>>>2,n.value[e]|=a.value[t>>>2]<<s,n.value.push(0),n.value[e+1]|=a.value[t>>>2]>>>d;return(n.value.length<<2)-4>=o+i&&n.value.pop(),{value:n.value,binLen:n.binLen+a.binLen}}return{value:n.value.concat(a.value),binLen:n.binLen+a.binLen}}function ai(n){let a={outputUpper:!1,b64Pad:"=",outputLen:-1},t=n||{},e="Output length must be a multiple of 8";if(a.outputUpper=t.outputUpper||!1,t.b64Pad&&(a.b64Pad=t.b64Pad),t.outputLen){if(t.outputLen%8!=0)throw new Error(e);a.outputLen=t.outputLen}else if(t.shakeLen){if(t.shakeLen%8!=0)throw new Error(e);a.outputLen=t.shakeLen}if(typeof a.outputUpper!="boolean")throw new Error("Invalid outputUpper formatting option");if(typeof a.b64Pad!="string")throw new Error("Invalid b64Pad formatting option");return a}function Ft(n,a,t,e){let i=n+" must include a value and format";if(!a){if(!e)throw new Error(i);return e}if(a.value===void 0||!a.format)throw new Error(i);return Bt(a.format,a.encoding||"UTF8",t)(a.value)}var Rt=class{constructor(a,t,e){let i=e||{};if(this.t=t,this.i=i.encoding||"UTF8",this.numRounds=i.numRounds||1,isNaN(this.numRounds)||this.numRounds!==parseInt(this.numRounds,10)||1>this.numRounds)throw new Error("numRounds must a integer >= 1");this.o=a,this.h=[],this.u=0,this.l=!1,this.A=0,this.H=!1,this.S=[],this.p=[]}update(a){let t,e=0,i=this.m>>>5,o=this.C(a,this.h,this.u),s=o.binLen,d=o.value,p=s>>>5;for(t=0;t<p;t+=i)e+this.m<=s&&(this.U=this.v(d.slice(t,t+i),this.U),e+=this.m);return this.A+=e,this.h=d.slice(e>>>5),this.u=s%this.m,this.l=!0,this}getHash(a,t){let e,i,o=this.R,s=ai(t);if(this.K){if(s.outputLen===-1)throw new Error("Output length must be specified in options");o=s.outputLen}let d=ni(a,o,this.T,s);if(this.H&&this.g)return d(this.g(s));for(i=this.F(this.h.slice(),this.u,this.A,this.L(this.U),o),e=1;e<this.numRounds;e+=1)this.K&&o%32!=0&&(i[i.length-1]&=16777215>>>24-o%32),i=this.F(i,o,0,this.B(this.o),o);return d(i)}setHMACKey(a,t,e){if(!this.M)throw new Error("Variant does not support HMAC");if(this.l)throw new Error("Cannot set MAC key after calling update");let i=Bt(t,(e||{}).encoding||"UTF8",this.T);this.k(i(a))}k(a){let t=this.m>>>3,e=t/4-1,i;if(this.numRounds!==1)throw new Error(fi);if(this.H)throw new Error("MAC key already set");for(t<a.binLen/8&&(a.value=this.F(a.value,a.binLen,0,this.B(this.o),this.R));a.value.length<=e;)a.value.push(0);for(i=0;i<=e;i+=1)this.S[i]=909522486^a.value[i],this.p[i]=1549556828^a.value[i];this.U=this.v(this.S,this.U),this.A=this.m,this.H=!0}getHMAC(a,t){let e=ai(t);return ni(a,this.R,this.T,e)(this.Y())}Y(){let a;if(!this.H)throw new Error("Cannot call getHMAC without first setting MAC key");let t=this.F(this.h.slice(),this.u,this.A,this.L(this.U),this.R);return a=this.v(this.p,this.B(this.o)),a=this.F(t,this.R,this.m,a,this.R),a}};function Pt(n,a){return n<<a|n>>>32-a}function yt(n,a){return n>>>a|n<<32-a}function hi(n,a){return n>>>a}function oi(n,a,t){return n^a^t}function Ci(n,a,t){return n&a^~n&t}function yi(n,a,t){return n&a^n&t^a&t}function Bi(n){return yt(n,2)^yt(n,13)^yt(n,22)}function ot(n,a){let t=(65535&n)+(65535&a);return(65535&(n>>>16)+(a>>>16)+(t>>>16))<<16|65535&t}function Ui(n,a,t,e){let i=(65535&n)+(65535&a)+(65535&t)+(65535&e);return(65535&(n>>>16)+(a>>>16)+(t>>>16)+(e>>>16)+(i>>>16))<<16|65535&i}function Yt(n,a,t,e,i){let o=(65535&n)+(65535&a)+(65535&t)+(65535&e)+(65535&i);return(65535&(n>>>16)+(a>>>16)+(t>>>16)+(e>>>16)+(i>>>16)+(o>>>16))<<16|65535&o}function ji(n){return yt(n,7)^yt(n,18)^hi(n,3)}function Hi(n){return yt(n,6)^yt(n,11)^yt(n,25)}function Oi(n){return[1732584193,4023233417,2562383102,271733878,3285377520]}function xi(n,a){let t,e,i,o,s,d,p,f=[];for(t=a[0],e=a[1],i=a[2],o=a[3],s=a[4],p=0;p<80;p+=1)f[p]=p<16?n[p]:Pt(f[p-3]^f[p-8]^f[p-14]^f[p-16],1),d=p<20?Yt(Pt(t,5),Ci(e,i,o),s,1518500249,f[p]):p<40?Yt(Pt(t,5),oi(e,i,o),s,1859775393,f[p]):p<60?Yt(Pt(t,5),yi(e,i,o),s,2400959708,f[p]):Yt(Pt(t,5),oi(e,i,o),s,3395469782,f[p]),s=o,o=i,i=Pt(e,30),e=t,t=d;return a[0]=ot(t,a[0]),a[1]=ot(e,a[1]),a[2]=ot(i,a[2]),a[3]=ot(o,a[3]),a[4]=ot(s,a[4]),a}function qi(n,a,t,e){let i,o=15+(a+65>>>9<<4),s=a+t;for(;n.length<=o;)n.push(0);for(n[a>>>5]|=128<<24-a%32,n[o]=4294967295&s,n[o-1]=s/Wt|0,i=0;i<n.length;i+=16)e=xi(n.slice(i,i+16),e);return e}var zi=class extends Rt{constructor(n,a,t){if(n!=="SHA-1")throw new Error(Xt);super(n,a,t);let e=t||{};this.M=!0,this.g=this.Y,this.T=-1,this.C=Bt(this.t,this.i,this.T),this.v=xi,this.L=function(i){return i.slice()},this.B=Oi,this.F=qi,this.U=[1732584193,4023233417,2562383102,271733878,3285377520],this.m=512,this.R=160,this.K=!1,e.hmacKey&&this.k(Ft("hmacKey",e.hmacKey,this.T))}};function ri(n){let a;return a=n=="SHA-224"?gt.slice():bt.slice(),a}function li(n,a){let t,e,i,o,s,d,p,f,C,h,g,D=[];for(t=a[0],e=a[1],i=a[2],o=a[3],s=a[4],d=a[5],p=a[6],f=a[7],g=0;g<64;g+=1)D[g]=g<16?n[g]:Ui(yt(A=D[g-2],17)^yt(A,19)^hi(A,10),D[g-7],ji(D[g-15]),D[g-16]),C=Yt(f,Hi(s),Ci(s,d,p),S[g],D[g]),h=ot(Bi(t),yi(t,e,i)),f=p,p=d,d=s,s=ot(o,C),o=i,i=e,e=t,t=ot(C,h);var A;return a[0]=ot(t,a[0]),a[1]=ot(e,a[1]),a[2]=ot(i,a[2]),a[3]=ot(o,a[3]),a[4]=ot(s,a[4]),a[5]=ot(d,a[5]),a[6]=ot(p,a[6]),a[7]=ot(f,a[7]),a}var Ki=class extends Rt{constructor(n,a,t){if(n!=="SHA-224"&&n!=="SHA-256")throw new Error(Xt);super(n,a,t);let e=t||{};this.g=this.Y,this.M=!0,this.T=-1,this.C=Bt(this.t,this.i,this.T),this.v=li,this.L=function(i){return i.slice()},this.B=ri,this.F=function(i,o,s,d){return function(p,f,C,h,g){let D,A,P=15+(f+65>>>9<<4),B=f+C;for(;p.length<=P;)p.push(0);for(p[f>>>5]|=128<<24-f%32,p[P]=4294967295&B,p[P-1]=B/Wt|0,D=0;D<p.length;D+=16)h=li(p.slice(D,D+16),h);return A=g==="SHA-224"?[h[0],h[1],h[2],h[3],h[4],h[5],h[6]]:h,A}(i,o,s,d,n)},this.U=ri(n),this.m=512,this.R=n==="SHA-224"?224:256,this.K=!1,e.hmacKey&&this.k(Ft("hmacKey",e.hmacKey,this.T))}},_=class{constructor(a,t){this.N=a,this.I=t}};function si(n,a){let t;return a>32?(t=64-a,new _(n.I<<a|n.N>>>t,n.N<<a|n.I>>>t)):a!==0?(t=32-a,new _(n.N<<a|n.I>>>t,n.I<<a|n.N>>>t)):n}function xt(n,a){let t;return a<32?(t=32-a,new _(n.N>>>a|n.I<<t,n.I>>>a|n.N<<t)):(t=64-a,new _(n.I>>>a|n.N<<t,n.N>>>a|n.I<<t))}function gi(n,a){return new _(n.N>>>a,n.I>>>a|n.N<<32-a)}function Yi(n,a,t){return new _(n.N&a.N^n.N&t.N^a.N&t.N,n.I&a.I^n.I&t.I^a.I&t.I)}function Wi(n){let a=xt(n,28),t=xt(n,34),e=xt(n,39);return new _(a.N^t.N^e.N,a.I^t.I^e.I)}function ft(n,a){let t,e;t=(65535&n.I)+(65535&a.I),e=(n.I>>>16)+(a.I>>>16)+(t>>>16);let i=(65535&e)<<16|65535&t;return t=(65535&n.N)+(65535&a.N)+(e>>>16),e=(n.N>>>16)+(a.N>>>16)+(t>>>16),new _((65535&e)<<16|65535&t,i)}function Xi(n,a,t,e){let i,o;i=(65535&n.I)+(65535&a.I)+(65535&t.I)+(65535&e.I),o=(n.I>>>16)+(a.I>>>16)+(t.I>>>16)+(e.I>>>16)+(i>>>16);let s=(65535&o)<<16|65535&i;return i=(65535&n.N)+(65535&a.N)+(65535&t.N)+(65535&e.N)+(o>>>16),o=(n.N>>>16)+(a.N>>>16)+(t.N>>>16)+(e.N>>>16)+(i>>>16),new _((65535&o)<<16|65535&i,s)}function Qi(n,a,t,e,i){let o,s;o=(65535&n.I)+(65535&a.I)+(65535&t.I)+(65535&e.I)+(65535&i.I),s=(n.I>>>16)+(a.I>>>16)+(t.I>>>16)+(e.I>>>16)+(i.I>>>16)+(o>>>16);let d=(65535&s)<<16|65535&o;return o=(65535&n.N)+(65535&a.N)+(65535&t.N)+(65535&e.N)+(65535&i.N)+(s>>>16),s=(n.N>>>16)+(a.N>>>16)+(t.N>>>16)+(e.N>>>16)+(i.N>>>16)+(o>>>16),new _((65535&s)<<16|65535&o,d)}function Kt(n,a){return new _(n.N^a.N,n.I^a.I)}function Ji(n){let a=xt(n,19),t=xt(n,61),e=gi(n,6);return new _(a.N^t.N^e.N,a.I^t.I^e.I)}function Zi(n){let a=xt(n,1),t=xt(n,8),e=gi(n,7);return new _(a.N^t.N^e.N,a.I^t.I^e.I)}function tn(n){let a=xt(n,14),t=xt(n,18),e=xt(n,41);return new _(a.N^t.N^e.N,a.I^t.I^e.I)}var en=[new _(S[0],3609767458),new _(S[1],602891725),new _(S[2],3964484399),new _(S[3],2173295548),new _(S[4],4081628472),new _(S[5],3053834265),new _(S[6],2937671579),new _(S[7],3664609560),new _(S[8],2734883394),new _(S[9],1164996542),new _(S[10],1323610764),new _(S[11],3590304994),new _(S[12],4068182383),new _(S[13],991336113),new _(S[14],633803317),new _(S[15],3479774868),new _(S[16],2666613458),new _(S[17],944711139),new _(S[18],2341262773),new _(S[19],2007800933),new _(S[20],1495990901),new _(S[21],1856431235),new _(S[22],3175218132),new _(S[23],2198950837),new _(S[24],3999719339),new _(S[25],766784016),new _(S[26],2566594879),new _(S[27],3203337956),new _(S[28],1034457026),new _(S[29],2466948901),new _(S[30],3758326383),new _(S[31],168717936),new _(S[32],1188179964),new _(S[33],1546045734),new _(S[34],1522805485),new _(S[35],2643833823),new _(S[36],2343527390),new _(S[37],1014477480),new _(S[38],1206759142),new _(S[39],344077627),new _(S[40],1290863460),new _(S[41],3158454273),new _(S[42],3505952657),new _(S[43],106217008),new _(S[44],3606008344),new _(S[45],1432725776),new _(S[46],1467031594),new _(S[47],851169720),new _(S[48],3100823752),new _(S[49],1363258195),new _(S[50],3750685593),new _(S[51],3785050280),new _(S[52],3318307427),new _(S[53],3812723403),new _(S[54],2003034995),new _(S[55],3602036899),new _(S[56],1575990012),new _(S[57],1125592928),new _(S[58],2716904306),new _(S[59],442776044),new _(S[60],593698344),new _(S[61],3733110249),new _(S[62],2999351573),new _(S[63],3815920427),new _(3391569614,3928383900),new _(3515267271,566280711),new _(3940187606,3454069534),new _(4118630271,4000239992),new _(116418474,1914138554),new _(174292421,2731055270),new _(289380356,3203993006),new _(460393269,320620315),new _(685471733,587496836),new _(852142971,1086792851),new _(1017036298,365543100),new _(1126000580,2618297676),new _(1288033470,3409855158),new _(1501505948,4234509866),new _(1607167915,987167468),new _(1816402316,1246189591)];function ci(n){return n==="SHA-384"?[new _(3418070365,gt[0]),new _(1654270250,gt[1]),new _(2438529370,gt[2]),new _(355462360,gt[3]),new _(1731405415,gt[4]),new _(41048885895,gt[5]),new _(3675008525,gt[6]),new _(1203062813,gt[7])]:[new _(bt[0],4089235720),new _(bt[1],2227873595),new _(bt[2],4271175723),new _(bt[3],1595750129),new _(bt[4],2917565137),new _(bt[5],725511199),new _(bt[6],4215389547),new _(bt[7],327033209)]}function mi(n,a){let t,e,i,o,s,d,p,f,C,h,g,D,A=[];for(t=a[0],e=a[1],i=a[2],o=a[3],s=a[4],d=a[5],p=a[6],f=a[7],g=0;g<80;g+=1)g<16?(D=2*g,A[g]=new _(n[D],n[D+1])):A[g]=Xi(Ji(A[g-2]),A[g-7],Zi(A[g-15]),A[g-16]),C=Qi(f,tn(s),(B=d,M=p,new _((P=s).N&B.N^~P.N&M.N,P.I&B.I^~P.I&M.I)),en[g],A[g]),h=ft(Wi(t),Yi(t,e,i)),f=p,p=d,d=s,s=ft(o,C),o=i,i=e,e=t,t=ft(C,h);var P,B,M;return a[0]=ft(t,a[0]),a[1]=ft(e,a[1]),a[2]=ft(i,a[2]),a[3]=ft(o,a[3]),a[4]=ft(s,a[4]),a[5]=ft(d,a[5]),a[6]=ft(p,a[6]),a[7]=ft(f,a[7]),a}var nn=class extends Rt{constructor(n,a,t){if(n!=="SHA-384"&&n!=="SHA-512")throw new Error(Xt);super(n,a,t);let e=t||{};this.g=this.Y,this.M=!0,this.T=-1,this.C=Bt(this.t,this.i,this.T),this.v=mi,this.L=function(i){return i.slice()},this.B=ci,this.F=function(i,o,s,d){return function(p,f,C,h,g){let D,A,P=31+(f+129>>>10<<5),B=f+C;for(;p.length<=P;)p.push(0);for(p[f>>>5]|=128<<24-f%32,p[P]=4294967295&B,p[P-1]=B/Wt|0,D=0;D<p.length;D+=32)h=mi(p.slice(D,D+32),h);return A=g==="SHA-384"?[h[0].N,h[0].I,h[1].N,h[1].I,h[2].N,h[2].I,h[3].N,h[3].I,h[4].N,h[4].I,h[5].N,h[5].I]:[h[0].N,h[0].I,h[1].N,h[1].I,h[2].N,h[2].I,h[3].N,h[3].I,h[4].N,h[4].I,h[5].N,h[5].I,h[6].N,h[6].I,h[7].N,h[7].I],A}(i,o,s,d,n)},this.U=ci(n),this.m=1024,this.R=n==="SHA-384"?384:512,this.K=!1,e.hmacKey&&this.k(Ft("hmacKey",e.hmacKey,this.T))}},an=[new _(0,1),new _(0,32898),new _(2147483648,32906),new _(2147483648,2147516416),new _(0,32907),new _(0,2147483649),new _(2147483648,2147516545),new _(2147483648,32777),new _(0,138),new _(0,136),new _(0,2147516425),new _(0,2147483658),new _(0,2147516555),new _(2147483648,139),new _(2147483648,32905),new _(2147483648,32771),new _(2147483648,32770),new _(2147483648,128),new _(0,32778),new _(2147483648,2147483658),new _(2147483648,2147516545),new _(2147483648,32896),new _(0,2147483649),new _(2147483648,2147516424)],on=[[0,36,3,41,18],[1,44,10,45,2],[62,6,43,15,61],[28,55,25,21,56],[27,20,39,8,14]];function Me(n){let a,t=[];for(a=0;a<5;a+=1)t[a]=[new _(0,0),new _(0,0),new _(0,0),new _(0,0),new _(0,0)];return t}function rn(n){let a,t=[];for(a=0;a<5;a+=1)t[a]=n[a].slice();return t}function _e(n,a){let t,e,i,o,s=[],d=[];if(n!==null)for(e=0;e<n.length;e+=2)a[(e>>>1)%5][(e>>>1)/5|0]=Kt(a[(e>>>1)%5][(e>>>1)/5|0],new _(n[e+1],n[e]));for(t=0;t<24;t+=1){for(o=Me(),e=0;e<5;e+=1)s[e]=(p=a[e][0],f=a[e][1],C=a[e][2],h=a[e][3],g=a[e][4],new _(p.N^f.N^C.N^h.N^g.N,p.I^f.I^C.I^h.I^g.I));for(e=0;e<5;e+=1)d[e]=Kt(s[(e+4)%5],si(s[(e+1)%5],1));for(e=0;e<5;e+=1)for(i=0;i<5;i+=1)a[e][i]=Kt(a[e][i],d[e]);for(e=0;e<5;e+=1)for(i=0;i<5;i+=1)o[i][(2*e+3*i)%5]=si(a[e][i],on[e][i]);for(e=0;e<5;e+=1)for(i=0;i<5;i+=1)a[e][i]=Kt(o[e][i],new _(~o[(e+1)%5][i].N&o[(e+2)%5][i].N,~o[(e+1)%5][i].I&o[(e+2)%5][i].I));a[0][0]=Kt(a[0][0],an[t])}var p,f,C,h,g;return a}function bi(n){let a,t,e=0,i=[0,0],o=[4294967295&n,n/Wt&2097151];for(a=6;a>=0;a--)t=o[a>>2]>>>8*a&255,t===0&&e===0||(i[e+1>>2]|=t<<8*(e+1),e+=1);return e=e!==0?e:1,i[0]|=e,{value:e+1>4?i:[i[0]],binLen:8+8*e}}function we(n){return fe(bi(n.binLen),n)}function pi(n,a){let t,e=bi(a);e=fe(e,n);let i=a>>>2,o=(i-e.value.length%i)%i;for(t=0;t<o;t++)e.value.push(0);return e.value}var ln=class extends Rt{constructor(n,a,t){let e=6,i=0;super(n,a,t);let o=t||{};if(this.numRounds!==1){if(o.kmacKey||o.hmacKey)throw new Error(fi);if(this.o==="CSHAKE128"||this.o==="CSHAKE256")throw new Error("Cannot set numRounds for CSHAKE variants")}switch(this.T=1,this.C=Bt(this.t,this.i,this.T),this.v=_e,this.L=rn,this.B=Me,this.U=Me(),this.K=!1,n){case"SHA3-224":this.m=i=1152,this.R=224,this.M=!0,this.g=this.Y;break;case"SHA3-256":this.m=i=1088,this.R=256,this.M=!0,this.g=this.Y;break;case"SHA3-384":this.m=i=832,this.R=384,this.M=!0,this.g=this.Y;break;case"SHA3-512":this.m=i=576,this.R=512,this.M=!0,this.g=this.Y;break;case"SHAKE128":e=31,this.m=i=1344,this.R=-1,this.K=!0,this.M=!1,this.g=null;break;case"SHAKE256":e=31,this.m=i=1088,this.R=-1,this.K=!0,this.M=!1,this.g=null;break;case"KMAC128":e=4,this.m=i=1344,this.X(t),this.R=-1,this.K=!0,this.M=!1,this.g=this._;break;case"KMAC256":e=4,this.m=i=1088,this.X(t),this.R=-1,this.K=!0,this.M=!1,this.g=this._;break;case"CSHAKE128":this.m=i=1344,e=this.O(t),this.R=-1,this.K=!0,this.M=!1,this.g=null;break;case"CSHAKE256":this.m=i=1088,e=this.O(t),this.R=-1,this.K=!0,this.M=!1,this.g=null;break;default:throw new Error(Xt)}this.F=function(s,d,p,f,C){return function(h,g,D,A,P,B,M){let H,U,q=0,_t=[],Qt=P>>>5,Vi=g>>>5;for(H=0;H<Vi&&g>=P;H+=Qt)A=_e(h.slice(H,H+Qt),A),g-=P;for(h=h.slice(H),g%=P;h.length<Qt;)h.push(0);for(H=g>>>3,h[H>>2]^=B<<H%4*8,h[Qt-1]^=2147483648,A=_e(h,A);32*_t.length<M&&(U=A[q%5][q/5|0],_t.push(U.I),!(32*_t.length>=M));)_t.push(U.N),q+=1,64*q%P==0&&(_e(null,A),q=0);return _t}(s,d,0,f,i,e,C)},o.hmacKey&&this.k(Ft("hmacKey",o.hmacKey,this.T))}O(n,a){let t=function(i){let o=i||{};return{funcName:Ft("funcName",o.funcName,1,{value:[],binLen:0}),customization:Ft("Customization",o.customization,1,{value:[],binLen:0})}}(n||{});a&&(t.funcName=a);let e=fe(we(t.funcName),we(t.customization));if(t.customization.binLen!==0||t.funcName.binLen!==0){let i=pi(e,this.m>>>3);for(let o=0;o<i.length;o+=this.m>>>5)this.U=this.v(i.slice(o,o+(this.m>>>5)),this.U),this.A+=this.m;return 4}return 31}X(n){let a=function(e){let i=e||{};return{kmacKey:Ft("kmacKey",i.kmacKey,1),funcName:{value:[1128353099],binLen:32},customization:Ft("Customization",i.customization,1,{value:[],binLen:0})}}(n||{});this.O(n,a.funcName);let t=pi(we(a.kmacKey),this.m>>>3);for(let e=0;e<t.length;e+=this.m>>>5)this.U=this.v(t.slice(e,e+(this.m>>>5)),this.U),this.A+=this.m;this.H=!0}_(n){let a=fe({value:this.h.slice(),binLen:this.u},function(t){let e,i,o=0,s=[0,0],d=[4294967295&t,t/Wt&2097151];for(e=6;e>=0;e--)i=d[e>>2]>>>8*e&255,i===0&&o===0||(s[o>>2]|=i<<8*o,o+=1);return o=o!==0?o:1,s[o>>2]|=o<<8*o,{value:o+1>4?s:[s[0]],binLen:8+8*o}}(n.outputLen));return this.F(a.value,a.binLen,this.A,this.L(this.U),n.outputLen)}},$t=class{constructor(a,t,e){if(a=="SHA-1")this.P=new zi(a,t,e);else if(a=="SHA-224"||a=="SHA-256")this.P=new Ki(a,t,e);else if(a=="SHA-384"||a=="SHA-512")this.P=new nn(a,t,e);else{if(a!="SHA3-224"&&a!="SHA3-256"&&a!="SHA3-384"&&a!="SHA3-512"&&a!="SHAKE128"&&a!="SHAKE256"&&a!="CSHAKE128"&&a!="CSHAKE256"&&a!="KMAC128"&&a!="KMAC256")throw new Error(Xt);this.P=new ln(a,t,e)}}update(a){return this.P.update(a),this}getHash(a,t){return this.P.getHash(a,t)}setHMACKey(a,t,e){this.P.setHMACKey(a,t,e)}getHMAC(a,t){return this.P.getHMAC(a,t)}};var sn=(n,a)=>a.name;function cn(n,a){if(n&1&&V(0,"mat-progress-bar",3),n&2){let t=a.$implicit,e=u();y("value",e.fileProgressMap[t.name].progress/e.fileProgressMap[t.name].total*100)("mode","determinate")}}var wi=(()=>{class n{constructor(t){this.web=t,this.fileProgressMap={},this.fileList=[],this.fileType="",this.fileCategory="",this.analysisGroupId=0,this.fileUploaded=new z,this.allowFileType=["csv","tsv","txt"]}uploadData(t){return wt(this,null,function*(){let e=t.target.files;if(e){this.fileList=[];for(let i=0;i<e.length;i++)this.fileList.push(e[i]),this.fileProgressMap[e[i].name]={progress:0,total:e[i].size};for(let i=0;i<e.length;i++)yield this.uploadFile(e[i])}})}getFileExntension(t){let e=t.name.split(".");return e.length>1?e[e.length-1]:""}uploadFile(t){return wt(this,null,function*(){let i=t.size,o=new $t("SHA-256","ARRAYBUFFER");if(this.fileType=this.getFileExntension(t),this.allowFileType.indexOf(this.fileType)!==-1)if(1048576>i){let s=yield t.arrayBuffer();o.update(s);let d=o.getHash("HEX"),p=yield this.web.uploadDataChunkComplete("",d,t,t.name).toPromise();this.fileProgressMap[t.name].progress=i,p?.completed_at&&this.web.bindUploadedFile(this.analysisGroupId,this.fileType,this.fileCategory,t.name,p?.id).subscribe(f=>{this.fileUploaded.emit(f)})}else{let s="",d=0;for(;i>d;){let p=d+1048576;p>=i&&(p=i);let f=yield t.slice(d,p).arrayBuffer();o.update(f);let C=new File([f],t.name,{type:t.type});console.log(C.size);let h=`bytes ${d}-${p-1}/${i}`;console.log(h);let g=yield this.web.uploadDataChunk(s,C,t.name,h).toPromise();g&&(s=g.url,d=g.offset,this.fileProgressMap[t.name].progress=d)}if(s!==""){let p=o.getHash("HEX"),f=yield this.web.uploadDataChunkComplete(s,p).toPromise();f?.completed_at&&this.web.bindUploadedFile(this.analysisGroupId,this.fileType,this.fileCategory,t.name,f?.id).subscribe(C=>{this.fileProgressMap[t.name].progress=i,this.fileUploaded.emit(C)})}}})}static{this.\u0275fac=function(e){return new(e||n)(G(Q))}}static{this.\u0275cmp=j({type:n,selectors:[["app-upload-file"]],inputs:{fileType:"fileType",fileCategory:"fileCategory",analysisGroupId:"analysisGroupId"},outputs:{fileUploaded:"fileUploaded"},decls:8,vars:0,consts:[["file",""],["mat-icon-button","","type","button",3,"click"],["type","file","hidden","",3,"change"],[3,"value","mode"]],template:function(e,i){if(e&1){let o=N();r(0,"form")(1,"button",1),x("click",function(){b(o);let d=K(5);return w(d.click())}),r(2,"mat-icon"),c(3,"upload"),l()(),r(4,"input",2,0),x("change",function(d){return b(o),w(i.uploadData(d))}),l()(),E(6,cn,1,2,"mat-progress-bar",3,sn)}e&2&&(m(6),T(i.fileList))},dependencies:[vt,Mt,Lt,X,W,Y],encapsulation:2})}}return n})();var mn=["table"];function pn(n,a){if(n&1&&(r(0,"mat-option",7),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),L(t)}}function dn(n,a){n&1&&(r(0,"th",16),c(1," Sample "),l())}function un(n,a){if(n&1&&(r(0,"td",17),c(1),l()),n&2){let t=a.$implicit;m(),$(" ",t.value.Sample," ")}}function _n(n,a){n&1&&(r(0,"th",16),c(1," Condition "),l())}function fn(n,a){if(n&1){let t=N();r(0,"td",17)(1,"form",4)(2,"mat-form-field")(3,"input",18,1),x("change",function(i){b(t);let o=K(4),s=u(2);return w(s.handleAutoCompleteChange(i,o.value))}),l(),r(5,"mat-label"),c(6),l()()()()}if(n&2){let t=a.$implicit;m(),y("formGroup",t),m(2),Jt("placeholder",t.value.Sample),m(3),L(t.value.Sample)}}function hn(n,a){n&1&&V(0,"tr",19)}function Cn(n,a){n&1&&V(0,"tr",20)}function yn(n,a){if(n&1&&(r(0,"table",8,0),Ut(2,10),F(3,dn,2,0,"th",11)(4,un,2,1,"td",12),jt(),Ut(5,13),F(6,_n,2,0,"th",11)(7,fn,7,3,"td",12),jt(),F(8,hn,1,0,"tr",14)(9,Cn,1,0,"tr",15),l()),n&2){let t=u();y("dataSource",t.annotationData),m(8),y("matHeaderRowDef",t.displayedColumns),m(),y("matRowDefColumns",t.displayedColumns)}}var Mi=(()=>{class n{set annotation(t){t&&(this._annotation=t,this.annotationData=t.annotations.map(e=>this.fb.group({Sample:new I(e.Sample,R.required),Condition:new I(e.Condition,R.required)})),this.form.patchValue({columns:this.annotationData.map(e=>e.value.Sample)}))}get annotation(){return this._annotation}set projectFile(t){this._projectFile=t,this.web.getProjectFileColumns(t.id).subscribe(e=>{let i=[];e.forEach(o=>{i.includes(o)||i.push(o)}),this.columns=i})}get projectFile(){return this._projectFile}onSelectionChange(t){let e=t.source,i=-1,o=e.selected,s;for(let p=0;p<o.length;p++)if(!this.lastSelection.find(f=>f===o[p].value)){s=o[p];break}let d=e.options.toArray();i=d.indexOf(s),this.shiftPressed&&this.lastSelectedIndex>-1&&d.forEach((p,f)=>{this.isBetween(f,this.lastSelectedIndex,i)&&(console.log(p),p.select())}),this.lastSelection=this.form.value.columns?.slice(),this.lastSelectedIndex=i,this.table?.renderRows()}constructor(t,e,i){this.fb=t,this.web=e,this.dialogRef=i,this.columns=[],this.shiftPressed=!1,this.displayedColumns=["Sample","Condition"],this.form=this.fb.group({columns:new I([])}),this.annotationData=[],this.lastSelectedIndex=-1,this.lastSelection=[],window.addEventListener("keydown",o=>{o.key==="Shift"&&(this.shiftPressed=!0)}),window.addEventListener("keyup",o=>{o.key==="Shift"&&(this.shiftPressed=!1)}),this.form.controls.columns.valueChanges.subscribe(o=>{if(o){let s=o.map(d=>{let p=d.split(/\./g);return console.log(p),p.length>2?{Sample:d,Condition:p.slice(0,p.length-1).join(".")}:p.length===2?{Sample:d,Condition:p[0]}:{Sample:d,Condition:""}});for(let d=0;d<s.length;d++)this.annotationData.find(p=>p.value.Sample===s[d].Sample)||this.annotationData.push(this.fb.group({Sample:new I(s[d].Sample,R.required),Condition:new I(s[d].Condition,R.required)}));for(let d=0;d<this.annotationData.length;d++)this.annotationData[d].value.Sample&&(o.includes(this.annotationData[d].value.Sample)||this.annotationData.splice(d,1))}})}cancel(){this.dialogRef.close()}save(){let t=!0,e=this.annotationData.map(i=>(i.valid||(t=!1),i.value));t&&this.dialogRef.close(e)}handleAutoCompleteChange(t,e){console.log(t,e)}isBetween(t,e,i){return e<i?t>=e&&t<=i:t>=i&&t<=e}static{this.\u0275fac=function(e){return new(e||n)(G(it),G(Q),G(rt))}}static{this.\u0275cmp=j({type:n,selectors:[["app-analysis-group-sample-annotation-modal"]],viewQuery:function(e,i){if(e&1&&Et(mn,5),e&2){let o;Tt(o=It())&&(i.table=o.first)}},inputs:{annotation:"annotation",projectFile:"projectFile"},decls:16,vars:3,consts:[["table",""],["optionCondition",""],["mat-dialog-title",""],["mat-dialog-content",""],[3,"formGroup"],[2,"width","300px"],["formControlName","columns",3,"selectionChange","multiple"],[3,"value"],["mat-table","",3,"dataSource"],["mat-button","",3,"click"],["matColumnDef","Sample"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","Condition"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["matInput","","formControlName","Condition",2,"border-radius","0",3,"change","placeholder"],["mat-header-row",""],["mat-row",""]],template:function(e,i){e&1&&(r(0,"h2",2),c(1,"Sample Annotation"),l(),r(2,"div",3)(3,"form",4)(4,"mat-form-field",5)(5,"mat-select",6),x("selectionChange",function(s){return i.onSelectionChange(s)}),E(6,pn,2,2,"mat-option",7,k),l(),r(8,"mat-label"),c(9,"Columns"),l()()(),F(10,yn,10,3,"table",8),l(),r(11,"mat-dialog-actions")(12,"button",9),x("click",function(){return i.save()}),c(13,"Submit"),l(),r(14,"button",9),x("click",function(){return i.cancel()}),c(15,"Close"),l()()),e&2&&(m(3),y("formGroup",i.form),m(2),y("multiple",!0),m(),T(i.columns),m(4),v(i.annotationData.length>0?10:-1))},dependencies:[lt,st,X,W,mt,Z,Y,tt,et,at,Ct,dt,nt,pt,kt,ct,O,Pe,Be,Ue,je,qe,ze,Oe,He,Re,$e],encapsulation:2})}}return n})();function xn(n,a){if(n&1&&(r(0,"mat-option",7),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),L(t)}}function gn(n,a){if(n&1&&(r(0,"mat-option",7),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),L(t)}}function bn(n,a){if(n&1&&(r(0,"mat-option",7),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),L(t)}}function wn(n,a){if(n&1&&(r(0,"mat-option",7),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),L(t)}}function Mn(n,a){if(n&1&&(r(0,"mat-option",7),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),L(t)}}function vn(n,a){if(n&1&&(r(0,"mat-option",7),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),L(t)}}function Sn(n,a){if(n&1&&(r(0,"mat-form-field")(1,"mat-select",14),E(2,vn,2,2,"mat-option",7,k),l(),r(4,"mat-label"),c(5,"Comparison Label"),l()()),n&2){let t=u(2).$implicit,e=u(2);m(2),T(e.comparison_labels_map[t.value.comparison_col])}}function Fn(n,a){n&1&&(r(0,"mat-form-field"),V(1,"input",15),r(2,"mat-label"),c(3,"Comparison Label"),l()())}function Dn(n,a){if(n&1){let t=N();r(0,"mat-tab",4),Ut(1),r(2,"div")(3,"form",5)(4,"div")(5,"mat-form-field")(6,"mat-select",6),E(7,xn,2,2,"mat-option",7,k),l(),r(9,"mat-label"),c(10,"Condition A"),l()()(),r(11,"div")(12,"mat-form-field")(13,"mat-select",8),E(14,gn,2,2,"mat-option",7,k),l(),r(16,"mat-label"),c(17,"Condition B"),l()()(),r(18,"div")(19,"mat-form-field")(20,"mat-select",9),E(21,bn,2,2,"mat-option",7,k),l(),r(23,"mat-label"),c(24,"Fold Change Column"),l()()(),r(25,"div")(26,"mat-form-field")(27,"mat-select",10),E(28,wn,2,2,"mat-option",7,k),l(),r(30,"mat-label"),c(31,"P-Value Column"),l()()(),r(32,"div")(33,"mat-form-field")(34,"mat-select",11),E(35,Mn,2,2,"mat-option",7,k),l(),r(37,"mat-label"),c(38,"Comparison Column"),l()()(),c(39," If the comparison column has been selected, please select the comparison label column below. If not, please write the comparison label in the text box below. "),r(40,"div"),F(41,Sn,6,0,"mat-form-field")(42,Fn,4,0,"mat-form-field"),l()()(),r(43,"div",12)(44,"button",13),x("click",function(){b(t);let i=u().$implicit,o=u(2);return w(o.copyComparison(i))}),r(45,"mat-icon"),c(46,"content_copy"),l()(),r(47,"button",13),x("click",function(){b(t);let i=u().$index,o=u(2);return w(o.removeComparison(i))}),r(48,"mat-icon"),c(49,"remove"),l()()(),jt(),l()}if(n&2){let t=u().$implicit,e=u(2);y("label",t.value.comparison_label),m(3),y("formGroup",t),m(4),T(e.conditions),m(7),T(e.conditions),m(7),T(e.columns),m(7),T(e.columns),m(7),T(e.columns),m(6),v(t.value.comparison_col?41:42)}}function An(n,a){if(n&1&&F(0,Dn,50,3,"mat-tab",4),n&2){let t=a.$implicit;v(t.value.comparison_label?0:-1)}}function Gn(n,a){if(n&1&&(r(0,"mat-tab-group",2),E(1,An,1,1,null,null,k),l()),n&2){let t=u();m(),T(t.form)}}var vi=(()=>{class n{set comparisonMatrix(t){this._comparisonMatrix=t,this.form=t.matrix.map(e=>this.fb.group({condition_A:new I(e.condition_A,R.required),condition_B:new I(e.condition_B,R.required),fold_change_col:new I(e.fold_change_col,R.required),p_value_col:new I(e.p_value_col,R.required),comparison_label:new I(e.comparison_label,R.required),comparison_col:new I(e.comparison_col)}));for(let e of this.form)e.controls.comparison_col.value&&this.web.getUniqueComparisonLabel(t.file,e.controls.comparison_col.value).subscribe(i=>{this.comparison_labels_map[e.controls.comparison_col.value]=i}),e.controls.comparison_col.valueChanges.subscribe(i=>{i&&this.web.getUniqueComparisonLabel(t.file,i).subscribe(o=>{this.comparison_labels_map[i]=o})}),e.controls.comparison_label.valueChanges.subscribe(i=>{i||e.controls.comparison_label.setValue("temp_title")})}get comparisonMatrix(){return this._comparisonMatrix}set projectFile(t){this._projectFile=t,this.web.getProjectFileColumns(t.id).subscribe(e=>{let i=[];e.forEach(o=>{i.includes(o)||i.push(o)}),this.columns=i})}get projectFile(){return this._projectFile}set sampleAnnotations(t){this._sampleAnnotations=t,t&&(this.conditions=[],t.annotations.forEach(e=>{console.log(e.Condition),this.conditions.includes(e.Condition)||this.conditions.push(e.Condition)}))}get sampleAnnotations(){return this._sampleAnnotations}constructor(t,e,i){this.web=t,this.fb=e,this.dialogRef=i,this.comparison_labels=[],this.comparison_labels_map={},this.columns=[],this.conditions=[],this.form=[]}addComparison(){let t=this.fb.group({condition_A:new I(null,R.required),condition_B:new I(null,R.required),fold_change_col:new I(null,R.required),p_value_col:new I(null,R.required),comparison_label:new I(`comparison_${this.form.length+1}`,R.required),comparison_col:new I(null)});this.form.push(t),t.controls.comparison_col.valueChanges.subscribe(e=>{e&&this.web.getUniqueComparisonLabel(this.comparisonMatrix.file,e).subscribe(i=>{this.comparison_labels_map[e]=i,this.comparison_labels=i})}),t.controls.comparison_label.valueChanges.subscribe(e=>{e||t.controls.comparison_label.setValue("temp_title")})}removeComparison(t){this.form.splice(t,1)}copyComparison(t){let e=this.fb.group({condition_A:new I(t.value.condition_A,R.required),condition_B:new I(t.value.condition_B,R.required),fold_change_col:new I(t.value.fold_change_col,R.required),p_value_col:new I(t.value.p_value_col,R.required),comparison_label:new I(`comparison_${this.form.length+1}`,R.required),comparison_col:new I(t.value.comparison_col)});this.form.push(e),e.controls.comparison_col.valueChanges.subscribe(i=>{i&&this.web.getUniqueComparisonLabel(this.comparisonMatrix.file,i).subscribe(o=>{this.comparison_labels=o})}),e.controls.comparison_label.valueChanges.subscribe(i=>{i||e.controls.comparison_label.setValue("temp_title")})}save(){let t=!0;this.form.forEach(e=>{e.valid||(t=!1)}),t&&this.dialogRef.close(this.form.map(e=>e.value))}cancel(){this.dialogRef.close()}static{this.\u0275fac=function(e){return new(e||n)(G(Q),G(it),G(rt))}}static{this.\u0275cmp=j({type:n,selectors:[["app-analysis-group-comparison-matrix-modal"]],inputs:{comparisonMatrix:"comparisonMatrix",projectFile:"projectFile",sampleAnnotations:"sampleAnnotations"},decls:11,vars:1,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["mat-stretch-tabs","false"],["mat-button","",3,"click"],[3,"label"],[2,"display","flex","flex-direction","column","gap","10px","overflow-y","hidden",3,"formGroup"],["formControlName","condition_A"],[3,"value"],["formControlName","condition_B"],["formControlName","fold_change_col"],["formControlName","p_value_col"],["formControlName","comparison_col"],[2,"display","flex","flex-direction","row","gap","10px"],["mat-icon-button","","color","warn",3,"click"],["formControlName","comparison_label"],["matInput","","type","text","formControlName","comparison_label"]],template:function(e,i){e&1&&(r(0,"h2",0),c(1,"Analysis Group Comparison Matrix"),l(),r(2,"div",1),F(3,Gn,3,0,"mat-tab-group",2),l(),r(4,"mat-dialog-actions")(5,"button",3),x("click",function(){return i.addComparison()}),c(6," Add Comparison "),l(),r(7,"button",3),x("click",function(){return i.save()}),c(8," Submit "),l(),r(9,"button",3),x("click",function(){return i.cancel()}),c(10," Close "),l()()),e&2&&(m(3),v(i.form.length>0?3:-1))},dependencies:[lt,st,vt,Mt,X,W,mt,Z,Y,tt,et,at,Ct,dt,nt,pt,Ye,Ke,ct,O],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}"]})}}return n})();var Di=(()=>{class n{constructor(t,e,i,o,s){this.fb=t,this.dialogRef=e,this.web=i,this.ws=o,this.sb=s,this.analysisGroupIDs=[],this.form=this.fb.group({search:new I("",R.required),searchMode:new I("full",R.required),foldChange:new I(.6,R.required),pValue:new I(1.31,R.required)}),this.selectedProjects=[],this.ws.searchWSConnection?.subscribe(d=>{if(d&&d.type==="search_status")switch(d.status){case"complete":this.sb.open(`${location.host}/#/search-session/${d.id}`,"Dismiss",{duration:1e4}),this.dialogRef.close(d.id);break}})}search(){this.form.invalid||(this.selectedProjects.length===0?this.form.value.search&&this.form.value.foldChange&&this.form.value.pValue&&this.form.value.searchMode&&this.web.createSearch(this.analysisGroupIDs,this.form.value.search,this.web.searchSessionID,this.form.value.foldChange,this.form.value.pValue,this.form.value.searchMode).subscribe(t=>{this.sb.open("Search queued","Dismiss",{duration:2e3})}):this.web.getAnalysisGroupsFromProjects(this.selectedProjects).subscribe(t=>{t&&this.form.value.search&&this.form.value.foldChange&&this.form.value.pValue&&this.form.value.searchMode&&this.web.createSearch(t.map(e=>e.id),this.form.value.search,this.web.searchSessionID,this.form.value.foldChange,this.form.value.pValue,this.form.value.searchMode).subscribe(e=>{this.sb.open("Search queued","Dismiss",{duration:2e3})})}))}cancel(){this.dialogRef.close()}handleMultipleProjectSelection(t){this.selectedProjects=t}static{this.\u0275fac=function(e){return new(e||n)(G(it),G(rt),G(Q),G(Nt),G(Vt))}}static{this.\u0275cmp=j({type:n,selectors:[["app-search-modal"]],inputs:{analysisGroupIDs:"analysisGroupIDs"},decls:56,vars:2,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[2,"display","flex","flex-direction","column","gap","1px",3,"formGroup"],["matInput","","formControlName","search","id","search","type","text","placeholder","Search Term"],["formControlName","searchMode"],["value","gene"],["value","uniprot"],["value","pi"],["value","full"],["matInput","","type","number","formControlName","foldChange","placeholder","Log2 Fold Change"],["matInput","","type","number","formControlName","pValue","placeholder","P-Value"],[3,"selectedProjects","multipleSelection"],["mat-button","",3,"click"]],template:function(e,i){e&1&&(r(0,"h2",0),c(1,"Data Search"),l(),r(2,"div",1)(3,"form",2)(4,"mat-form-field"),V(5,"input",3),r(6,"mat-label"),c(7,"Search Term"),l()(),r(8,"p")(9,"b"),c(10,"Search Multiple Terms"),l(),V(11,"br"),c(12," In order to search with multiple terms, enclose each term in single quotes and separate them with "),r(13,"b"),c(14,"OR"),l(),c(15,". "),l(),r(16,"mat-form-field")(17,"mat-select",4)(18,"mat-option",5),c(19,"Gene Name"),l(),r(20,"mat-option",6),c(21,"UniProt Accession ID"),l(),r(22,"mat-option",7),c(23,"Primary IDs"),l(),r(24,"mat-option",8),c(25,"Full Text"),l()(),r(26,"mat-label"),c(27,"Search Mode"),l()(),r(28,"mat-form-field"),V(29,"input",9),r(30,"mat-label"),c(31,"Log2 Fold Change"),l()(),r(32,"mat-form-field"),V(33,"input",10),r(34,"mat-label"),c(35,"-Log10(P-Value)"),l()()(),V(36,"hr"),r(37,"p")(38,"b"),c(39,"Search by currently selected analysis groups or by selected projects below"),l(),V(40,"br"),c(41," By selecting the one or more projects below, the currently selected analysis groups will be ignored. "),l(),r(42,"mat-accordion")(43,"mat-expansion-panel")(44,"mat-expansion-panel-header")(45,"mat-panel-title"),c(46," Filter by Project "),l(),r(47,"mat-panel-description"),c(48," Optional "),l()(),r(49,"app-project-search",11),x("selectedProjects",function(s){return i.handleMultipleProjectSelection(s)}),l()()(),V(50,"hr"),l(),r(51,"mat-dialog-actions")(52,"button",12),x("click",function(){return i.search()}),c(53,"Search"),l(),r(54,"button",12),x("click",function(){return i.cancel()}),c(55,"Close"),l()()),e&2&&(m(3),y("formGroup",i.form),m(46),y("multipleSelection",!0))},dependencies:[lt,st,nt,pt,at,X,W,mt,ee,Z,Y,tt,et,ct,O,Ct,dt,le,qt,oe,ae,re,Le],encapsulation:2})}}return n})();function En(n,a){if(n&1&&(r(0,"mat-option",5),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),L(t)}}function Tn(n,a){if(n&1&&(r(0,"mat-option",5),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),L(t)}}function In(n,a){if(n&1&&(r(0,"mat-option",5),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),L(t)}}function kn(n,a){if(n&1&&(r(0,"mat-option",5),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),L(t)}}function Vn(n,a){if(n&1&&(r(0,"mat-option",5),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),L(t)}}function Nn(n,a){if(n&1&&(r(0,"mat-option",5),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),L(t)}}function Ln(n,a){if(n&1&&(r(0,"mat-option",5),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),L(t)}}function Pn(n,a){if(n&1&&(r(0,"mat-form-field")(1,"mat-select",8),E(2,kn,2,2,"mat-option",5,k),l(),r(4,"mat-label"),c(5,"Mod Position in Peptide Column"),l()(),r(6,"mat-form-field")(7,"mat-select",9),E(8,Vn,2,2,"mat-option",5,k),l(),r(10,"mat-label"),c(11,"Mod Position in Protein Column"),l()(),r(12,"mat-form-field")(13,"mat-select",10),E(14,Nn,2,2,"mat-option",5,k),l(),r(16,"mat-label"),c(17,"Localization Probability Column"),l()(),r(18,"mat-form-field")(19,"mat-select",11),E(20,Ln,2,2,"mat-option",5,k),l(),r(22,"mat-label"),c(23,"Peptide Sequence Column"),l()()),n&2){let t=u(3);m(2),T(t.columns),m(6),T(t.columns),m(6),T(t.columns),m(6),T(t.columns)}}function Rn(n,a){if(n&1&&(r(0,"form",3)(1,"mat-form-field")(2,"mat-select",4),E(3,En,2,2,"mat-option",5,k),l(),r(5,"mat-label"),c(6,"Primary ID Column"),l()(),r(7,"mat-form-field")(8,"mat-select",6),E(9,Tn,2,2,"mat-option",5,k),l(),r(11,"mat-label"),c(12,"Gene Name Column"),l()(),r(13,"mat-form-field")(14,"mat-select",7),E(15,In,2,2,"mat-option",5,k),l(),r(17,"mat-label"),c(18,"UniProt Accession ID Column"),l()(),F(19,Pn,24,0),l()),n&2){let t=u(2);y("formGroup",t.formDFColumn),m(3),T(t.columns),m(6),T(t.columns),m(6),T(t.columns),m(4),v(t.analysisGroupType&&t.analysisGroupType==="ptm"?19:-1)}}function $n(n,a){if(n&1&&(r(0,"mat-option",5),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),L(t)}}function Bn(n,a){if(n&1&&(r(0,"mat-option",5),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),L(t)}}function Un(n,a){if(n&1&&(r(0,"mat-option",5),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),L(t)}}function jn(n,a){if(n&1&&(r(0,"form",3)(1,"mat-form-field")(2,"mat-select",4),E(3,$n,2,2,"mat-option",5,k),l(),r(5,"mat-label"),c(6,"Primary ID Column"),l()(),r(7,"mat-form-field")(8,"mat-select",6),E(9,Bn,2,2,"mat-option",5,k),l(),r(11,"mat-label"),c(12,"Gene Name Column"),l()(),r(13,"mat-form-field")(14,"mat-select",7),E(15,Un,2,2,"mat-option",5,k),l(),r(17,"mat-label"),c(18,"UniProt Accession ID Column"),l()()()),n&2){let t=u(2);y("formGroup",t.formSearchedColumn),m(3),T(t.columns),m(6),T(t.columns),m(6),T(t.columns)}}function Hn(n,a){if(n&1&&(r(0,"mat-option",5),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),L(t)}}function On(n,a){if(n&1&&(r(0,"mat-option",5),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),L(t)}}function qn(n,a){if(n&1&&(r(0,"mat-option",5),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),L(t)}}function zn(n,a){if(n&1&&(r(0,"mat-option",5),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),L(t)}}function Kn(n,a){if(n&1&&(r(0,"mat-option",5),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),L(t)}}function Yn(n,a){if(n&1&&(r(0,"form",3)(1,"mat-form-field")(2,"mat-select",4),E(3,Hn,2,2,"mat-option",5,k),l(),r(5,"mat-label"),c(6,"Primary ID Column"),l()(),r(7,"mat-form-field")(8,"mat-select",6),E(9,On,2,2,"mat-option",5,k),l(),r(11,"mat-label"),c(12,"Gene Name Column"),l()(),r(13,"mat-form-field")(14,"mat-select",7),E(15,qn,2,2,"mat-option",5,k),l(),r(17,"mat-label"),c(18,"UniProt Accession ID Column"),l()(),r(19,"mat-form-field")(20,"mat-select",12),E(21,zn,2,2,"mat-option",5,k),l(),r(23,"mat-label"),c(24,"Copy Number Rank Column"),l()(),r(25,"mat-form-field")(26,"mat-select",13),E(27,Kn,2,2,"mat-option",5,k),l(),r(29,"mat-label"),c(30,"Copy Number Column"),l()()()),n&2){let t=u(2);y("formGroup",t.formSearchedColumn),m(3),T(t.columns),m(6),T(t.columns),m(6),T(t.columns),m(6),T(t.columns),m(6),T(t.columns)}}function Wn(n,a){if(n&1&&F(0,Rn,20,2,"form",3)(1,jn,19,1,"form",3)(2,Yn,31,1,"form",3),n&2){let t=u();v(t.file.file_category==="df"?0:t.file.file_category==="searched"?1:t.file.file_category==="copy_number"?2:-1)}}var Ai=(()=>{class n{set file(t){this._file=t,t.extra_data&&(t.file_category==="df"?(this.formDFColumn.controls.primary_id_col.setValue(t.extra_data.primary_id_col),this.formDFColumn.controls.gene_name_col.setValue(t.extra_data.gene_name_col),this.formDFColumn.controls.uniprot_id_col.setValue(t.extra_data.uniprot_id_col),this.formDFColumn.controls.peptide_seq_col.setValue(t.extra_data.peptide_seq_col),this.formDFColumn.controls.modification_position_in_peptide_col.setValue(t.extra_data.modification_position_in_peptide_col),this.formDFColumn.controls.modification_position_in_protein_col.setValue(t.extra_data.modification_position_in_protein_col),this.formDFColumn.controls.localization_prob_col.setValue(t.extra_data.localization_prob_col)):t.file_category==="searched"?(this.formSearchedColumn.controls.primary_id_col.setValue(t.extra_data.primary_id_col),this.formSearchedColumn.controls.gene_name_col.setValue(t.extra_data.gene_name_col),this.formSearchedColumn.controls.uniprot_id_col.setValue(t.extra_data.uniprot_id_col)):t.file_category==="copy_number"&&(this.formCopyNumberColumn.controls.primary_id_col.setValue(t.extra_data.primary_id_col),this.formCopyNumberColumn.controls.gene_name_col.setValue(t.extra_data.gene_name_col),this.formCopyNumberColumn.controls.uniprot_id_col.setValue(t.extra_data.uniprot_id_col),this.formCopyNumberColumn.controls.rank_col.setValue(t.extra_data.rank_col),this.formCopyNumberColumn.controls.copy_number_col.setValue(t.extra_data.copy_number_col))),this.web.getProjectFileColumns(t.id).subscribe(e=>{this.columns=e})}get file(){return this._file}constructor(t,e,i){this.fb=t,this.matDialogRef=e,this.web=i,this._file=void 0,this.analysisGroupType=void 0,this.formDFColumn=this.fb.group({primary_id_col:new I("",R.required),gene_name_col:new I(""),uniprot_id_col:new I(""),peptide_seq_col:new I(""),modification_position_in_peptide_col:new I(""),modification_position_in_protein_col:new I(""),localization_prob_col:new I("")}),this.formSearchedColumn=this.fb.group({primary_id_col:new I("",R.required),gene_name_col:new I(""),uniprot_id_col:new I("")}),this.formCopyNumberColumn=this.fb.group({primary_id_col:new I("",R.required),gene_name_col:new I(""),uniprot_id_col:new I(""),rank_col:new I(""),copy_number_col:new I("")}),this.columns=[]}save(){let t={file_category:this.file.file_category,extra_data:{}};this.file.file_category==="df"?(this.formDFColumn.controls.uniprot_id_col.value&&(t.extra_data.uniprot_id_col=this.formDFColumn.controls.uniprot_id_col.value),this.formDFColumn.controls.primary_id_col.value&&(t.extra_data.primary_id_col=this.formDFColumn.controls.primary_id_col.value),this.formDFColumn.controls.gene_name_col.value&&(t.extra_data.gene_name_col=this.formDFColumn.controls.gene_name_col.value),this.formDFColumn.controls.modification_position_in_peptide_col.value&&(t.extra_data.modification_position_in_peptide_col=this.formDFColumn.controls.modification_position_in_peptide_col.value),this.formDFColumn.controls.modification_position_in_protein_col.value&&(t.extra_data.modification_position_in_protein_col=this.formDFColumn.controls.modification_position_in_protein_col.value),this.formDFColumn.controls.localization_prob_col.value&&(t.extra_data.localization_prob_col=this.formDFColumn.controls.localization_prob_col.value),this.formDFColumn.controls.peptide_seq_col.value&&(t.extra_data.peptide_seq_col=this.formDFColumn.controls.peptide_seq_col.value)):this.file.file_category==="searched"&&(this.formSearchedColumn.controls.uniprot_id_col.value&&(t.extra_data.uniprot_id_col=this.formSearchedColumn.controls.uniprot_id_col.value),this.formSearchedColumn.controls.primary_id_col.value&&(t.extra_data.primary_id_col=this.formSearchedColumn.controls.primary_id_col.value),this.formSearchedColumn.controls.gene_name_col.value&&(t.extra_data.gene_name_col=this.formSearchedColumn.controls.gene_name_col.value)),this.matDialogRef.close(t)}cancel(){this.matDialogRef.close()}static{this.\u0275fac=function(e){return new(e||n)(G(it),G(rt),G(Q))}}static{this.\u0275cmp=j({type:n,selectors:[["app-file-extra-data-modal"]],inputs:{analysisGroupType:"analysisGroupType",file:"file"},decls:9,vars:1,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["mat-button","",3,"click"],[2,"display","flex","flex-direction","column","gap","10px",3,"formGroup"],["formControlName","primary_id_col"],[3,"value"],["formControlName","gene_name_col"],["formControlName","uniprot_id_col"],["formControlName","modification_position_in_peptide_col"],["formControlName","modification_position_in_protein_col"],["formControlName","localization_prob_col"],["formControlName","peptide_seq_col"],["formControlName","rank_col"],["formControlName","copy_number_col"]],template:function(e,i){e&1&&(r(0,"h2",0),c(1,"File Extra Data"),l(),r(2,"div",1),F(3,Wn,3,1),l(),r(4,"mat-dialog-actions")(5,"button",2),x("click",function(){return i.save()}),c(6,"Submit"),l(),r(7,"button",2),x("click",function(){return i.cancel()}),c(8,"Close"),l()()),e&2&&(m(3),v(i.file?3:-1))},dependencies:[lt,st,X,W,Z,Y,tt,et,nt,dt,Ct,at,ct,O],encapsulation:2})}}return n})();var Qn=Ni(Li());ge.plotlyjs=Qn;var Gi=(()=>{class n{set curtainData(t){this._curtainData=t,this.drawVolcanoPlot()}get curtainData(){return this._curtainData}constructor(t,e){this.accounts=t,this.graph=e,this.plotType="proteomics",this.selected=new z,this._curtainData=void 0,this.graphData=[],this.graphLayout={height:700,width:700,margin:{r:null,l:null,b:null,t:null},xaxis:{title:"<b>Log2FC</b>",tickmode:"linear",ticklen:5,showgrid:!1,visible:!0,tickfont:{size:14,color:"black"}},yaxis:{title:"<b>-log10(p-value)</b>",tickmode:"linear",ticklen:5,showgrid:!1,visible:!0,showticklabels:!0,zeroline:!0,tickfont:{size:14,color:"black"}},annotations:[],showlegend:!0,legend:{orientation:"h"},title:{text:"",font:{size:24,family:"Arial, sans-serif",color:"black"}}},this.revision=0,this.config={toImageButtonOptions:{format:"svg",filename:this.graphLayout.title.text,height:this.graphLayout.height,width:this.graphLayout.width,scale:1}},this.colorMap={},this.graph.redrawTrigger.subscribe(()=>{this.drawVolcanoPlot()})}drawVolcanoPlot(){if(!this.curtainData&&!this.curtainData.settings)return;console.log(this.curtainData),this.graphLayout.title.text=this.curtainData.settings.title,this.colorMap=this.curtainData.settings.colorMap;let t=Object.keys(this.colorMap),e=this.curtainData.data.filter(M=>M["Fold Change"]!==null&&M["Fold Change"]!==void 0&&!isNaN(M["Fold Change"])),i=this.curtainData.data.filter(M=>M["P-value"]!==null&&M["P-value"]!==void 0&&!isNaN(M["P-value"])),o=Math.min(...e.map(M=>M["Fold Change"])),s=Math.max(...e.map(M=>M["Fold Change"])),d=0,p=Math.max(...i.map(M=>M["P-value"]));this.graphLayout.xaxis.range=[o-.5,s+.5],this.graphLayout.yaxis.range=[d,p-d*.5];let f=this.curtainData.settings.volcanoAxis;f.minX&&(this.graphLayout.xaxis.range[0]=f.minX),f.maxX&&(this.graphLayout.xaxis.range[1]=f.maxX),f.minY&&(this.graphLayout.yaxis.range[0]=f.minY),f.maxY&&(this.graphLayout.yaxis.range[1]=f.maxY),f.x&&(this.graphLayout.xaxis.title=`<b>${f.x}</b>`),f.y&&(this.graphLayout.yaxis.title=`<b>${f.y}</b>`);let C={};C.Background={x:[],y:[],mode:"markers",type:"scatter",name:"Background",text:[],data:[],marker:{size:this.curtainData.settings.scatterPlotMarkerSize,color:"#a4a2a2",opacity:.3}};for(let M of this.curtainData.selections)C[M]={x:[],y:[],mode:"markers",type:"scattergl",name:M,text:[],data:[],marker:{size:this.curtainData.settings.scatterPlotMarkerSize,color:this.curtainData.settings.colorMap[M]}};this.curtainData.data.forEach(M=>{if(M["Primary ID"]in this.curtainData.selection_map){let H=this.curtainData.selection_map[M["Primary ID"]];for(let U of this.curtainData.selections)H[U]&&(C[U].x.push(M["Fold Change"]),C[U].y.push(M["P-value"]),C[U].text.push(`${M["Gene Names"]}(${M["Primary ID"]})`),C[U].data.push(M))}else if(this.curtainData.settings.backGroundColorGrey)C.Background.x.push(M["Fold Change"]),C.Background.y.push(M["P-value"]),C.Background.text.push(`${M["Gene Names"]}(${M["Primary ID"]})`),C.Background.data.push(M);else{let H=this.significantGroup(M["Fold Change"],M["P-value"]),U;this.plotType==="proteomics"?U=t.find(q=>q.startsWith(`${H[0]} (${M.Comparison})`)):U=t.find(q=>q.startsWith(`${H[0]}`)),U&&(C[U]||(C[U]={x:[],y:[],mode:"markers",type:"scatter",name:U,text:[],data:[],marker:{size:this.curtainData.settings.scatterPlotMarkerSize,color:this.curtainData.settings.colorMap[U]}}),C[U].x.push(M["Fold Change"]),C[U].y.push(M["P-value"]),C[U].text.push(`${M["Gene Names"]}(${M["Primary ID"]})`),C[U].data.push(M))}}),this.graphData=[];for(let M in C)this.graphData.push(C[M]);this.graphData=this.graphData.reverse();let h=[];h.push({type:"line",x0:-this.curtainData.settings.log2FCCutoff,y0:0,x1:-this.curtainData.settings.log2FCCutoff,y1:this.graphLayout.yaxis.range[1],line:{color:"rgb(21,4,4)",width:1,dash:"dot"}}),h.push({type:"line",x0:this.curtainData.settings.log2FCCutoff,x1:this.curtainData.settings.log2FCCutoff,y0:0,y1:this.graphLayout.yaxis.range[1],line:{color:"rgb(21,4,4)",width:1,dash:"dot"}});let g=this.graphLayout.xaxis.range[0]-1;this.curtainData.settings.volcanoAxis.minX&&(g=this.curtainData.settings.volcanoAxis.minX-1);let D=this.graphLayout.xaxis.range[1]+1;if(this.curtainData.settings.volcanoAxis.maxX&&(D=this.curtainData.settings.volcanoAxis.maxX+1),h.push({type:"line",x0:g,x1:D,y0:-Math.log10(this.curtainData.settings.pCutoff),y1:-Math.log10(this.curtainData.settings.pCutoff),line:{color:"rgb(21,4,4)",width:1,dash:"dot"}}),this.graphLayout.shapes=h,this.curtainData.settings.volcanoPlotGrid&&(this.graphLayout.yaxis.showgrid=this.curtainData.settings.volcanoPlotGrid.y,this.graphLayout.xaxis.showgrid=this.curtainData.settings.volcanoPlotGrid.x),this.curtainData.settings.volcanoPlotDimension&&(this.curtainData.settings.volcanoPlotDimension.height&&(this.graphLayout.height=this.curtainData.settings.volcanoPlotDimension.height),this.curtainData.settings.volcanoPlotDimension.width&&(this.graphLayout.width=this.curtainData.settings.volcanoPlotDimension.width),this.curtainData.settings.volcanoPlotDimension.margin))for(let M in this.curtainData.settings.volcanoPlotDimension.margin)this.curtainData.settings.volcanoPlotDimension.margin[M]&&(this.graphLayout.margin[M]=this.curtainData.settings.volcanoPlotDimension.margin[M]);if(this.curtainData.settings.volcanoPlotYaxisPosition&&(this.curtainData.settings.volcanoPlotYaxisPosition.includes("left")&&this.graphLayout.shapes.push({type:"line",x0:this.graphLayout.xaxis.range[0],x1:this.graphLayout.xaxis.range[0],y0:this.graphLayout.yaxis.range[0],y1:this.graphLayout.yaxis.range[1],line:{color:"rgb(21,4,4)",width:1}}),this.curtainData.settings.volcanoPlotYaxisPosition.includes("middle")?this.graphLayout.xaxis.zerolinecolor="#000000":this.graphLayout.xaxis.zerolinecolor="#ffffff"),this.graphLayout.annotations=[],this.curtainData.settings.textAnnotation)for(let M in this.curtainData.settings.textAnnotation)this.curtainData.settings.textAnnotation[M].data.showannotation===!0&&this.graphLayout.annotations.push(this.curtainData.settings.textAnnotation[M].data);this.config={toImageButtonOptions:{format:"svg",filename:this.graphLayout.title.text,height:this.graphLayout.height,width:this.graphLayout.width,scale:1,margin:this.graphLayout.margin}};let A=document.getElementsByTagName("body")[0],B=window.getComputedStyle(A).backgroundColor;if(this.accounts.userAccount.darkMode){this.graphLayout.plot_bgcolor=B,this.graphLayout.paper_bgcolor=B,this.graphLayout.font={color:"white",size:14},this.graphLayout.xaxis.tickfont.color="white",this.graphLayout.yaxis.tickfont.color="white";for(let M of this.graphLayout.shapes)M.line.color="white";this.graphLayout.yaxis.showgrid&&(this.graphLayout.yaxis.gridcolor="white"),this.graphLayout.xaxis.showgrid&&(this.graphLayout.xaxis.gridcolor="white");for(let M of this.graphLayout.annotations)M.font.color="white",M.arrowcolor="white"}else this.graphLayout.plot_bgcolor="#FFFFFF",this.graphLayout.paper_bgcolor="#FFFFFF",this.graphLayout.font={color:"black",size:14};if(this.curtainData.settings.volcanoAdditionalShapes)for(let M of this.curtainData.settings.volcanoAdditionalShapes)this.graphLayout.shapes.push(M);this.revision+=1,console.log("cutoff",h),console.log(this.graphData)}significantGroup(t,e){let i=-Math.log10(this.curtainData.settings.pCutoff),o=[],s="";return i>e?(o.push("P-value > "+this.curtainData.settings.pCutoff),s="P-value > "):(o.push("P-value <= "+this.curtainData.settings.pCutoff),s="P-value <= "),Math.abs(t)>this.curtainData.settings.log2FCCutoff?(o.push("FC > "+this.curtainData.settings.log2FCCutoff),s+="FC > "):(o.push("FC <= "+this.curtainData.settings.log2FCCutoff),s+="FC <= "),[o.join(";"),s]}selectData(t){if("points"in t){let e=[];for(let i of t.points)e.push(i.data.data[i.pointIndex]);this.selected.emit(e)}}static{this.\u0275fac=function(e){return new(e||n)(G(me),G(Xe))}}static{this.\u0275cmp=j({type:n,selectors:[["app-volcano-plot"]],inputs:{plotType:"plotType",curtainData:"curtainData"},outputs:{selected:"selected"},decls:1,vars:5,consts:[[3,"selected","plotlyClick","data","config","layout","revision","updateOnlyWithRevision"]],template:function(e,i){e&1&&(r(0,"plotly-plot",0),x("selected",function(s){return i.selectData(s)})("plotlyClick",function(s){return i.selectData(s)}),l()),e&2&&y("data",i.graphData)("config",i.config)("layout",i.graphLayout)("revision",i.revision)("updateOnlyWithRevision",!0)},dependencies:[ge,We],encapsulation:2})}}return n})();var he=class{constructor(a){this.sourceFiles=a,this.metadata=a.map(t=>t.metadata_columns).flat()}getAllUniqueColumnPositionsSorted(){return[...new Set(this.metadata.map(a=>a.column_position))].sort()}getColumnsByPosition(a){return this.metadata.filter(t=>t.column_position===a)}composeTable(){let a=[],t=this.getAllUniqueColumnPositionsSorted(),e={};for(let i of this.sourceFiles){let o=[i.name];for(let s of t){let d=i.metadata_columns.find(p=>p.column_position===s);d?.value?o.push(d.value):o.push(""),d&&(e[s]=`${d.type.toLowerCase()}[${d.name.toLowerCase()}]`)}a.push(o)}return a.unshift(["source name",...t.map(i=>e[i])]),a}convertToTSV(){return this.composeTable().map(t=>t.join("	")).join(`
`)}};var Jn=()=>["Anywhere","Protein N-term","Protein C-term","Any N-term","Any C-term"],Zn=()=>["Fixed","Variable","Annotated"];function ta(n,a){if(n&1&&(r(0,"mat-option",11),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),$(" ",t," ")}}function ea(n,a){if(n&1&&E(0,ta,2,2,"mat-option",11,k),n&2){let t=u();T(t.metadataCharacteristics)}}function ia(n,a){if(n&1&&(r(0,"mat-option",11),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),$(" ",t," ")}}function na(n,a){if(n&1&&E(0,ia,2,2,"mat-option",11,k),n&2){let t=u();T(t.metadataComment)}}function aa(n,a){if(n&1&&(r(0,"mat-option",11),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),$(" ",t," ")}}function oa(n,a){if(n&1&&E(0,aa,2,2,"mat-option",11,k),n&2){let t=u();T(t.metadataOtherAutocomplete)}}function ra(n,a){if(n&1&&c(0),n&2){let t=u(3);$(" ",t.data.metadataHintMap[t.form.value.metadataName]," ")}}function la(n,a){if(n&1&&(r(0,"mat-option",11),c(1),l()),n&2){let t=a.$implicit,e=u(3);y("value",e.displayData(t)),m(),$(" ",e.displayData(t)," ")}}function sa(n,a){if(n&1){let t=N();r(0,"mat-form-field"),V(1,"input",12),r(2,"mat-label"),c(3,"Metadata Value"),l(),r(4,"mat-hint"),F(5,ra,1,1),l()(),r(6,"mat-autocomplete",13,2),x("optionSelected",function(i){b(t);let o=u(2);return w(o.getSelectedData(i))}),E(8,la,2,2,"mat-option",11,k),Ht(10,"async"),l()}if(n&2){let t=K(7),e=u(2);m(),y("matAutocomplete",t),m(4),v(e.data.metadataHintMap[e.form.value.metadataName]?5:-1),m(3),T(Ot(10,2,e.filteredResults))}}function ca(n,a){n&1&&(r(0,"mat-form-field"),V(1,"textarea",14),r(2,"mat-label"),c(3,"Metadata Value"),l()())}function ma(n,a){if(n&1&&F(0,sa,11,4)(1,ca,4,0,"mat-form-field"),n&2){let t=u();v(t.metadataNameAutocomplete.includes(t.form.value.metadataName)?0:1)}}function pa(n,a){if(n&1&&(r(0,"mat-option",11),c(1),l()),n&2){let t=u().$implicit;y("value",""),m(),$(" ",t," ")}}function da(n,a){if(n&1&&(r(0,"mat-option",11),c(1),l()),n&2){let t=u().$implicit;y("value",t),m(),$(" ",t," ")}}function ua(n,a){if(n&1&&F(0,pa,2,2,"mat-option",11)(1,da,2,2,"mat-option",11),n&2){let t=a.$implicit;v(t==="Other"?0:1)}}function _a(n,a){if(n&1&&c(0),n&2){let t=u().$implicit;$("(",t.classification,")")}}function fa(n,a){if(n&1&&(r(0,"mat-option",11),c(1),F(2,_a,1,1),l()),n&2){let t=a.$implicit;y("value",t),m(),$(" ",t.name," "),m(),v(t.classification?2:-1)}}function ha(n,a){if(n&1&&(r(0,"mat-option",11),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),$(" ",t," ")}}function Ca(n,a){if(n&1&&(r(0,"mat-option",11),c(1),l()),n&2){let t=a.$implicit;y("value",t),m(),$(" ",t," ")}}function ya(n,a){if(n&1){let t=N();r(0,"mat-form-field")(1,"mat-select",15),x("valueChange",function(i){b(t);let o=u(2);return w(o.selectSpec(i))}),E(2,fa,3,3,"mat-option",11,k),l(),r(4,"mat-label"),c(5,"Unimod Specifications"),l()(),r(6,"mat-form-field")(7,"mat-select",16),E(8,ha,2,2,"mat-option",11,k),l(),r(10,"mat-label"),c(11,"Modification Position"),l()(),r(12,"mat-form-field")(13,"mat-select",17),E(14,Ca,2,2,"mat-option",11,k),l(),r(16,"mat-label"),c(17,"Modification Type"),l()(),r(18,"mat-form-field"),V(19,"input",18),r(20,"mat-label"),c(21,"Target Amino Acid"),l()(),r(22,"mat-form-field"),V(23,"input",19),r(24,"mat-label"),c(25,"Monoisotopic Mass"),l()(),r(26,"mat-form-field"),V(27,"input",20),r(28,"mat-label"),c(29,"Target Site"),l()()}if(n&2){let t=u(2);m(2),T(t.availableSpecs),m(6),T(xe(0,Jn)),m(6),T(xe(1,Zn))}}function xa(n,a){if(n&1&&F(0,ya,30,2),n&2){let t=u();v(t.form.value.metadataName.toLowerCase()==="modification parameters"?0:-1)}}var ve=(()=>{class n{set metadataType(t){this.form.controls.metadataType.setValue(t)}set metadataName(t){this.form.controls.metadataName.setValue(t)}constructor(t,e,i,o){this.dialog=t,this.fb=e,this.web=i,this.data=o,this.metadataTypeAutocomplete=["Characteristics","Comment","Factor value","Other"],this.metadataNameAutocomplete=["Disease","Tissue","Subcellular location","Organism","Instrument","Label","Cleavage agent details","Dissociation method","Modification parameters","Cell type","Enrichment process"],this.metadataOtherAutocomplete=["Source name","Material type","Assay name","Technology type"],this.metadataCharacteristics=["Disease","Tissue","Subcellular location","Organism","Cell type","Cell line","Developmental stage","Ancestry category","Sex","Age","Biological replicate","Enrichment process"],this.metadataComment=["Data file","File uri","Technical replicate","Fraction identifier","Label","Cleavage agent details","Instrument","Modification parameters","Dissociation method","Precursor mass tolerance","Fragment mass tolerance",""],this.form=this.fb.group({metadataType:"Characteristics",metadataName:"Tissue",metadataValue:"",metadataMT:"Fixed",metadataPP:"Anywhere",metadataTA:"",metadataTS:"",metadataMM:0}),this.availableSpecs=[],this.filteredResults=ht([]),this.readonlyType=!1,this.readonlyName=!1,this.selectedData=void 0,this.optionsArray=[]}ngOnInit(){this.filteredResults=this.form.controls.metadataValue.valueChanges.pipe(Fe(""),Se(t=>t?t.length>=2:!1),De(t=>{if(!t)return ht([]);if(!this.form.controls.metadataName.value)return ht([]);let e=this.form.controls.metadataName.value.toLowerCase();return e==="subcellular location"?this.web.getSubcellularLocations(void 0,5,0,t).pipe(J(i=>i.results)):e==="disease"?this.web.getHumandDiseases(void 0,5,0,t).pipe(J(i=>i.results)):e==="tissue"?this.web.getTissues(void 0,5,0,t).pipe(J(i=>i.results)):e==="organism"?this.web.getSpecies(void 0,5,0,t).pipe(J(i=>i.results)):["cleavage agent details","instrument","dissociation method","enrichment process"].includes(e)?this.web.getMSVocab(void 0,5,0,t,e).pipe(J(i=>i.results)):e==="label"?this.web.getMSVocab(void 0,5,0,t,"sample attribute").pipe(J(i=>i.results)):e==="cell type"?this.web.getMSVocab(void 0,5,0,t,"cell line").pipe(J(i=>i.results)):e==="modification parameters"?this.web.getUnimod(void 0,5,0,t).pipe(J(i=>(this.optionsArray=i.results,i.results))):ht([])}))}close(){this.dialog.close()}submit(){this.dialog.close(this.form.value)}displayData(t){if(t){if("identifier"in t)return t.identifier;if("official_name"in t)return t.official_name;if("location_identifier"in t)return t.location_identifier;if("name"in t)return t.name}return""}getSelectedData(t){if(this.form.controls.metadataName.value&&this.form.controls.metadataName.value.toLowerCase()==="modification parameters"&&(this.selectedData=this.optionsArray.find(e=>e.name===t.option.value),this.selectedData)){let e={};for(let i of this.selectedData.additional_data)if(console.log(i),i.id==="delta_mono_mass"&&this.form.controls.metadataMM.setValue(parseFloat(i.description)),i.id.startsWith("spec_")){let s=`spec_${i.id.split("_")[1]}`;if(e[s]||(e[s]={name:s}),i.id.endsWith("position"))e[s].position=i.description;else if(i.id.endsWith("site"))e[s].aa=i.description;else if(i.id.endsWith("classification"))e[s].classification=i.description;else if(i.id.endsWith("mono_mass")){let d=parseFloat(i.description);d>0&&(e[s].mono_mass=d)}}console.log(e),this.availableSpecs=Object.values(e)}}selectSpec(t){t.position&&this.form.controls.metadataPP.setValue(t.position),t.aa&&this.form.controls.metadataTA.setValue(t.aa),t.mono_mass&&this.form.controls.metadataMM.setValue(t.mono_mass)}static{this.\u0275fac=function(e){return new(e||n)(G(rt),G(it),G(Q),G(St))}}static{this.\u0275cmp=j({type:n,selectors:[["app-analysis-group-metadata-creation-dialog"]],inputs:{readonlyType:"readonlyType",readonlyName:"readonlyName",metadataType:"metadataType",metadataName:"metadataName"},decls:30,vars:9,consts:[["autoMetadataName","matAutocomplete"],["autoMetadataType","matAutocomplete"],["autoMetadataValue","matAutocomplete"],["mat-dialog-title",""],["mat-dialog-content",""],[2,"display","flex","flex-direction","column","gap","20px",3,"formGroup"],["matInput","","formControlName","metadataName",3,"matAutocomplete","readonly"],["matInput","","formControlName","metadataType",3,"matAutocomplete","readonly"],["mat-dialog-actions",""],["mat-button","",3,"click"],["mat-button","",3,"click","disabled"],[3,"value"],["matInput","","formControlName","metadataValue",3,"matAutocomplete"],[3,"optionSelected"],["matInput","","formControlName","metadataValue"],[3,"valueChange"],["formControlName","metadataPP"],["formControlName","metadataMT"],["matInput","","formControlName","metadataTA"],["matInput","","type","number","formControlName","metadataMM"],["matInput","","type","text","formControlName","metadataTS"]],template:function(e,i){if(e&1){let o=N();r(0,"h1",3),c(1,"Adding New Metadata"),l(),r(2,"div",4)(3,"p"),c(4," For the metadata with dropdowns autocomplete options, unless you are sure that the value is not in the database, please try your best to select the value from the dropdown. "),l(),r(5,"form",5)(6,"mat-form-field"),V(7,"input",6),r(8,"mat-label"),c(9,"Metadata Name"),l(),r(10,"mat-autocomplete",null,0),F(12,ea,2,0)(13,na,2,0)(14,oa,2,0),l()(),F(15,ma,2,1),r(16,"mat-form-field"),V(17,"input",7),r(18,"mat-label"),c(19,"Metadata Type"),l(),r(20,"mat-autocomplete",null,1),E(22,ua,2,1,null,null,k),l()(),F(24,xa,1,1),l()(),r(25,"div",8)(26,"button",9),x("click",function(){return b(o),w(i.close())}),c(27,"Cancel"),l(),r(28,"button",10),x("click",function(){return b(o),w(i.submit())}),c(29,"Submit"),l()()}if(e&2){let o=K(11),s=K(21);m(5),y("formGroup",i.form),m(2),y("matAutocomplete",o)("readonly",i.readonlyName),m(5),v(i.form.value.metadataType==="Characteristics"?12:i.form.value.metadataType==="Comment"?13:14),m(3),v(i.form.value.metadataName?15:-1),m(2),y("matAutocomplete",s)("readonly",i.readonlyType),m(5),T(i.metadataTypeAutocomplete),m(2),v(i.form.value.metadataName?24:-1),m(4),y("disabled",!i.form.valid)}},dependencies:[lt,st,X,W,mt,ee,Z,Y,tt,et,Zt,se,dt,at,pt,ce,O,ct,nt,Ct,ie],encapsulation:2})}}return n})();var Ei=(()=>{class n{constructor(t,e){this.dialog=t,this.fb=e,this.form=this.fb.group({name:["",R.required],description:[""]})}close(){this.dialog.close()}submit(){this.form.invalid||this.dialog.close(this.form.value)}static{this.\u0275fac=function(e){return new(e||n)(G(rt),G(it))}}static{this.\u0275cmp=j({type:n,selectors:[["app-analysis-group-sample-file"]],decls:17,vars:1,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[2,"display","flex","flex-direction","column","gap","20px",3,"formGroup"],["matInput","","formControlName","name"],["matInput","","formControlName","description"],["mat-dialog-actions",""],["mat-button","",3,"click"]],template:function(e,i){e&1&&(r(0,"h1",0),c(1,"Adding Sample File"),l(),r(2,"div",1)(3,"form",2)(4,"mat-form-field"),V(5,"input",3),r(6,"mat-label"),c(7,"Sample Name"),l()(),r(8,"mat-form-field"),V(9,"textarea",4),r(10,"mat-label"),c(11,"Sample Description"),l()()()(),r(12,"div",5)(13,"button",6),x("click",function(){return i.close()}),c(14,"Cancel"),l(),r(15,"button",6),x("click",function(){return i.submit()}),c(16,"Submit"),l()()),e&2&&(m(3),y("formGroup",i.form))},dependencies:[lt,st,ct,O,X,W,mt,Z,Y,tt,et,at,nt,pt],encapsulation:2})}}return n})();function ga(n,a){if(n&1&&(r(0,"p")(1,"span",5),c(2),l()()),n&2){let t=a.$implicit;m(2),L(t)}}var Ti=(()=>{class n{constructor(t){this.dialog=t,this.errors=[]}close(){this.dialog.close()}static{this.\u0275fac=function(e){return new(e||n)(G(rt))}}static{this.\u0275cmp=j({type:n,selectors:[["app-analysis-group-sdrf-validation-dialog"]],inputs:{errors:"errors"},decls:9,vars:0,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[2,"display","flex","flex-direction","column","gap","20px"],["mat-dialog-actions",""],["mat-button","","type","button",3,"click"],[2,"color","red"]],template:function(e,i){e&1&&(r(0,"h1",0),c(1,"SDRF Validation"),l(),r(2,"div",1)(3,"div",2),E(4,ga,3,1,"p",null,k),l()(),r(6,"div",3)(7,"button",4),x("click",function(){return i.close()}),c(8,"Close"),l()()),e&2&&(m(4),T(i.errors))},dependencies:[lt,st,ct,O],encapsulation:2})}}return n})();function ba(n,a){if(n&1){let t=N();r(0,"button",5),x("click",function(){let i=b(t).$implicit,o=u(),s=K(3);return o.fileType=i,w(s.click())}),c(1),l()}if(n&2){let t=a.$implicit;m(),L(t)}}var Ii=(()=>{class n{constructor(t){this.web=t,this.importTypes=["Spectronaut Condition Setup File","SDRF"],this.fileProgressMap={},this.fileList=[],this.analysisGroupId=0,this.fileType="",this.allowFileType=["csv","txt","tsv"],this.fileUploaded=new z}submit(){}uploadData(t){return wt(this,null,function*(){let e=t.target.files;if(e){this.fileList=[];for(let i=0;i<e.length;i++)this.fileList.push(e[i]),this.fileProgressMap[e[i].name]={progress:0,total:e[i].size};for(let i=0;i<e.length;i++)yield this.uploadFile(e[i])}})}getFileExntension(t){let e=t.name.split(".");return e.length>1?e[e.length-1]:""}uploadFile(t){return wt(this,null,function*(){let i=t.size,o=new $t("SHA-256","ARRAYBUFFER"),s=this.getFileExntension(t);if(this.allowFileType.indexOf(s)!==-1)if(1048576>i&&this.web.searchSessionID){let d=yield t.arrayBuffer();o.update(d);let p=o.getHash("HEX"),f=yield this.web.uploadDataChunkComplete("",p,t,t.name).toPromise();this.fileProgressMap[t.name].progress=i,console.log(f),f?.completed_at&&this.web.bindUploadedMetadataFile(this.analysisGroupId,f?.id,this.fileType,this.web.searchSessionID).subscribe(C=>{})}else{let d="",p=0;for(;i>p;){let f=p+1048576;f>=i&&(f=i);let C=yield t.slice(p,f).arrayBuffer();o.update(C);let h=new File([C],t.name,{type:t.type});console.log(h.size);let g=`bytes ${p}-${f-1}/${i}`;console.log(g);let D=yield this.web.uploadDataChunk(d,h,t.name,g).toPromise();D&&(d=D.url,p=D.offset,this.fileProgressMap[t.name].progress=p)}if(d!==""){let f=o.getHash("HEX"),C=yield this.web.uploadDataChunkComplete(d,f).toPromise();C?.completed_at&&this.web.searchSessionID&&this.web.bindUploadedMetadataFile(this.analysisGroupId,C?.id,this.fileType,this.web.searchSessionID).subscribe(h=>{this.fileProgressMap[t.name].progress=i})}}})}static{this.\u0275fac=function(e){return new(e||n)(G(Q))}}static{this.\u0275cmp=j({type:n,selectors:[["app-analysis-group-metadata-import"]],inputs:{analysisGroupId:"analysisGroupId"},outputs:{fileUploaded:"fileUploaded"},decls:8,vars:1,consts:[["uploadFile",""],["importFileMenu","matMenu"],["mat-raised-button","","type","button",3,"matMenuTriggerFor"],["type","file","hidden","",3,"change"],["mat-menu-item",""],["mat-menu-item","",3,"click"]],template:function(e,i){if(e&1){let o=N();r(0,"button",2),c(1,"Import Metadata File"),l(),r(2,"input",3,0),x("change",function(d){return b(o),w(i.uploadData(d))}),l(),r(4,"mat-menu",null,1),E(6,ba,2,1,"button",4,k),l()}if(e&2){let o=K(5);y("matMenuTriggerFor",o),m(6),T(i.importTypes)}},dependencies:[O,de,pe,ue],encapsulation:2})}}return n})();var wa=["metaColAccordion"],Ce=(n,a)=>a.id;function Ma(n,a){n&1&&c(0,"(value modified)")}function va(n,a){if(n&1&&c(0),n&2){let t=u(2).$implicit,e=u();$(" ",e.data.metadataHintMap[t.name]," ")}}function Sa(n,a){if(n&1&&(r(0,"mat-option",20),c(1),l()),n&2){let t=a.$implicit,e=u(3);y("value",e.displayData(t)),m(),$(" ",e.displayData(t)," ")}}function Fa(n,a){if(n&1){let t=N();r(0,"button",22),x("click",function(){b(t);let i=u(3).$implicit,o=u();return o.metadataDeleted.emit(i),w(o.markedForDeletion.push(i))}),r(1,"mat-icon"),c(2,"delete"),l()()}if(n&2){let t=u(4);y("disabled",!t.canEdit)("matTooltip","Mark for deletion")}}function Da(n,a){if(n&1){let t=N();r(0,"button",22),x("click",function(){b(t);let i=u(3).$implicit,o=u();return w(o.undoDeletion(i))}),r(1,"mat-icon"),c(2,"undo"),l()()}if(n&2){let t=u(4);y("disabled",!t.canEdit)("matTooltip","Undo deletion mark")}}function Aa(n,a){if(n&1&&F(0,Fa,3,2,"button",21)(1,Da,3,2,"button",21),n&2){let t=u(2).$implicit,e=u();v(e.markedForDeletion.includes(t)?1:0)}}function Ga(n,a){if(n&1&&(r(0,"form",17)(1,"mat-form-field",18)(2,"textarea",19),c(3,`
            `),l(),r(4,"mat-label"),c(5),l(),r(6,"mat-hint"),F(7,Ma,1,0),c(8,". "),F(9,va,1,1),l()(),r(10,"mat-autocomplete",null,1),E(12,Sa,2,2,"mat-option",20,k),Ht(14,"async"),l(),F(15,Aa,2,1),l()),n&2){let t=K(11),e=u().$implicit,i=u();y("formGroup",i.metadataFormMap[e.id]),m(2),y("readonly",!i.canEdit)("disabled",i.markedForDeletion.includes(e))("matAutocomplete",t),m(3),L(e.name),m(2),v(i.metadataFormMap[e.id].dirty?7:-1),m(2),v(i.data.metadataHintMap[e.name]?9:-1),m(3),T(Ot(14,8,i.autoCompleteMap[e.id])),m(3),v(e.mandatory?15:-1)}}function Ea(n,a){if(n&1&&F(0,Ga,16,10,"form",17),n&2){let t=a.$implicit,e=u();v(e.metadataFormMap[t.id]?0:-1)}}function Ta(n,a){if(n&1){let t=N();r(0,"app-analysis-group-metadata-import",23),x("fileUploaded",function(i){b(t);let o=u();return w(o.handleImportedData(i))}),l()}if(n&2){let t=u();y("analysisGroupId",t.analysis_group_id)}}function Ia(n,a){n&1&&V(0,"mat-progress-bar",14)}function ka(n,a){if(n&1&&(c(0),V(1,"mat-progress-bar",24)),n&2){let t=u();$(" ",t.sdrfImportingText," "),m(),y("value",t.sdrfImportingProgress)}}function Va(n,a){n&1&&c(0,"Value changed")}function Na(n,a){n&1&&c(0,"Value changed")}function La(n,a){if(n&1&&(r(0,"form",25)(1,"mat-form-field",29),V(2,"input",30),r(3,"mat-label"),c(4,"Source File Sample Name"),l(),r(5,"mat-hint"),F(6,Va,1,0),l()(),r(7,"mat-form-field",29),V(8,"textarea",31),r(9,"mat-label"),c(10,"Source File Sample Description"),l(),r(11,"mat-hint"),F(12,Na,1,0),l()()()),n&2){let t=u().$implicit,e=u(2);y("formGroup",e.sourcefileFormMap[t.id]),m(6),v(e.sourcefileFormMap[t.id].controls.name.dirty?6:-1),m(6),v(e.sourcefileFormMap[t.id].controls.description.dirty?12:-1)}}function Pa(n,a){if(n&1){let t=N();r(0,"button",32),x("click",function(){b(t);let i=u().$implicit,o=u(2);return w(o.removeSampleFile(i.id))}),r(1,"mat-icon"),c(2,"delete"),l()()}if(n&2){let t=u(3);y("disabled",!t.canEdit)("matTooltip","Remove this source file")}}function Ra(n,a){n&1&&c(0,"(value modified)")}function $a(n,a){if(n&1&&c(0),n&2){let t=u(2).$implicit,e=u(3);$(" ",e.data.metadataHintMap[t.name]," ")}}function Ba(n,a){n&1&&(r(0,"mat-icon"),c(1,"delete"),l())}function Ua(n,a){n&1&&(r(0,"mat-icon"),c(1,"undo"),l())}function ja(n,a){if(n&1){let t=N();r(0,"button",42),x("click",function(){b(t);let i=u(3).$implicit,o=u(3);return w(o.markForDeleteOrUndo(i))}),F(1,Ba,2,0,"mat-icon")(2,Ua,2,0,"mat-icon"),l()}if(n&2){let t=u(3).$implicit,e=u(3);m(),v(e.metadataFormMap[t.id].controls.value.disabled?2:1)}}function Ha(n,a){if(n&1&&F(0,ja,3,1,"button",41),n&2){let t=u(2).$implicit;v(t.mandatory?-1:0)}}function Oa(n,a){if(n&1&&(r(0,"mat-option",20),c(1),l()),n&2){let t=a.$implicit,e=u(5);y("value",e.displayData(t)),m(),$(" ",e.displayData(t)," ")}}function qa(n,a){if(n&1){let t=N();r(0,"form",33)(1,"div",8)(2,"mat-form-field",18),V(3,"textarea",34),r(4,"mat-label"),c(5),l(),r(6,"mat-hint"),c(7),F(8,Ra,1,0),c(9),F(10,$a,1,1),l(),F(11,Ha,1,1),r(12,"mat-autocomplete",null,4),E(14,Oa,2,2,"mat-option",20,k),Ht(16,"async"),l()(),r(17,"div")(18,"mat-checkbox",35),x("click",function(){b(t);let i=u().$implicit,o=u(3);return w(o.updateNotApplicable(i))}),c(19,"Field not applicable"),l(),r(20,"div")(21,"button",36)(22,"mat-icon"),c(23,"drag_handle"),l()(),r(24,"button",37)(25,"mat-icon"),c(26,"copy_all"),l()(),r(27,"mat-menu",null,5)(29,"button",38),x("click",function(){b(t);let i=u().$implicit,o=u(3);return w(o.copyMetadata(i,!0))}),c(30),l(),r(31,"button",38),x("click",function(){b(t);let i=u().$implicit,o=u(3);return w(o.copyMetadata(i,!1))}),c(32),l()(),r(33,"button",39)(34,"mat-icon"),c(35,"arrow_forward"),l()(),r(36,"mat-menu",null,6)(38,"button",40),x("click",function(){b(t);let i=u().$implicit,o=u().$index,s=u(2);return w(s.navigateToSourceFile(i.column_position,o,"next"))}),c(39,"Next file"),l(),r(40,"button",40),x("click",function(){b(t);let i=u().$implicit,o=u().$index,s=u(2);return w(s.navigateToSourceFile(i.column_position,o,"previous"))}),c(41,"Previous file"),l()()()()()()}if(n&2){let t=K(13),e=K(28),i=K(37),o=u().$implicit,s=u().$implicit,d=u(2);Ge("id","metadata-column-",s.id,"-",o.id,""),y("formGroup",d.metadataFormMap[o.id])("cdkDragData",o),m(3),y("matAutocomplete",t),m(2),L(o.name),m(2),$("",o.type," "),m(),v(d.metadataFormMap[o.id].dirty?8:-1),m(),$(" - Position ",o.column_position,". "),m(),v(d.data.metadataHintMap[o.name]?10:-1),m(),v(d.canEdit?11:-1),m(3),T(Ot(16,19,d.autoCompleteMap[o.id])),m(10),y("matMenuTriggerFor",e),m(6),$("Copy value and fill in blank metadata at the same position ",o.column_position,""),m(2),$("Copy value and replace metadata at the same position ",o.column_position,""),m(),y("matMenuTriggerFor",i)("matTooltip","Navigate to next or previous source file"),m(5),y("matTooltip","Navigate to position "+o.column_position+" in the next file"),m(2),y("matTooltip","Navigate to position "+o.column_position+" in the previous file")}}function za(n,a){if(n&1&&F(0,qa,42,21,"form",33),n&2){let t=a.$implicit,e=u(3);v(e.metadataFormMap[t.id]?0:-1)}}function Ka(n,a){}function Ya(n,a){if(n&1){let t=N();r(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title"),c(3),l(),r(4,"mat-panel-description"),c(5),l()(),r(6,"div",7)(7,"mat-menu",null,3)(9,"button",13),x("click",function(){let i=b(t).$implicit,o=u(2);return w(o.createMetadataFileSpecific("disease",i.id))}),c(10,"Disease"),l(),r(11,"button",13),x("click",function(){let i=b(t).$implicit,o=u(2);return w(o.createMetadataFileSpecific("tissue",i.id))}),c(12,"Tissue"),l(),r(13,"button",13),x("click",function(){let i=b(t).$implicit,o=u(2);return w(o.createMetadataFileSpecific("subcellular location",i.id))}),c(14,"Subcellular location"),l(),r(15,"button",13),x("click",function(){let i=b(t).$implicit,o=u(2);return w(o.createMetadataFileSpecific("organism",i.id))}),c(16,"Organism"),l(),r(17,"button",13),x("click",function(){let i=b(t).$implicit,o=u(2);return w(o.createMetadataFileSpecific("modification",i.id))}),c(18,"Modification"),l(),r(19,"button",13),x("click",function(){let i=b(t).$implicit,o=u(2);return w(o.createMetadataFileSpecific("cell type",i.id))}),c(20,"Cell type"),l(),r(21,"button",13),x("click",function(){let i=b(t).$implicit,o=u(2);return w(o.createMetadataFileSpecific("enrichment process",i.id))}),c(22,"Enrichment process"),l(),r(23,"button",13),x("click",function(){let i=b(t).$implicit,o=u(2);return w(o.createMetadataFileSpecific("technology type",i.id))}),c(24,"Technology type"),l(),r(25,"button",13),x("click",function(){let i=b(t).$implicit,o=u(2);return w(o.createMetadataFileSpecific("label",i.id))}),c(26,"Label"),l(),r(27,"button",13),x("click",function(){let i=b(t).$implicit,o=u(2);return w(o.createMetadataFileSpecific("assay name",i.id))}),c(28,"Assay name"),l(),r(29,"button",13),x("click",function(){let i=b(t).$implicit,o=u(2);return w(o.createMetadataFileSpecific(null,i.id))}),c(30,"Create custom metadata field"),l()(),r(31,"div",8),F(32,La,13,3,"form",25),r(33,"div",18)(34,"div",8)(35,"button",26)(36,"mat-icon"),c(37,"add"),l()(),F(38,Pa,3,2,"button",27),l(),r(39,"h5"),c(40,"Metadata Annotation"),l(),r(41,"div",28),x("cdkDropListDropped",function(i){let o=b(t).$implicit,s=u(2);return w(s.drop(i,o))}),E(42,za,1,1,null,null,Ce),l()()()(),r(44,"div",7),E(45,Ka,0,0,null,null,Ce),l()()}if(n&2){let t=a.$implicit,e=K(8),i=u(2);m(3),$(" ",t.name," "),m(2),$(" ",t.description," "),m(27),v(i.sourcefileFormMap[t.id]?32:-1),m(3),y("disabled",!i.canEdit)("matTooltip","Add new metadata annotation")("matMenuTriggerFor",e),m(3),v(i.canEdit?38:-1),m(4),T(t.metadata_columns),m(3),T(t.metadata_columns)}}function Wa(n,a){if(n&1&&(r(0,"mat-accordion",16,2),E(2,Ya,47,7,"mat-expansion-panel",null,Ce),l()),n&2){let t=u();m(2),T(t.sourceFiles)}}var ki=(()=>{class n{set metadata(t){this._metadata=t.filter(e=>!e.source_file);for(let e of this._metadata)this.metadataFormMap[e.id]=this.fb.group({value:[e.value],name:[e.name],type:[e.type]}),this.metadataFormMap[e.id].valueChanges.subscribe(i=>{i.value&&this.updateValueField(e,i.value)})}get metadata(){return this._metadata}set sourceFiles(t){this._sourceFiles=t,this.sourceFileMap={};for(let e of t){this.sourceFileMap[e.id]=e,this.sourcefileFormMap[e.id]=this.fb.group({name:[e.name],description:[e.description]});for(let i of e.metadata_columns)this.metadataFormMap[i.id]=this.fb.group({value:[i.value],name:[i.name],type:[i.type],not_applicable:[i.not_applicable]}),i.not_applicable?this.metadataFormMap[i.id].controls.value.disable():this.metadataFormMap[i.id].controls.value.enable(),this.metadataFormMap[i.id].controls.value.valueChanges.subscribe(o=>{this.updateValueField(i,o)})}}get sourceFiles(){return this._sourceFiles}constructor(t,e,i,o,s,d){this.sb=t,this.web=e,this.dialog=i,this.fb=o,this.ws=s,this.data=d,this.sdrfValidating=!1,this.sdrfImportingProgress=0,this.sdrfImportingText="",this.sdrfImporting=!1,this.displayedColumns=["metadataType","metadataName","metadataValue"],this.analysis_group_id=0,this._metadata=[],this.metadataFormMap={},this.sourcefileFormMap={},this.export_job_id="",this._sourceFiles=[],this.metadataChange=new z,this.metadataDeleted=new z,this.sourceFilesChanged=new z,this.sourceFileMetadataDeleted=new z,this.reorderMetadataSourceFiles=new z,this.metadataImported=new z,this.markedForDeletion=[],this.canEdit=!1,this.autoCompleteMap={},this.sourceFileMap={},this.ws.curtainWSConnection?.subscribe(p=>{if(p.analysis_group_id===this.analysis_group_id){if(p.type==="export_sdrf_status")p.status==="complete"&&"job_id"in p&&"file"in p&&p.job_id===this.export_job_id&&(console.log(p),window.open(`${this.web.baseURL}/api/search/download_temp_file/?token=${p.file}`));else if(p.type==="sdrf_validation"){if(this.sdrfValidating=!1,p.status==="error"){let f=this.dialog.open(Ti);"errors"in p&&(f.componentInstance.errors=p.errors)}}else if(p.type==="sdrf_import")if(p.status==="in_progress"){if("progress"in p){this.sdrfImporting=!0;let f=p.progress;f>this.sdrfImportingProgress&&(this.sdrfImportingProgress=f,this.sdrfImportingText=`Importing data ${f.toFixed(2)}%`)}}else p.status==="complete"&&this.sourceFiles.length>0&&(this.sdrfImportingProgress=50,this.sdrfImportingText="Retrieving updated Data.",this.sb.open("Retrieving updated Data.","Dismiss",{duration:5e3}),this.web.getAnalysisGroup(this.analysis_group_id).subscribe(f=>{this.sb.open("Data imported","Dismiss",{duration:5e3}),this.sdrfImporting=!1,this.sdrfImportingProgress=0,this.sdrfImportingText="",this.handleImportedData(f)}))}})}updateValueField(t,e){if(this.autoCompleteMap[t.id]||(this.autoCompleteMap[t.id]=ht([])),e){if(e.length<2){this.autoCompleteMap[t.id]=ht([]);return}}else{this.autoCompleteMap[t.id]=ht([]);return}let i=t.name.toLowerCase();i==="subcellular location"?this.autoCompleteMap[t.id]=this.web.getSubcellularLocations(void 0,5,0,e).pipe(J(o=>o.results)):i==="disease"?this.autoCompleteMap[t.id]=this.web.getHumandDiseases(void 0,5,0,e).pipe(J(o=>o.results)):i==="tissue"?this.autoCompleteMap[t.id]=this.web.getTissues(void 0,5,0,e).pipe(J(o=>o.results)):i==="organism"?this.autoCompleteMap[t.id]=this.web.getSpecies(void 0,5,0,e).pipe(J(o=>o.results)):["cleavage agent details","instrument","dissociation method"].includes(i)?this.autoCompleteMap[t.id]=this.web.getMSVocab(void 0,5,0,e,i).pipe(J(o=>o.results)):i==="label"?this.autoCompleteMap[t.id]=this.web.getMSVocab(void 0,5,0,e,"sample attribute").pipe(J(o=>o.results)):i==="cell type"?this.autoCompleteMap[t.id]=this.web.getMSVocab(void 0,5,0,e,"cell line").pipe(J(o=>o.results)):this.autoCompleteMap[t.id]=ht([])}ngOnInit(){}createMetadata(t=null){let e=this.dialog.open(ve);if(t)switch(e.componentInstance.readonlyType=!0,e.componentInstance.readonlyName=!0,t){case"subcellular location":e.componentInstance.metadataName="Subcellular location",e.componentInstance.metadataType="Characteristics";break;case"disease":e.componentInstance.metadataName="Disease",e.componentInstance.metadataType="Characteristics";break;case"tissue":e.componentInstance.metadataName="Tissue",e.componentInstance.metadataType="Characteristics";break;case"organism":e.componentInstance.metadataName="Organism",e.componentInstance.metadataType="Characteristics";break;case"cell type":e.componentInstance.metadataName="Cell type",e.componentInstance.metadataType="Characteristics";break;case"enrichment process":e.componentInstance.metadataName="Enrichment process",e.componentInstance.metadataType="Characteristics";break;case"technology type":e.componentInstance.metadataName="Technology type",e.componentInstance.metadataType="";break;case"assay name":e.componentInstance.metadataName="Assay name",e.componentInstance.metadataType="";break;case"label":e.componentInstance.metadataName="Label",e.componentInstance.metadataType="";break}e.afterClosed().subscribe(i=>{i&&this.web.createMetaDataColumn(this.analysis_group_id,i).subscribe(o=>{this.metadata.push(...o),this.metadataChange.emit(this.metadata);for(let s of o)this.metadataFormMap[s.id]=this.fb.group({value:[s.value],name:[s.name],type:[s.type]}),this.metadataFormMap[s.id].valueChanges.subscribe(d=>{d.value&&this.updateValueField(s,d.value)})})})}undoDeletion(t){this.markedForDeletion=this.markedForDeletion.filter(e=>e!==t),this.metadataDeleted.emit(t)}displayData(t){return t?"identifier"in t?t.identifier:"official_name"in t?t.official_name:"name"in t?t.name:t.location_identifier:""}addSampleFile(){this.dialog.open(Ei).afterClosed().subscribe(e=>{e&&e.name&&this.web.createSourceFile(this.analysis_group_id,e.name,e.description).subscribe(i=>{this.sourceFiles.push(i),this.sourcefileFormMap[i.id]=this.fb.group({name:[i.name],description:[i.description]});for(let o of i.metadata_columns)this.metadataFormMap[o.id]=this.fb.group({value:[o.value],name:[o.name],type:[o.type],not_applicable:[o.not_applicable]}),this.metadataFormMap[o.id].controls.value.valueChanges.subscribe(s=>{this.updateValueField(o,s)});this.sourceFilesChanged.emit(this.sourceFiles)})})}removeSampleFile(t){this.dialog.open(zt).afterClosed().subscribe(i=>{i&&this.web.deleteSourceFile(t).subscribe(()=>{this.sourceFiles=this.sourceFiles.filter(o=>o.id!==t),this.sourceFilesChanged.emit(this.sourceFiles)})})}createMetadataFileSpecific(t=null,e){let i=this.dialog.open(ve);if(t)switch(i.componentInstance.readonlyType=!0,i.componentInstance.readonlyName=!0,t){case"subcellular location":i.componentInstance.metadataName="Subcellular location",i.componentInstance.metadataType="Characteristics";break;case"disease":i.componentInstance.metadataName="Disease",i.componentInstance.metadataType="Characteristics";break;case"tissue":i.componentInstance.metadataName="Tissue",i.componentInstance.metadataType="Characteristics";break;case"organism":i.componentInstance.metadataName="Organism",i.componentInstance.metadataType="Characteristics";break;case"modification":i.componentInstance.metadataName="Modification parameters",i.componentInstance.metadataType="Comment";break;case"enrichment process":i.componentInstance.metadataName="Enrichment process",i.componentInstance.metadataType="Characteristics";break;case"cell type":i.componentInstance.metadataName="Cell type",i.componentInstance.metadataType="Characteristics";break;case"technology type":i.componentInstance.metadataName="Technology type",i.componentInstance.metadataType="";break;case"assay name":i.componentInstance.metadataName="Assay name",i.componentInstance.metadataType="";break;case"label":i.componentInstance.metadataName="Label",i.componentInstance.metadataType="";break}i.afterClosed().subscribe(o=>{o&&this.web.createMetaDataColumn(this.analysis_group_id,o,e).subscribe(s=>{for(let d of s){let p=d.source_file?.toString();p&&(this.sourceFileMap[p].metadata_columns.push(d),this.sourceFileMap[p].metadata_columns=[...this.sourceFileMap[p].metadata_columns],this.metadataFormMap[d.id]=this.fb.group({value:[d.value],name:[d.name],type:[d.type],not_applicable:[d.not_applicable]}),this.metadataFormMap[d.id].controls.value.valueChanges.subscribe(f=>{this.updateValueField(d,f)}))}})})}updateMetadata(t){this.web.updateMetaDataColumn(t.id,void 0,void 0,t.value).subscribe(()=>{t.source_file&&(this.sourceFileMap[t.source_file].metadata_columns=this.sourceFileMap[t.source_file].metadata_columns.map(e=>e.id===t.id?t:e))})}markForDeleteOrUndo(t){if(this.metadataFormMap[t.id].controls.not_applicable)return;let i=this.sourceFiles.map(s=>s.metadata_columns).flat().filter(s=>s.column_position===t.column_position);this.metadataFormMap[t.id].controls.value.disabled?(this.metadataFormMap[t.id].controls.value.enable(),this.markedForDeletion.includes(t)&&(this.markedForDeletion=this.markedForDeletion.filter(s=>s!==t))):(this.metadataFormMap[t.id].controls.value.disable(),this.markedForDeletion.includes(t)||this.markedForDeletion.push(t));for(let s of i)s!==t&&(this.markedForDeletion=this.markedForDeletion.filter(p=>p!==s),this.metadataFormMap[t.id].controls.value.disabled?this.metadataFormMap[s.id].controls.value.disable():this.metadataFormMap[s.id].controls.value.enable());this.sourceFileMetadataDeleted.emit(t)}drop(t,e){let i=t.previousIndex,o=t.currentIndex,s=t.item.data,d=[],p=e.metadata_columns[o].column_position;this.sourceFiles.forEach(f=>{if(Qe(f.metadata_columns,i,o),f.metadata_columns[o].column_position=p,d.push(f.metadata_columns[o]),o>i)for(let C=i;C<=o;C++)f.metadata_columns[C].column_position-=1,d.push(f.metadata_columns[C]);else for(let C=o+1;C<=i;C++)f.metadata_columns[C].column_position+=1,d.push(f.metadata_columns[C])}),this.reorderMetadataSourceFiles.emit(d)}exportSDRF(){let e=new he(this.sourceFiles).convertToTSV(),i=new Blob([e],{type:"text/plain;charset=utf-8"}),o=window.URL.createObjectURL(i),s=document.createElement("a");s.href=o,s.download="analysis_group_metadata.tsv",document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(o)}exportSDRFFromBackend(){this.web.searchSessionID&&this.web.exportSDRFFile(this.analysis_group_id,this.web.searchSessionID).subscribe(t=>{this.export_job_id=t.job_id,console.log(t)})}updateNotApplicable(t){let i=this.sourceFiles.map(o=>o.metadata_columns).flat().filter(o=>o.column_position===t.column_position);for(let o of i)o!==t&&(this.metadataFormMap[o.id].controls.not_applicable.setValue(!t.not_applicable),this.metadataFormMap[o.id].markAsDirty(),o.not_applicable=!t.not_applicable,o.not_applicable?this.metadataFormMap[o.id].controls.value.disable():this.metadataFormMap[o.id].controls.value.enable());t.not_applicable=!t.not_applicable,t.not_applicable?this.metadataFormMap[t.id].controls.value.disable():this.metadataFormMap[t.id].controls.value.enable()}validateSDRF(){this.web.searchSessionID&&(this.sdrfValidating=!0,this.web.validateSDRFFile(this.analysis_group_id,this.web.searchSessionID).subscribe(t=>{},t=>{this.sdrfValidating=!1,this.sb.open("Error validating SDRF file","Close",{duration:5e3})}))}handleImportedData(t){this.metadataImported.emit(t)}copyMetadata(t,e){if(this.metadataFormMap[t.id].controls.value.dirty){this.sb.open("Please save the metadata before copying","Close",{duration:5e3});return}this.web.copyMetadataValueToAllInSamePosition(t.id,e).subscribe(i=>{for(let o of i)o.source_file&&(this.sourceFileMap[o.source_file].metadata_columns=this.sourceFileMap[o.source_file].metadata_columns.map(s=>s.id===o.id?(this.metadataFormMap[o.id].controls.value.patchValue(o.value),o):s))})}reorderAnalysisGroupMetadataColumn(){this.sourceFiles.length>0&&this.web.analysisGroupReorderColumns(this.analysis_group_id).subscribe(t=>{this.sourceFiles=t.source_files,this.sb.open("Metadata columns reordered","Dismiss",{duration:5e3})})}navigateToSourceFile(t,e,i){if(t!==-1){let o=i==="next"?e+1:e-1;if(o>=0&&o<this.sourceFiles.length){let s=this.sourceFiles[o],d=s.metadata_columns.find(p=>p.column_position===t);if(d&&this.expansionPanels){let p=this.expansionPanels.toArray()[o];if(p)if(p.expanded){let f=setInterval(()=>{let C=document.getElementById(`metadata-column-${s.id}-${d.id}`);C&&(C.scrollIntoView({behavior:"smooth"}),clearInterval(f))},300)}else{p.open();let f=setInterval(()=>{let C=document.getElementById(`metadata-column-${s.id}-${d.id}`);C&&(C.scrollIntoView({behavior:"smooth"}),clearInterval(f))},300)}}}}}static{this.\u0275fac=function(e){return new(e||n)(G(Vt),G(Q),G(te),G(it),G(Nt),G(St))}}static{this.\u0275cmp=j({type:n,selectors:[["app-analysis-group-general-metadata"]],viewQuery:function(e,i){if(e&1&&(Et(wa,5),Et(qt,5)),e&2){let o;Tt(o=It())&&(i.metaColAccordion=o.first),Tt(o=It())&&(i.expansionPanels=o)}},inputs:{analysis_group_id:"analysis_group_id",metadata:"metadata",sourceFiles:"sourceFiles",canEdit:"canEdit"},outputs:{metadataChange:"metadataChange",metadataDeleted:"metadataDeleted",sourceFilesChanged:"sourceFilesChanged",sourceFileMetadataDeleted:"sourceFileMetadataDeleted",reorderMetadataSourceFiles:"reorderMetadataSourceFiles",metadataImported:"metadataImported"},decls:50,vars:10,consts:[["metadataMenu","matMenu"],["autoMetadataValue","matAutocomplete"],["metaColAccordion",""],["metadataMenuFileSpecific","matMenu"],["autoMetadataSourceFileValue","matAutocomplete"],["copyMenu",""],["navigateMenu",""],[2,"display","flex","flex-direction","column","gap","20px"],[2,"display","flex","gap","20px"],["mat-flat-button","","type","button","color","primary",3,"disabled","matMenuTriggerFor"],["mat-flat-button","","type","button","color","primary",3,"click","disabled"],["mat-icon-button","","type","button","color","warn",3,"click","matTooltip"],[3,"analysisGroupId"],["mat-menu-item","",3,"click"],["mode","indeterminate"],["href","https://github.com/bigbio/proteomics-sample-metadata/tree/master/sdrf-proteomics","target","_blank"],["multi",""],[2,"display","flex","gap","20px",3,"formGroup"],[2,"flex-grow","1"],["matInput","","formControlName","value",3,"readonly","disabled","matAutocomplete"],[3,"value"],["mat-icon-button","","type","button",3,"disabled","matTooltip"],["mat-icon-button","","type","button",3,"click","disabled","matTooltip"],[3,"fileUploaded","analysisGroupId"],["mode","determinate",3,"value"],[2,"width","300px",3,"formGroup"],["type","button","mat-icon-button","",3,"disabled","matTooltip","matMenuTriggerFor"],["type","button","mat-icon-button","",3,"disabled","matTooltip"],["cdkDropList","",2,"display","flex","flex-direction","column","gap","20px",3,"cdkDropListDropped"],[2,"width","100%"],["matInput","","formControlName","name"],["matInput","","formControlName","description"],["type","button","mat-icon-button","",3,"click","disabled","matTooltip"],["cdkDrag","",3,"id","formGroup","cdkDragData"],["matInput","","formControlName","value",3,"matAutocomplete"],["formControlName","not_applicable",3,"click"],["mat-icon-button","","type","button","cdkDragHandle",""],["mat-icon-button","","type","button",3,"matMenuTriggerFor"],["type","button","mat-menu-item","",3,"click"],["mat-icon-button","","type","button",3,"matMenuTriggerFor","matTooltip"],["type","button","mat-menu-item","",3,"click","matTooltip"],["type","button","mat-icon-button","","matSuffix",""],["type","button","mat-icon-button","","matSuffix","",3,"click"]],template:function(e,i){if(e&1){let o=N();r(0,"div",7)(1,"h3"),c(2,"Metadata"),l(),r(3,"div",7),E(4,Ea,1,1,null,null,Ce),l(),r(6,"div",8)(7,"button",9),c(8,"+ Analysis Wide Metadata"),l(),r(9,"button",10),x("click",function(){return b(o),w(i.addSampleFile())}),c(10,"+ Sample File"),l(),r(11,"button",11),x("click",function(){return b(o),w(i.validateSDRF())}),r(12,"mat-icon"),c(13,"fact_check"),l()(),r(14,"button",11),x("click",function(){return b(o),w(i.exportSDRFFromBackend())}),r(15,"mat-icon"),c(16,"download"),l()(),r(17,"button",11),x("click",function(){return b(o),w(i.reorderAnalysisGroupMetadataColumn())}),r(18,"mat-icon"),c(19,"sort"),l()(),F(20,Ta,1,1,"app-analysis-group-metadata-import",12),l(),r(21,"mat-menu",null,0)(23,"button",13),x("click",function(){return b(o),w(i.createMetadata("disease"))}),c(24,"Disease"),l(),r(25,"button",13),x("click",function(){return b(o),w(i.createMetadata("tissue"))}),c(26,"Tissue"),l(),r(27,"button",13),x("click",function(){return b(o),w(i.createMetadata("subcellular location"))}),c(28,"Subcellular location"),l(),r(29,"button",13),x("click",function(){return b(o),w(i.createMetadata("organism"))}),c(30,"Organism"),l(),r(31,"button",13),x("click",function(){return b(o),w(i.createMetadata("cell type"))}),c(32,"Cell type"),l(),r(33,"button",13),x("click",function(){return b(o),w(i.createMetadata("enrichment process"))}),c(34,"Enrichment process"),l(),r(35,"button",13),x("click",function(){return b(o),w(i.createMetadata("technology type"))}),c(36,"Technology type"),l(),r(37,"button",13),x("click",function(){return b(o),w(i.createMetadata("label"))}),c(38,"Label"),l(),r(39,"button",13),x("click",function(){return b(o),w(i.createMetadata())}),c(40,"Create custom metadata field"),l()(),F(41,Ia,1,0,"mat-progress-bar",14)(42,ka,2,2),r(43,"p"),c(44," Cinder utilizes the Sample Data Relationship Format for exporting data into tabulated text format. For more information and detail specification please visit: "),r(45,"a",15),c(46,"https://github.com/bigbio/proteomics-sample-metadata/tree/master/sdrf-proteomics"),l(),V(47,"br"),c(48," Any analysis wide metadata will be applied to all source files' new metadata fields of the same name and type. "),l(),F(49,Wa,4,0,"mat-accordion",16),l()}if(e&2){let o=K(22);m(4),T(i.metadata),m(3),y("disabled",!i.canEdit)("matMenuTriggerFor",o),m(2),y("disabled",!i.canEdit),m(2),y("matTooltip","Validate SDRF file"),m(3),y("matTooltip","Export SDRF file"),m(3),y("matTooltip","Automatically reorder metadata in order of characteristics, non-type, comment, factor value columns"),m(3),v(i.canEdit?20:-1),m(21),v(i.sdrfValidating?41:-1),m(),v(i.sdrfImporting?42:-1),m(7),v(i.sourceFiles.length>0?49:-1)}},dependencies:[O,Mt,vt,kt,W,mt,Z,Y,pt,at,nt,Zt,se,dt,ce,Ne,de,pe,ue,le,qt,re,oe,ae,ie,X,tt,et,Te,ti,Ze,Je,ei,Lt,Ii],encapsulation:2})}}return n})();var Xa=["generalMetadata"];function Qa(n,a){if(n&1){let t=N();r(0,"div",3)(1,"app-volcano-plot",4),x("selected",function(i){b(t);let o=u(2);return w(o.handleVolcanoSelection(i))}),l()()}if(n&2){let t=u(2);m(),y("plotType",t.analysisGroup.analysis_group_type)("curtainData",t.curtainData)}}function Ja(n,a){if(n&1&&F(0,Qa,2,2,"div",3),n&2){let t=u();v(t.analysisGroup?0:-1)}}function Za(n,a){if(n&1&&(r(0,"p")(1,"b"),c(2,"Associated Project: "),l(),r(3,"a",19),c(4),l()()),n&2){let t=u(2);m(3),Ae("href","/#/project/",t.analysisGroup.project,"",ye),m(),L(t.associatedProject.name)}}function to(n,a){if(n&1&&(r(0,"p")(1,"b"),c(2,"Curtain Link: "),l(),r(3,"a",19),c(4),l()()),n&2){let t=u(2);m(3),Jt("href",t.analysisGroup.curtain_link,ye),m(),L(t.analysisGroup.curtain_link)}}function eo(n,a){if(n&1){let t=N();V(0,"mat-divider"),r(1,"app-analysis-group-general-metadata",20,0),x("metadataImported",function(i){b(t);let o=u(2);return w(o.handleMetadataImport(i))})("reorderMetadataSourceFiles",function(i){b(t);let o=u(2);return w(o.reorderMetadataColumn(i))})("sourceFilesChanged",function(i){b(t);let o=u(2);return w(o.analysisGroup.source_files=i)})("metadataDeleted",function(i){b(t);let o=u(2);return w(o.updateDeletionList(i))})("sourceFileMetadataDeleted",function(i){b(t);let o=u(2);return w(o.updateDeletionListSourceFile(i))}),l()}if(n&2){let t=u(2);m(),y("sourceFiles",t.analysisGroup.source_files)("canEdit",t.canEdit)("analysis_group_id",t.analysisGroup.id)("metadata",t.analysisGroup.metadata_columns)}}function io(n,a){if(n&1&&(r(0,"p"),c(1),l(),V(2,"mat-progress-bar",21)),n&2){let t=u(2);m(),L(t.composingCurtainProgress.message),m(),y("value",t.composingCurtainProgress.progress)("mode","determinate")("color","primary")}}function no(n,a){if(n&1){let t=N();r(0,"button",22),x("click",function(){b(t);let i=u(2);return w(i.composeDataFromCurtain())}),c(1,"Use Curtain Link For Data"),l()}if(n&2){let t=u(2);y("disabled",!t.canEdit)}}function ao(n,a){if(n&1&&c(0),n&2){let t=u(2);$(": ",t.analysisGroupDF.name,"")}}function oo(n,a){if(n&1){let t=N();r(0,"app-upload-file",23),x("fileUploaded",function(i){b(t);let o=u(2);return w(o.handleFileUploaded(i,"df"))}),l()}if(n&2){let t=u(2);y("analysisGroupId",t.analysisGroup.id)("fileCategory","df")}}function ro(n,a){if(n&1){let t=N();r(0,"button",24),x("click",function(){b(t);let i=u(3);return w(i.deleteFile(i.analysisGroupDF))}),r(1,"mat-icon"),c(2,"delete"),l()(),r(3,"button",25),x("click",function(){b(t);let i=u(3);return w(i.openExtraDataModal(i.analysisGroupDF))}),c(4,"Extra Data"),l()}if(n&2){let t=u(3);m(3),y("disabled",!t.accounts.loggedIn)}}function lo(n,a){if(n&1){let t=N();r(0,"button",24),x("click",function(){b(t);let i=u(2);return w(i.downloadFile(i.analysisGroupDF))}),r(1,"mat-icon"),c(2,"download"),l()(),F(3,ro,5,1)}if(n&2){let t=u(2);m(3),v(t.canEdit?3:-1)}}function so(n,a){if(n&1&&c(0),n&2){let t=u(2);$(": ",t.analysisGroupSearched.name,"")}}function co(n,a){if(n&1){let t=N();r(0,"app-upload-file",23),x("fileUploaded",function(i){b(t);let o=u(2);return w(o.handleFileUploaded(i,"searched"))}),l()}if(n&2){let t=u(2);y("analysisGroupId",t.analysisGroup.id)("fileCategory","searched")}}function mo(n,a){if(n&1){let t=N();r(0,"button",24),x("click",function(){b(t);let i=u(3);return w(i.deleteFile(i.analysisGroupSearched))}),r(1,"mat-icon"),c(2,"delete"),l()(),r(3,"button",25),x("click",function(){b(t);let i=u(3);return w(i.openExtraDataModal(i.analysisGroupSearched))}),c(4,"Extra Data"),l()}if(n&2){let t=u(3);m(3),y("disabled",!t.accounts.loggedIn)}}function po(n,a){if(n&1){let t=N();r(0,"button",24),x("click",function(){b(t);let i=u(2);return w(i.downloadFile(i.analysisGroupSearched))}),r(1,"mat-icon"),c(2,"download"),l()(),F(3,mo,5,1)}if(n&2){let t=u(2);m(3),v(t.canEdit?3:-1)}}function uo(n,a){if(n&1&&c(0),n&2){let t=u(2);$(": ",t.analysisGroupCopyNumber.name,"")}}function _o(n,a){if(n&1){let t=N();r(0,"app-upload-file",23),x("fileUploaded",function(i){b(t);let o=u(2);return w(o.handleFileUploaded(i,"copy_number"))}),l()}if(n&2){let t=u(2);y("analysisGroupId",t.analysisGroup.id)("fileCategory","copy_number")}}function fo(n,a){if(n&1){let t=N();r(0,"button",24),x("click",function(){b(t);let i=u(3);return w(i.deleteFile(i.analysisGroupCopyNumber))}),r(1,"mat-icon"),c(2,"delete"),l()(),r(3,"button",25),x("click",function(){b(t);let i=u(3);return w(i.openExtraDataModal(i.analysisGroupCopyNumber))}),c(4,"Extra Data"),l()}if(n&2){let t=u(3);m(3),y("disabled",!t.canEdit)}}function ho(n,a){if(n&1){let t=N();r(0,"button",24),x("click",function(){b(t);let i=u(2);return w(i.downloadFile(i.analysisGroupCopyNumber))}),r(1,"mat-icon"),c(2,"download"),l()(),F(3,fo,5,1)}if(n&2){let t=u(2);m(3),v(t.canEdit?3:-1)}}function Co(n,a){if(n&1&&c(0),n&2){let t=u(3);$("(",t.sampleAnnotations.annotations.length,")")}}function yo(n,a){if(n&1){let t=N();r(0,"button",25),x("click",function(){b(t);let i=u(2);return w(i.setAnnotationModal(i.analysisGroupSearched))}),c(1,"Plot Sample Annotation "),F(2,Co,1,1),l()}if(n&2){let t=u(2);y("disabled",!t.canEdit),m(2),v(t.sampleAnnotations?2:-1)}}function xo(n,a){if(n&1&&c(0),n&2){let t=u(3);$("(",t.comparisonMatrix.matrix.length,")")}}function go(n,a){if(n&1){let t=N();r(0,"button",25),x("click",function(){b(t);let i=u(2);return w(i.setComparisonMatrixModal(i.sampleAnnotations,i.analysisGroupSearched,i.analysisGroupDF))}),c(1,"Comparison Matrix "),F(2,xo,1,1),l()}if(n&2){let t=u(2);y("disabled",!t.canEdit),m(2),v(t.comparisonMatrix?2:-1)}}function bo(n,a){if(n&1){let t=N();F(0,Za,5,3,"p")(1,to,5,2,"p"),r(2,"form",5),x("ngSubmit",function(){b(t);let i=u();return w(i.updateAnalysisGroup())}),r(3,"mat-form-field",2),V(4,"input",6),r(5,"mat-label"),c(6,"Analysis Group Name"),l()(),r(7,"mat-form-field",2),V(8,"textarea",7),r(9,"mat-label"),c(10,"Analysis Group Description"),l()(),F(11,eo,3,4),V(12,"mat-divider"),r(13,"div",8)(14,"mat-form-field",2),V(15,"input",9),r(16,"mat-label"),c(17,"Curtain Link"),l()(),r(18,"button",10),x("click",function(){b(t);let i=u();return w(i.refreshCurtainLink())}),r(19,"mat-icon"),c(20,"refresh"),l()()(),F(21,io,3,4),r(22,"div",8)(23,"button",11),c(24,"Update Analysis Group"),l(),F(25,no,2,1,"button",12),l()(),r(26,"div",13)(27,"div")(28,"p"),c(29,"Differential Analysis File "),F(30,ao,1,1),l()(),F(31,oo,1,2,"app-upload-file",14)(32,lo,4,1),l(),r(33,"div",13)(34,"div")(35,"p"),c(36,"Searched File "),F(37,so,1,1),l()(),F(38,co,1,2,"app-upload-file",14)(39,po,4,1),l(),r(40,"div",13)(41,"div")(42,"p"),c(43,"Copy Number File "),F(44,uo,1,1),l()(),F(45,_o,1,2,"app-upload-file",14)(46,ho,4,1),l(),r(47,"div",15),F(48,yo,3,2,"button",16)(49,go,3,2,"button",16),r(50,"button",17),x("click",function(){b(t);let i=u();return w(i.openSearchModal())}),r(51,"mat-icon"),c(52,"search"),l()(),r(53,"button",18),x("click",function(){b(t);let i=u();return w(i.deleteAnalysisGroup())}),r(54,"mat-icon"),c(55,"delete"),l()()()}if(n&2){let t=u();v(t.associatedProject?0:-1),m(),v(t.analysisGroup.curtain_link?1:-1),m(),y("formGroup",t.form),m(2),y("readonly",!t.canEdit),m(4),y("readonly",!t.canEdit),m(3),v(t.analysisGroup?11:-1),m(4),y("readonly",!t.canEdit),m(3),y("disabled",!t.canEdit),m(3),v(t.composingCurtainProgress.started?21:-1),m(2),y("disabled",!t.canEdit),m(2),v(t.analysisGroup.curtain_link?25:-1),m(5),v(t.analysisGroupDF?30:-1),m(),v(t.canEdit?31:-1),m(),v(t.analysisGroupDF?32:-1),m(5),v(t.analysisGroupSearched?37:-1),m(),v(t.canEdit?38:-1),m(),v(t.analysisGroupSearched?39:-1),m(5),v(t.analysisGroupCopyNumber?44:-1),m(),v(t.canEdit?45:-1),m(),v(t.analysisGroupCopyNumber?46:-1),m(2),v(t.analysisGroupSearched?48:-1),m(),v(t.sampleAnnotations&&t.analysisGroupSearched&&t.analysisGroupDF?49:-1),m(4),y("disabled",!t.canEdit)}}var ns=(()=>{class n{set analysisGroup(t){this._analysisGroup=t,t&&this.accounts.getAnalysisGroupPermissions(t.id).subscribe(e=>{this.canEdit=e.edit}),this.curtainData=void 0,t&&(t.curtain_link&&this.getCurtainData(),this.dataService.analysisGroupChoices.forEach(e=>{e.value===t.analysis_group_type&&(this.analysisType=e.label)}),this.titleService.setTitle(`AG - ${t.name}`),this.web.getProject(t.project).subscribe(e=>{this.associatedProject=e}),this.form.controls.name.setValue(t.name),this.form.controls.description.setValue(t.description),this.form.controls.curtain_link.setValue(t.curtain_link),this.getFiles(t))}getFiles(t){this.web.getAnalysisGroupFiles(t.id).subscribe(e=>{this.analysisGroupDF=e.find(i=>i.file_category==="df"),this.analysisGroupSearched=e.find(i=>i.file_category==="searched"),this.analysisGroupSearched&&this.web.getProjectFileSampleAnnotations(this.analysisGroupSearched.id).subscribe(i=>{this.sampleAnnotations=i}),this.analysisGroupDF&&this.web.getProjectFileComparisonMatrix(this.analysisGroupDF.id).subscribe(i=>{this.comparisonMatrix=i})})}get analysisGroup(){return this._analysisGroup}constructor(t,e,i,o,s,d,p,f){this.sb=t,this.dataService=e,this.titleService=i,this.fb=o,this.web=s,this.matDialog=d,this.accounts=p,this.ws=f,this.analysisType="proteomics",this.reorderMetadataColumnSourceFile=[],this.canEdit=!1,this.composingCurtainProgress={progress:0,message:"",completed:!1,error:!1,started:!1},this.deleted=new z,this.updated=new z,this.form=this.fb.group({name:new I({value:"",disabled:!1},{validators:[R.required]}),description:new I({value:"",disabled:!1},{validators:[R.required]}),curtain_link:new I({value:"",disabled:!1})}),this.metadataDeletionList=[],this.ws.curtainWSConnection?.subscribe(C=>{if(C.analysis_group_id===this.analysisGroup?.id){if(C.type==="curtain_status")switch(C.status){case"started":this.sb.open("Curtain link retrieval started","Dismiss",{duration:5e3});break;case"complete":this.sb.open("Curtain link retrieval complete","Dismiss",{duration:5e3}),this.getCurtainData();break}else if(C.type==="curtain_compose_status")switch(C.status){case"started":this.sb.open("Composing data from Curtain started","Dismiss",{duration:5e3}),this.composingCurtainProgress.progress=30,this.composingCurtainProgress.message="Removed analysis group associated data if exist";break;case"complete":this.sb.open("Composing data from Curtain completed. Please manually set Condition A and Condition B in Comparison Matrix.","Dismiss"),this.composingCurtainProgress.progress=100,this.composingCurtainProgress.message="Composing data from Curtain completed. Please manually set Condition A and Condition B in Comparison Matrix.",this.composingCurtainProgress.completed=!0,this.web.getAnalysisGroup(this.analysisGroup.id).subscribe(h=>{this.analysisGroup=h});break;case"error":this.sb.open("Error composing data from Curtain","Dismiss",{duration:5e3}),this.composingCurtainProgress.error=!0;break}}})}updateAnalysisGroup(){return wt(this,null,function*(){if(this.form.invalid)return;if(this.metadataDeletionList.length>0){for(let e of this.metadataDeletionList)if(yield this.web.deleteMetaDataColumn(e.id).toPromise(),this.sb.open(`Metadata column ${e.name} deleted`,"Dismiss",{duration:5e3}),e.source_file&&this.generalMetadata&&this.generalMetadata.sourceFiles.map(o=>o.metadata_columns).flat().filter(o=>o.column_position===e.column_position).length===1){let o=this.generalMetadata.sourceFiles.find(s=>s.id===e.source_file);o&&(o.metadata_columns=o.metadata_columns.filter(s=>s.column_position!==e.column_position))}}if(this.generalMetadata){for(let e in this.generalMetadata.sourcefileFormMap)this.generalMetadata.sourcefileFormMap[e].dirty&&(yield this.web.updateSourceFile(parseInt(e),this.generalMetadata.sourcefileFormMap[e].value.name,this.generalMetadata.sourcefileFormMap[e].value.description).toPromise(),this.generalMetadata.sourcefileFormMap[e].markAsPristine(),this.sb.open(`Source file ${this.generalMetadata.sourcefileFormMap[e].value.name} updated`,"Dismiss",{duration:5e3}));for(let e in this.generalMetadata.metadataFormMap)this.generalMetadata.metadataFormMap[e].dirty&&(yield this.web.updateMetaDataColumn(parseInt(e),void 0,void 0,this.generalMetadata.metadataFormMap[e].value.value,this.generalMetadata.metadataFormMap[e].value.not_applicable).toPromise(),this.generalMetadata.metadataFormMap[e].markAsPristine(),this.sb.open(`Metadata column ${this.generalMetadata.metadataFormMap[e].value.name} updated`,"Dismiss",{duration:5e3}))}let t=yield this.web.updateAnalysisGroup(this.analysisGroup.id,this.form.value.name,this.form.value.description,this.form.value.curtain_link,this.web.searchSessionID).toPromise();this.metadataDeletionList=[],this.updated.emit(t)})}getCurtainData(){this.analysisGroup&&(this.sb.open("Retrieving curtain visualization","Dismiss",{duration:5e3}),this.web.getCurtainLinkData(this.analysisGroup.id).subscribe(t=>{this.curtainData=t,this.sb.open("Curtain visualization retrieved","Dismiss",{duration:5e3})},t=>{this.sb.open("Error retrieving curtain visualization","Dismiss",{duration:5e3}),this.curtainData=void 0}))}handleFileUploaded(t,e){e==="searched"?(this.analysisGroupSearched=t,this.web.getProjectFileSampleAnnotations(t.id).subscribe(i=>{this.sampleAnnotations=i}),this.sb.open("Searched File uploaded","Dismiss",{duration:5e3})):e==="df"?(this.analysisGroupDF=t,this.web.getProjectFileComparisonMatrix(this.analysisGroupDF.id).subscribe(i=>{this.comparisonMatrix=i}),this.sb.open("Differential Analysis File uploaded","Dismiss",{duration:5e3})):e==="copy_number"&&(this.analysisGroupCopyNumber=t,this.sb.open("Copy Number Analysis File uploaded","Dismiss",{duration:5e3}))}setAnnotationModal(t){let e=this.matDialog.open(Mi);e.componentInstance.projectFile=t,this.sampleAnnotations&&(e.componentInstance.annotation=this.sampleAnnotations),e.afterClosed().subscribe(i=>{i&&(console.log(this.sampleAnnotations),this.sampleAnnotations?this.web.updateSampleAnnotation(this.sampleAnnotations.id,this.sampleAnnotations.name,i).subscribe(o=>{this.sampleAnnotations=o,this.sb.open("Sample annotation updated","Dismiss",{duration:5e3})}):this.web.createSampleAnnotation(this.analysisGroup.id,this.analysisGroup?.name+" sample annotation",i,this.analysisGroupSearched.id).subscribe(o=>{this.sampleAnnotations=o,this.sb.open("Sample annotation created","Dismiss",{duration:5e3})}))})}setComparisonMatrixModal(t,e,i){let o=this.matDialog.open(vi);o.componentInstance.sampleAnnotations=t,o.componentInstance.projectFile=i,this.comparisonMatrix&&(o.componentInstance.comparisonMatrix=this.comparisonMatrix),o.afterClosed().subscribe(s=>{s&&(this.comparisonMatrix?this.web.updateComparisonMatrix(this.comparisonMatrix.id,this.comparisonMatrix.name,s).subscribe(d=>{this.comparisonMatrix=d,this.sb.open("Comparison matrix updated","Dismiss",{duration:5e3})}):this.web.createComparisonMatrix(this.analysisGroup.id,this.analysisGroup?.name+" comparison matrix",s,i.id).subscribe(d=>{this.comparisonMatrix=d,this.sb.open("Comparison matrix created","Dismiss",{duration:5e3})}))})}deleteAnalysisGroup(){this.matDialog.open(zt).afterClosed().subscribe(t=>{t&&this.web.deleteAnalysisGroup(this.analysisGroup.id).subscribe(()=>{this.deleted.emit(!0),this.sb.open("Analysis Group deleted","Dismiss",{duration:5e3})})})}openSearchModal(){let t=this.matDialog.open(Di);t.componentInstance.analysisGroupIDs=[this.analysisGroup.id],t.afterClosed().subscribe(e=>{e&&window.open(`/#/search-session/${e}`,"_blank")})}openExtraDataModal(t){let e=this.matDialog.open(Ai);e.componentInstance.analysisGroupType=this.analysisGroup?.analysis_group_type,e.componentInstance.file=t,e.afterClosed().subscribe(i=>{i&&this.web.updateProjectFileExtraData(t.id,i.extra_data).subscribe(o=>{t.file_category==="df"?(this.analysisGroupDF=o,this.sb.open("Differential Analysis extra data updated","Dismiss",{duration:5e3})):t.file_category==="searched"?(this.analysisGroupSearched=o,this.sb.open("Searched extra data updated","Dismiss",{duration:5e3})):t.file_category==="copy_number"&&(this.analysisGroupCopyNumber=o,this.sb.open("Copy Number extra data updated","Dismiss",{duration:5e3}))})})}refreshCurtainLink(){this.analysisGroup&&this.web.searchSessionID&&this.web.refreshCurtainLink(this.analysisGroup.id,this.web.searchSessionID).subscribe(t=>{this.analysisGroup=t,this.sb.open("Curtain data content refreshed","Dismiss",{duration:5e3})})}handleVolcanoSelection(t){console.log(t)}composeDataFromCurtain(){this.composingCurtainProgress={progress:0,message:"",completed:!1,error:!1},this.analysisGroup&&this.web.searchSessionID&&(this.composingCurtainProgress.started=!0,this.web.composeAnalysisGroupFilesFromCurtainData(this.analysisGroup.id,this.web.searchSessionID).subscribe(t=>{this.composingCurtainProgress.progress=10,this.composingCurtainProgress.message="Data composition started",this.sb.open("Data composition started","Dismiss",{duration:5e3})}))}deleteFile(t){this.matDialog.open(zt).afterClosed().subscribe(e=>{e&&this.web.deleteProjectFile(t.id).subscribe(()=>{t.file_category==="df"?(this.analysisGroupDF=void 0,this.sb.open("Differential Analysis File deleted","Dismiss",{duration:5e3})):t.file_category==="searched"?(this.analysisGroupSearched=void 0,this.sb.open("Searched File deleted","Dismiss",{duration:5e3})):t.file_category==="copy_number"&&(this.analysisGroupCopyNumber=void 0,this.sb.open("Copy Number Analysis File deleted","Dismiss",{duration:5e3}))})})}downloadFile(t){this.web.getFileDownloadToken(t.id).subscribe(e=>{window.open(`${this.web.baseURL}/api/project_files/download/?token=${e.token}`)})}updateDeletionList(t){this.metadataDeletionList.includes(t)?this.metadataDeletionList=this.metadataDeletionList.filter(e=>e!==t):this.metadataDeletionList.push(t)}updateDeletionListSourceFile(t){if(this.generalMetadata){let i=(this.generalMetadata?.sourceFiles.map(o=>o.metadata_columns).flat()).filter(o=>o.column_position===t.column_position);if(this.metadataDeletionList.includes(t))this.metadataDeletionList=this.metadataDeletionList.filter(o=>o.id!==t.id);else{this.metadataDeletionList.push(t);for(let o of i)o!==t&&(this.metadataDeletionList=this.metadataDeletionList.filter(s=>s.id!==o.id))}}console.log(this.metadataDeletionList)}reorderMetadataColumn(t){this.analysisGroup&&this.web.reorganizeColumns(t,this.analysisGroup.id).subscribe(e=>{this.sb.open("Metadata columns reordered","Dismiss",{duration:5e3})})}handleMetadataImport(t){this.analysisGroup&&(this.analysisGroup.metadata_columns=t.metadata_columns,this.analysisGroup.source_files=t.source_files)}static{this.\u0275fac=function(e){return new(e||n)(G(Vt),G(St),G(Ee),G(it),G(Q),G(te),G(me),G(Nt))}}static{this.\u0275cmp=j({type:n,selectors:[["app-analysis-group-view"]],viewQuery:function(e,i){if(e&1&&Et(Xa,5),e&2){let o;Tt(o=It())&&(i.generalMetadata=o.first)}},inputs:{analysisGroup:"analysisGroup"},outputs:{deleted:"deleted",updated:"updated"},decls:4,vars:2,consts:[["generalMetadata",""],[2,"display","flex","flex-direction","row","justify-content","center","padding","50px"],[2,"width","100%"],[2,"display","flex","flex-direction","row","justify-content","center","flex-wrap","wrap"],[3,"selected","plotType","curtainData"],[2,"display","flex","flex-direction","column","gap","20px","padding","20px",3,"ngSubmit","formGroup"],["matInput","","formControlName","name","type","text","placeholder","Analysis Group Name",3,"readonly"],["matInput","","formControlName","description","placeholder","Analysis Group Description",3,"readonly"],[2,"display","flex","flex-direction","row","gap","10px"],["matInput","","formControlName","curtain_link","type","text","placeholder","Curtain Link",3,"readonly"],["mat-icon-button","","type","button",3,"click","disabled"],["mat-flat-button","","color","primary","type","submit",3,"disabled"],["mat-flat-button","","color","primary","type","button",3,"disabled"],[2,"display","flex","flex-direction","row","gap","20px","align-items","center"],[3,"analysisGroupId","fileCategory"],[2,"display","flex","flex-direction","row","gap","20px","padding","20px"],["mat-flat-button","","color","primary",3,"disabled"],["mat-icon-button","","color","accent",3,"click"],["mat-icon-button","",3,"click","disabled"],["target","_blank",3,"href"],[3,"metadataImported","reorderMetadataSourceFiles","sourceFilesChanged","metadataDeleted","sourceFileMetadataDeleted","sourceFiles","canEdit","analysis_group_id","metadata"],[3,"value","mode","color"],["mat-flat-button","","color","primary","type","button",3,"click","disabled"],[3,"fileUploaded","analysisGroupId","fileCategory"],["mat-icon-button","",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"]],template:function(e,i){e&1&&(F(0,Ja,1,1),r(1,"div",1)(2,"div",2),F(3,bo,56,23),l()()),e&2&&(v(i.curtainData?0:-1),m(3),v(i.analysisGroup?3:-1))},dependencies:[kt,W,mt,Z,Y,O,at,Mt,pt,nt,X,tt,et,wi,vt,Gi,Lt,ki,ne],encapsulation:2})}}return n})();export{Ao as a,ns as b};
