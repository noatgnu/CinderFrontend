import{a as de,b as pe,c as ue,d as fe,e as _e,f as Ce,g as he,h as ge,i as ve,j as Se}from"./chunk-CF2TBK2L.js";import{a as te,c as ie}from"./chunk-TR6UWPUI.js";import{a as Me,b as xe}from"./chunk-P2FFHIGI.js";import{a as P}from"./chunk-5BQX5E3H.js";import{a as me}from"./chunk-4FNQT7QE.js";import{a as I,b as w,c as F,d as R,e as N,f as j,g as ce}from"./chunk-LUNVEN3K.js";import{Aa as z,Ca as $,Ea as ae,Ha as Q,Ia as O,Ka as le,La as se,Ma as x,Q as ne,R as M,S as oe,ka as L,ma as g,oa as A,pa as B,ta as V,wa as G,xa as q,ya as H,za as re}from"./chunk-QJNOXFLF.js";import"./chunk-HX3ESI56.js";import{c as Z,p as ee}from"./chunk-QJ2HU2ZW.js";import{Aa as T,Ba as y,Bb as f,Hb as b,Lb as i,Mb as n,Nb as d,Ob as k,Pb as U,Rb as E,Ub as p,Wb as S,ed as X,fb as s,gb as m,gc as r,ia as W,ic as v,ja as Y,na as J,oc as h,sa as C,ta as K,xb as u}from"./chunk-TUTLJQZA.js";var Ue=(()=>{class e{constructor(t,o,a){this.dialogRef=t,this.data=o,this.webService=a}onCancel(){this.dialogRef.close(!1)}onConfirm(){this.dialogRef.close(!0)}static{this.\u0275fac=function(o){return new(o||e)(m(I),m(w),m(x))}}static{this.\u0275cmp=C({type:e,selectors:[["app-delete-user-confirmation"]],standalone:!0,features:[h],decls:10,vars:1,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["mat-dialog-actions",""],["mat-button","",3,"click"],["mat-button","","color","warn",3,"click"]],template:function(o,a){o&1&&(i(0,"h1",0),r(1,"Confirm Delete"),n(),i(2,"div",1)(3,"p"),r(4),n()(),i(5,"div",2)(6,"button",3),p("click",function(){return a.onCancel()}),r(7,"Cancel"),n(),i(8,"button",4),p("click",function(){return a.onConfirm()}),r(9,"Delete"),n()()),o&2&&(s(4),v('Are you sure you want to delete user "',a.data.username,'"?'))},dependencies:[M,j,N,R]})}}return e})();var De=(()=>{class e{constructor(t,o,a,c,_,Ie){this.fb=t,this.webService=o,this.snackBar=a,this.dialogRef=c,this.data=_,this.dialog=Ie,this.form=this.fb.group({id:[_.id],username:[_.username,g.required],first_name:[_.first_name,g.required],last_name:[_.last_name,g.required],email:[_.email,[g.required,g.email]]})}save(){this.form.invalid||this.webService.updateUser(this.form.value.id,this.form.value.email,null,this.form.value.last_name,this.form.value.first_name,this.form.value.username).subscribe({next:t=>{this.snackBar.open("User updated successfully","Close",{duration:2e3}),this.dialogRef.close(t)},error:()=>{this.snackBar.open("Error updating user","Close",{duration:2e3})}})}cancel(){this.dialogRef.close()}delete(){this.dialog.open(Ue,{data:this.data}).afterClosed().subscribe(o=>{o&&this.webService.removeUser(this.data.id).subscribe({next:()=>{this.snackBar.open("User deleted successfully","Close",{duration:2e3}),this.dialogRef.close()},error:()=>{this.snackBar.open("Error deleting user","Close",{duration:2e3})}})})}static{this.\u0275fac=function(o){return new(o||e)(m(H),m(x),m(P),m(I),m(w),m(F))}}static{this.\u0275cmp=C({type:e,selectors:[["app-edit-user-dialog"]],standalone:!0,features:[h],decls:27,vars:1,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[2,"display","flex","flex-direction","column","gap","20px",3,"formGroup"],["matInput","","formControlName","username","placeholder","Username"],["matInput","","formControlName","first_name","placeholder","First Name"],["matInput","","formControlName","last_name","placeholder","Last Name"],["matInput","","formControlName","email","placeholder","Email"],["mat-dialog-actions",""],["mat-button","",3,"click"],["mat-button","","color","primary",3,"click"]],template:function(o,a){o&1&&(i(0,"h1",0),r(1,"Edit User"),n(),i(2,"div",1)(3,"form",2)(4,"mat-form-field"),d(5,"input",3),i(6,"mat-label"),r(7,"Username"),n()(),i(8,"mat-form-field"),d(9,"input",4),i(10,"mat-label"),r(11,"First Name"),n()(),i(12,"mat-form-field"),d(13,"input",5),i(14,"mat-label"),r(15,"Last Name"),n()(),i(16,"mat-form-field"),d(17,"input",6),i(18,"mat-label"),r(19,"Email"),n()()()(),i(20,"div",7)(21,"button",8),p("click",function(){return a.delete()}),r(22,"Delete"),n(),i(23,"button",8),p("click",function(){return a.cancel()}),r(24,"Cancel"),n(),i(25,"button",9),p("click",function(){return a.save()}),r(26,"Save"),n()()),o&2&&(s(3),f("formGroup",a.form))},dependencies:[$,O,z,V,L,A,B,G,q,Q,N,R,M,j]})}}return e})();var Te=(()=>{class e{constructor(t){this.http=t,this.baseURL=se.baseURL}generateUserToken(t){return this.http.post(`${this.baseURL}/api/users/generate_token/`,{username:t},{responseType:"json",observe:"body"})}static{this.\u0275fac=function(o){return new(o||e)(J(Z))}}static{this.\u0275prov=W({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function Ne(e,l){if(e&1){let t=E();i(0,"mat-card",3)(1,"mat-card-content"),r(2," Registration Link and Information "),i(3,"mat-form-field",5),d(4,"input",6),i(5,"mat-label"),r(6,"Registration Link"),n(),i(7,"button",7),p("click",function(){T(t);let a=S();return y(a.copyTokenLink())}),i(8,"mat-icon"),r(9,"content_paste"),n()()()()()}if(e&2){let t=S();s(4),f("value",t.userTokenLink)}}function je(e,l){e&1&&(i(0,"th",18),r(1," ID "),n())}function Le(e,l){if(e&1&&(i(0,"td",19),r(1),n()),e&2){let t=l.$implicit;s(),v(" ",t.id," ")}}function Ae(e,l){e&1&&(i(0,"th",18),r(1," Username "),n())}function Be(e,l){if(e&1&&(i(0,"td",19),r(1),n()),e&2){let t=l.$implicit;s(),v(" ",t.username," ")}}function Ve(e,l){e&1&&(i(0,"th",18),r(1," First Name "),n())}function Ge(e,l){if(e&1&&(i(0,"td",19),r(1),n()),e&2){let t=l.$implicit;s(),v(" ",t.first_name," ")}}function qe(e,l){e&1&&(i(0,"th",18),r(1," Last Name "),n())}function He(e,l){if(e&1&&(i(0,"td",19),r(1),n()),e&2){let t=l.$implicit;s(),v(" ",t.last_name," ")}}function ze(e,l){e&1&&d(0,"tr",20)}function $e(e,l){if(e&1){let t=E();i(0,"tr",21),p("click",function(){let a=T(t).$implicit,c=S(2);return y(c.openEditUserDialog(a))}),n()}}function Qe(e,l){if(e&1){let t=E();i(0,"table",8),k(1,9),u(2,je,2,0,"th",10)(3,Le,2,1,"td",11),U(),k(4,12),u(5,Ae,2,0,"th",10)(6,Be,2,1,"td",11),U(),k(7,13),u(8,Ve,2,0,"th",10)(9,Ge,2,1,"td",11),U(),k(10,14),u(11,qe,2,0,"th",10)(12,He,2,1,"td",11),U(),u(13,ze,1,0,"tr",15)(14,$e,1,0,"tr",16),n(),i(15,"mat-paginator",17),p("page",function(a){T(t);let c=S();return y(c.onPageChange(a))}),n()}if(e&2){let t=S();f("dataSource",t.userQuery.results),s(13),f("matHeaderRowDef",t.displayedColumns),s(),f("matRowDefColumns",t.displayedColumns),s(),f("length",t.userQuery.count)("pageSize",t.limit)("pageIndex",t.offset)}}function Oe(e,l){e&1&&(i(0,"p"),r(1,"No users found."),n())}var ye=(()=>{class e{constructor(t,o,a,c,_){this.dialog=t,this.adminService=o,this.fb=a,this.snackBar=c,this.webService=_,this.userTokenForm=this.fb.group({username:["",g.required]}),this.userTokenLink="",this.userSearchForm=this.fb.group({query:[""]}),this.limit=10,this.offset=0,this.userQuery=null,this.displayedColumns=["id","username","first_name","last_name"]}ngOnInit(){this.fetchUsers()}createUserToken(){this.userTokenForm.invalid||this.userTokenForm.value.username&&this.adminService.generateUserToken(this.userTokenForm.value.username).subscribe(t=>{this.userTokenLink=location.protocol+"//"+location.host+"#/user/register/"+t.token})}copyTokenLink(){navigator.clipboard.writeText(this.userTokenLink).then(()=>{this.snackBar.open("Link copied to clipboard","Close",{duration:2e3})})}fetchUsers(){this.webService.getUsers(this.userSearchForm.value.query,this.limit,this.offset).subscribe(t=>{this.userQuery=t})}onPageChange(t){this.limit=t.pageSize,this.offset=t.pageIndex*t.pageSize,this.fetchUsers()}openEditUserDialog(t){this.dialog.open(De,{data:t}).afterClosed().subscribe(a=>{a&&this.fetchUsers()})}static{this.\u0275fac=function(o){return new(o||e)(m(F),m(Te),m(H),m(P),m(x))}}static{this.\u0275cmp=C({type:e,selectors:[["app-user-management"]],standalone:!0,features:[h],decls:21,vars:4,consts:[[2,"display","flex","flex-direction","column","gap","20px","padding","20px",3,"ngSubmit","formGroup"],["matInput","","formControlName","username","placeholder","Username","type","text"],["mat-raised-button","","color","primary","type","submit"],["appearance","outlined"],["matInput","","formControlName","query","placeholder","Search","type","text"],[2,"width","100%"],["matInput","","type","text","readonly","",3,"value"],["mat-icon-button","","matSuffix","",3,"click"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","username"],["matColumnDef","first_name"],["matColumnDef","last_name"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"click",4,"matRowDef","matRowDefColumns"],[3,"page","length","pageSize","pageIndex"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row","",3,"click"]],template:function(o,a){o&1&&(i(0,"h1"),r(1,"Generate Registration Link"),n(),i(2,"form",0),p("ngSubmit",function(){return a.createUserToken()}),i(3,"mat-form-field"),d(4,"input",1),i(5,"mat-label"),r(6,"Username"),n()(),i(7,"div")(8,"button",2),r(9,"Create User Registration Token Link"),n()(),u(10,Ne,10,1,"mat-card",3),n(),d(11,"mat-divider"),i(12,"h1"),r(13,"Manage Users"),n(),i(14,"form",0),p("ngSubmit",function(){return a.fetchUsers()}),i(15,"mat-form-field"),d(16,"input",4),i(17,"mat-label"),r(18,"Search Term"),n()()(),u(19,Qe,16,6)(20,Oe,2,0,"p")),o&2&&(s(2),f("formGroup",a.userTokenForm),s(8),b(a.userTokenLink?10:-1),s(4),f("formGroup",a.userSearchForm),s(5),b(a.userQuery?19:20))},dependencies:[z,V,L,A,B,G,q,$,O,Q,M,te,ie,ne,re,ae,oe,me,Se,ve,Ce,_e,fe,de,pe,ue,he,ge,le]})}}return e})();function Pe(e,l){e&1&&(i(0,"div",0)(1,"div",1)(2,"mat-tab-group")(3,"mat-tab",2),d(4,"app-user-management"),n()()()())}function We(e,l){e&1&&(i(0,"div",0)(1,"p"),r(2," You are not authorized to view this page. "),n()())}var Ee=(()=>{class e{constructor(t){this.accounts=t,this.isStaff=!1,console.log(this.accounts.currentUser),this.isStaff=this.accounts.currentUser?.is_staff||!1}static{this.\u0275fac=function(o){return new(o||e)(m(ce))}}static{this.\u0275cmp=C({type:e,selectors:[["app-admin"]],standalone:!0,features:[h],decls:2,vars:1,consts:[[2,"display","flex","flex-direction","column","align-items","center","gap","20px"],[2,"width","600px"],["label","User Management"]],template:function(o,a){o&1&&u(0,Pe,5,0,"div",0)(1,We,3,0,"div",0),o&2&&b(a.isStaff?0:1)},dependencies:[xe,Me,ye]})}}return e})();var Ye=[{path:"",component:Ee}],Dt=(()=>{class e{static{this.\u0275fac=function(o){return new(o||e)}}static{this.\u0275mod=K({type:e})}static{this.\u0275inj=Y({imports:[X,ee.forChild(Ye)]})}}return e})();export{Dt as AdminModule};
