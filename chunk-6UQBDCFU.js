import{a as Te,b as Jt,c as Zt,d as te,e as ee,f as ie}from"./chunk-E6PLF4NL.js";import{a as Qt}from"./chunk-ZDUQ6FEO.js";import{a as se,b as Ei,c as Oe,d as fe,e as Xe,f as We,g as Qe,h as Je}from"./chunk-ULDJCDVS.js";import{a as qe,b as Ke,c as ze,d as Ye}from"./chunk-4RMQVNY3.js";import{a as le}from"./chunk-ZOSGX7BB.js";import{a as Rt}from"./chunk-7XRV2FNP.js";import{b as He,c as $e}from"./chunk-5NOQ2VUG.js";import{a as Ie,b as ke,c as Ve,d as Ne,e as Le,f as Pe,g as Re,h as Be,i as Ue,j as je}from"./chunk-O6GWFT6L.js";import{g as ne,h as oe}from"./chunk-QJRU7V3X.js";import{a as ae}from"./chunk-D2LSGOGF.js";import{a as Wt,c as De,f as Ae,h as Ee}from"./chunk-O3W74R33.js";import{a as ct,c as Xt,d as mt,e as pt,f as ut,g as re}from"./chunk-XX32RFT6.js";import{Aa as z,Ca as tt,Da as Me,Ea as Fe,Ha as et,Ia as rt,Ja as St,Ka as Ge,L as st,Na as it,Q as wt,R as X,S as vt,ka as at,ma as P,oa as W,pa as q,ra as A,ta as K,ua as Se,wa as Q,xa as J,ya as Z,za as Et}from"./chunk-IEHRCBVQ.js";import{h as ve}from"./chunk-QJ2HU2ZW.js";import{A as ft,Aa as v,Ba as S,Bb as y,Hb as D,Ia as ot,Ib as N,Jb as T,Kb as I,L as xe,Lb as r,Mb as l,Nb as V,Ob as Vt,Pb as Nt,Rb as B,Ub as g,Wb as h,Zb as Ot,_b as we,ac as qt,ba as ge,bb as _e,bc as Kt,ca as be,cc as zt,cd as Yt,e as Ai,f as kt,fb as m,fc as lt,gb as G,gc as c,hc as L,ic as H,oc as $,sa as j,sc as Lt,tc as Pt,w as bt,xb as E}from"./chunk-TUTLJQZA.js";var Ti=(i,o)=>o.id;function Ii(i,o){if(i&1){let t=B();r(0,"mat-list-option",1),g("click",function(){let n=v(t).$implicit,a=h(2);return S(a.selectAnalysisGroup(n))}),r(1,"b"),c(2),l(),r(3,"span",2),c(4),l()(),V(5,"mat-divider")}if(i&2){let t=o.$implicit,e=h(2);y("value",t),m(2),L(t.name),m(2),H(" ",e.dataService.getAnalysisGroupTypeLabel(t.analysis_group_type)," ")}}function ki(i,o){if(i&1&&(r(0,"mat-selection-list",0),T(1,Ii,6,3,null,null,Ti),l()),i&2){let t=h();y("multiple",!1),m(),I(t.analysisGroupQuery.results)}}var Zo=(()=>{class i{constructor(t){this.dataService=t,this.selectedAnalysisGroup=new ot}selectAnalysisGroup(t){this.selectedAnalysisGroup.emit(t)}static{this.\u0275fac=function(e){return new(e||i)(G(Qt))}}static{this.\u0275cmp=j({type:i,selectors:[["app-analysis-group-list"]],inputs:{analysisGroupQuery:"analysisGroupQuery"},outputs:{selectedAnalysisGroup:"selectedAnalysisGroup"},standalone:!0,features:[$],decls:1,vars:1,consts:[[3,"multiple"],[3,"click","value"],["matListItemLine",""]],template:function(e,n){e&1&&E(0,ki,3,1,"mat-selection-list",0),e&2&&D(n.analysisGroupQuery?0:-1)},dependencies:[Wt,Ae,Ee,De]})}}return i})();var ci="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",mi="ARRAYBUFFER not supported by this environment",pi="UINT8ARRAY not supported by this environment";function Ze(i,o,t,e){let n,a,s,u=o||[0],d=(t=t||0)>>>3,f=e===-1?3:0;for(n=0;n<i.length;n+=1)s=n+d,a=s>>>2,u.length<=a&&u.push(0),u[a]|=i[n]<<8*(f+e*(s%4));return{value:u,binLen:8*i.length+t}}function It(i,o,t){switch(o){case"UTF8":case"UTF16BE":case"UTF16LE":break;default:throw new Error("encoding must be UTF8, UTF16BE, or UTF16LE")}switch(i){case"HEX":return function(e,n,a){return function(s,u,d,f){let C,_,x,M;if(s.length%2!=0)throw new Error("String of HEX type must be in byte increments");let F=u||[0],k=(d=d||0)>>>3,R=f===-1?3:0;for(C=0;C<s.length;C+=2){if(_=parseInt(s.substr(C,2),16),isNaN(_))throw new Error("String of HEX type contains invalid characters");for(M=(C>>>1)+k,x=M>>>2;F.length<=x;)F.push(0);F[x]|=_<<8*(R+f*(M%4))}return{value:F,binLen:4*s.length+d}}(e,n,a,t)};case"TEXT":return function(e,n,a){return function(s,u,d,f,C){let _,x,M,F,k,R,b,O,U=0,Y=d||[0],dt=(f=f||0)>>>3;if(u==="UTF8")for(b=C===-1?3:0,M=0;M<s.length;M+=1)for(_=s.charCodeAt(M),x=[],128>_?x.push(_):2048>_?(x.push(192|_>>>6),x.push(128|63&_)):55296>_||57344<=_?x.push(224|_>>>12,128|_>>>6&63,128|63&_):(M+=1,_=65536+((1023&_)<<10|1023&s.charCodeAt(M)),x.push(240|_>>>18,128|_>>>12&63,128|_>>>6&63,128|63&_)),F=0;F<x.length;F+=1){for(R=U+dt,k=R>>>2;Y.length<=k;)Y.push(0);Y[k]|=x[F]<<8*(b+C*(R%4)),U+=1}else for(b=C===-1?2:0,O=u==="UTF16LE"&&C!==1||u!=="UTF16LE"&&C===1,M=0;M<s.length;M+=1){for(_=s.charCodeAt(M),O===!0&&(F=255&_,_=F<<8|_>>>8),R=U+dt,k=R>>>2;Y.length<=k;)Y.push(0);Y[k]|=_<<8*(b+C*(R%4)),U+=2}return{value:Y,binLen:8*U+f}}(e,o,n,a,t)};case"B64":return function(e,n,a){return function(s,u,d,f){let C,_,x,M,F,k,R,b=0,O=u||[0],U=(d=d||0)>>>3,Y=f===-1?3:0,dt=s.indexOf("=");if(s.search(/^[a-zA-Z0-9=+/]+$/)===-1)throw new Error("Invalid character in base-64 string");if(s=s.replace(/=/g,""),dt!==-1&&dt<s.length)throw new Error("Invalid '=' found in base-64 string");for(_=0;_<s.length;_+=4){for(F=s.substr(_,4),M=0,x=0;x<F.length;x+=1)C=ci.indexOf(F.charAt(x)),M|=C<<18-6*x;for(x=0;x<F.length-1;x+=1){for(R=b+U,k=R>>>2;O.length<=k;)O.push(0);O[k]|=(M>>>16-8*x&255)<<8*(Y+f*(R%4)),b+=1}}return{value:O,binLen:8*b+d}}(e,n,a,t)};case"BYTES":return function(e,n,a){return function(s,u,d,f){let C,_,x,M,F=u||[0],k=(d=d||0)>>>3,R=f===-1?3:0;for(_=0;_<s.length;_+=1)C=s.charCodeAt(_),M=_+k,x=M>>>2,F.length<=x&&F.push(0),F[x]|=C<<8*(R+f*(M%4));return{value:F,binLen:8*s.length+d}}(e,n,a,t)};case"ARRAYBUFFER":try{new ArrayBuffer(0)}catch{throw new Error(mi)}return function(e,n,a){return function(s,u,d,f){return Ze(new Uint8Array(s),u,d,f)}(e,n,a,t)};case"UINT8ARRAY":try{new Uint8Array(0)}catch{throw new Error(pi)}return function(e,n,a){return Ze(e,n,a,t)};default:throw new Error("format must be HEX, TEXT, B64, BYTES, ARRAYBUFFER, or UINT8ARRAY")}}function ti(i,o,t,e){switch(i){case"HEX":return function(n){return function(a,s,u,d){let f="0123456789abcdef",C,_,x="",M=s/8,F=u===-1?3:0;for(C=0;C<M;C+=1)_=a[C>>>2]>>>8*(F+u*(C%4)),x+=f.charAt(_>>>4&15)+f.charAt(15&_);return d.outputUpper?x.toUpperCase():x}(n,o,t,e)};case"B64":return function(n){return function(a,s,u,d){let f,C,_,x,M,F="",k=s/8,R=u===-1?3:0;for(f=0;f<k;f+=3)for(x=f+1<k?a[f+1>>>2]:0,M=f+2<k?a[f+2>>>2]:0,_=(a[f>>>2]>>>8*(R+u*(f%4))&255)<<16|(x>>>8*(R+u*((f+1)%4))&255)<<8|M>>>8*(R+u*((f+2)%4))&255,C=0;C<4;C+=1)F+=8*f+6*C<=s?ci.charAt(_>>>6*(3-C)&63):d.b64Pad;return F}(n,o,t,e)};case"BYTES":return function(n){return function(a,s,u){let d,f,C="",_=s/8,x=u===-1?3:0;for(d=0;d<_;d+=1)f=a[d>>>2]>>>8*(x+u*(d%4))&255,C+=String.fromCharCode(f);return C}(n,o,t)};case"ARRAYBUFFER":try{new ArrayBuffer(0)}catch{throw new Error(mi)}return function(n){return function(a,s,u){let d,f=s/8,C=new ArrayBuffer(f),_=new Uint8Array(C),x=u===-1?3:0;for(d=0;d<f;d+=1)_[d]=a[d>>>2]>>>8*(x+u*(d%4))&255;return C}(n,o,t)};case"UINT8ARRAY":try{new Uint8Array(0)}catch{throw new Error(pi)}return function(n){return function(a,s,u){let d,f=s/8,C=u===-1?3:0,_=new Uint8Array(f);for(d=0;d<f;d+=1)_[d]=a[d>>>2]>>>8*(C+u*(d%4))&255;return _}(n,o,t)};default:throw new Error("format must be HEX, B64, BYTES, ARRAYBUFFER, or UINT8ARRAY")}}var jt=4294967296,w=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],xt=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428],gt=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],Ht="Chosen SHA variant is not supported",ui="Cannot set numRounds with MAC";function me(i,o){let t,e,n=i.binLen>>>3,a=o.binLen>>>3,s=n<<3,u=4-n<<3;if(n%4!=0){for(t=0;t<a;t+=4)e=n+t>>>2,i.value[e]|=o.value[t>>>2]<<s,i.value.push(0),i.value[e+1]|=o.value[t>>>2]>>>u;return(i.value.length<<2)-4>=a+n&&i.value.pop(),{value:i.value,binLen:i.binLen+o.binLen}}return{value:i.value.concat(o.value),binLen:i.binLen+o.binLen}}function ei(i){let o={outputUpper:!1,b64Pad:"=",outputLen:-1},t=i||{},e="Output length must be a multiple of 8";if(o.outputUpper=t.outputUpper||!1,t.b64Pad&&(o.b64Pad=t.b64Pad),t.outputLen){if(t.outputLen%8!=0)throw new Error(e);o.outputLen=t.outputLen}else if(t.shakeLen){if(t.shakeLen%8!=0)throw new Error(e);o.outputLen=t.shakeLen}if(typeof o.outputUpper!="boolean")throw new Error("Invalid outputUpper formatting option");if(typeof o.b64Pad!="string")throw new Error("Invalid b64Pad formatting option");return o}function Mt(i,o,t,e){let n=i+" must include a value and format";if(!o){if(!e)throw new Error(n);return e}if(o.value===void 0||!o.format)throw new Error(n);return It(o.format,o.encoding||"UTF8",t)(o.value)}var Tt=class{constructor(o,t,e){let n=e||{};if(this.t=t,this.i=n.encoding||"UTF8",this.numRounds=n.numRounds||1,isNaN(this.numRounds)||this.numRounds!==parseInt(this.numRounds,10)||1>this.numRounds)throw new Error("numRounds must a integer >= 1");this.o=o,this.h=[],this.u=0,this.l=!1,this.A=0,this.H=!1,this.S=[],this.p=[]}update(o){let t,e=0,n=this.m>>>5,a=this.C(o,this.h,this.u),s=a.binLen,u=a.value,d=s>>>5;for(t=0;t<d;t+=n)e+this.m<=s&&(this.U=this.v(u.slice(t,t+n),this.U),e+=this.m);return this.A+=e,this.h=u.slice(e>>>5),this.u=s%this.m,this.l=!0,this}getHash(o,t){let e,n,a=this.R,s=ei(t);if(this.K){if(s.outputLen===-1)throw new Error("Output length must be specified in options");a=s.outputLen}let u=ti(o,a,this.T,s);if(this.H&&this.g)return u(this.g(s));for(n=this.F(this.h.slice(),this.u,this.A,this.L(this.U),a),e=1;e<this.numRounds;e+=1)this.K&&a%32!=0&&(n[n.length-1]&=16777215>>>24-a%32),n=this.F(n,a,0,this.B(this.o),a);return u(n)}setHMACKey(o,t,e){if(!this.M)throw new Error("Variant does not support HMAC");if(this.l)throw new Error("Cannot set MAC key after calling update");let n=It(t,(e||{}).encoding||"UTF8",this.T);this.k(n(o))}k(o){let t=this.m>>>3,e=t/4-1,n;if(this.numRounds!==1)throw new Error(ui);if(this.H)throw new Error("MAC key already set");for(t<o.binLen/8&&(o.value=this.F(o.value,o.binLen,0,this.B(this.o),this.R));o.value.length<=e;)o.value.push(0);for(n=0;n<=e;n+=1)this.S[n]=909522486^o.value[n],this.p[n]=1549556828^o.value[n];this.U=this.v(this.S,this.U),this.A=this.m,this.H=!0}getHMAC(o,t){let e=ei(t);return ti(o,this.R,this.T,e)(this.Y())}Y(){let o;if(!this.H)throw new Error("Cannot call getHMAC without first setting MAC key");let t=this.F(this.h.slice(),this.u,this.A,this.L(this.U),this.R);return o=this.v(this.p,this.B(this.o)),o=this.F(t,this.R,this.m,o,this.R),o}};function Gt(i,o){return i<<o|i>>>32-o}function Ct(i,o){return i>>>o|i<<32-o}function di(i,o){return i>>>o}function ii(i,o,t){return i^o^t}function _i(i,o,t){return i&o^~i&t}function fi(i,o,t){return i&o^i&t^o&t}function Vi(i){return Ct(i,2)^Ct(i,13)^Ct(i,22)}function nt(i,o){let t=(65535&i)+(65535&o);return(65535&(i>>>16)+(o>>>16)+(t>>>16))<<16|65535&t}function Ni(i,o,t,e){let n=(65535&i)+(65535&o)+(65535&t)+(65535&e);return(65535&(i>>>16)+(o>>>16)+(t>>>16)+(e>>>16)+(n>>>16))<<16|65535&n}function Ut(i,o,t,e,n){let a=(65535&i)+(65535&o)+(65535&t)+(65535&e)+(65535&n);return(65535&(i>>>16)+(o>>>16)+(t>>>16)+(e>>>16)+(n>>>16)+(a>>>16))<<16|65535&a}function Li(i){return Ct(i,7)^Ct(i,18)^di(i,3)}function Pi(i){return Ct(i,6)^Ct(i,11)^Ct(i,25)}function Ri(i){return[1732584193,4023233417,2562383102,271733878,3285377520]}function hi(i,o){let t,e,n,a,s,u,d,f=[];for(t=o[0],e=o[1],n=o[2],a=o[3],s=o[4],d=0;d<80;d+=1)f[d]=d<16?i[d]:Gt(f[d-3]^f[d-8]^f[d-14]^f[d-16],1),u=d<20?Ut(Gt(t,5),_i(e,n,a),s,1518500249,f[d]):d<40?Ut(Gt(t,5),ii(e,n,a),s,1859775393,f[d]):d<60?Ut(Gt(t,5),fi(e,n,a),s,2400959708,f[d]):Ut(Gt(t,5),ii(e,n,a),s,3395469782,f[d]),s=a,a=n,n=Gt(e,30),e=t,t=u;return o[0]=nt(t,o[0]),o[1]=nt(e,o[1]),o[2]=nt(n,o[2]),o[3]=nt(a,o[3]),o[4]=nt(s,o[4]),o}function Bi(i,o,t,e){let n,a=15+(o+65>>>9<<4),s=o+t;for(;i.length<=a;)i.push(0);for(i[o>>>5]|=128<<24-o%32,i[a]=4294967295&s,i[a-1]=s/jt|0,n=0;n<i.length;n+=16)e=hi(i.slice(n,n+16),e);return e}var Ui=class extends Tt{constructor(i,o,t){if(i!=="SHA-1")throw new Error(Ht);super(i,o,t);let e=t||{};this.M=!0,this.g=this.Y,this.T=-1,this.C=It(this.t,this.i,this.T),this.v=hi,this.L=function(n){return n.slice()},this.B=Ri,this.F=Bi,this.U=[1732584193,4023233417,2562383102,271733878,3285377520],this.m=512,this.R=160,this.K=!1,e.hmacKey&&this.k(Mt("hmacKey",e.hmacKey,this.T))}};function ni(i){let o;return o=i=="SHA-224"?xt.slice():gt.slice(),o}function oi(i,o){let t,e,n,a,s,u,d,f,C,_,x,M=[];for(t=o[0],e=o[1],n=o[2],a=o[3],s=o[4],u=o[5],d=o[6],f=o[7],x=0;x<64;x+=1)M[x]=x<16?i[x]:Ni(Ct(F=M[x-2],17)^Ct(F,19)^di(F,10),M[x-7],Li(M[x-15]),M[x-16]),C=Ut(f,Pi(s),_i(s,u,d),w[x],M[x]),_=nt(Vi(t),fi(t,e,n)),f=d,d=u,u=s,s=nt(a,C),a=n,n=e,e=t,t=nt(C,_);var F;return o[0]=nt(t,o[0]),o[1]=nt(e,o[1]),o[2]=nt(n,o[2]),o[3]=nt(a,o[3]),o[4]=nt(s,o[4]),o[5]=nt(u,o[5]),o[6]=nt(d,o[6]),o[7]=nt(f,o[7]),o}var ji=class extends Tt{constructor(i,o,t){if(i!=="SHA-224"&&i!=="SHA-256")throw new Error(Ht);super(i,o,t);let e=t||{};this.g=this.Y,this.M=!0,this.T=-1,this.C=It(this.t,this.i,this.T),this.v=oi,this.L=function(n){return n.slice()},this.B=ni,this.F=function(n,a,s,u){return function(d,f,C,_,x){let M,F,k=15+(f+65>>>9<<4),R=f+C;for(;d.length<=k;)d.push(0);for(d[f>>>5]|=128<<24-f%32,d[k]=4294967295&R,d[k-1]=R/jt|0,M=0;M<d.length;M+=16)_=oi(d.slice(M,M+16),_);return F=x==="SHA-224"?[_[0],_[1],_[2],_[3],_[4],_[5],_[6]]:_,F}(n,a,s,u,i)},this.U=ni(i),this.m=512,this.R=i==="SHA-224"?224:256,this.K=!1,e.hmacKey&&this.k(Mt("hmacKey",e.hmacKey,this.T))}},p=class{constructor(o,t){this.N=o,this.I=t}};function ai(i,o){let t;return o>32?(t=64-o,new p(i.I<<o|i.N>>>t,i.N<<o|i.I>>>t)):o!==0?(t=32-o,new p(i.N<<o|i.I>>>t,i.I<<o|i.N>>>t)):i}function yt(i,o){let t;return o<32?(t=32-o,new p(i.N>>>o|i.I<<t,i.I>>>o|i.N<<t)):(t=64-o,new p(i.I>>>o|i.N<<t,i.N>>>o|i.I<<t))}function Ci(i,o){return new p(i.N>>>o,i.I>>>o|i.N<<32-o)}function Hi(i,o,t){return new p(i.N&o.N^i.N&t.N^o.N&t.N,i.I&o.I^i.I&t.I^o.I&t.I)}function $i(i){let o=yt(i,28),t=yt(i,34),e=yt(i,39);return new p(o.N^t.N^e.N,o.I^t.I^e.I)}function _t(i,o){let t,e;t=(65535&i.I)+(65535&o.I),e=(i.I>>>16)+(o.I>>>16)+(t>>>16);let n=(65535&e)<<16|65535&t;return t=(65535&i.N)+(65535&o.N)+(e>>>16),e=(i.N>>>16)+(o.N>>>16)+(t>>>16),new p((65535&e)<<16|65535&t,n)}function Oi(i,o,t,e){let n,a;n=(65535&i.I)+(65535&o.I)+(65535&t.I)+(65535&e.I),a=(i.I>>>16)+(o.I>>>16)+(t.I>>>16)+(e.I>>>16)+(n>>>16);let s=(65535&a)<<16|65535&n;return n=(65535&i.N)+(65535&o.N)+(65535&t.N)+(65535&e.N)+(a>>>16),a=(i.N>>>16)+(o.N>>>16)+(t.N>>>16)+(e.N>>>16)+(n>>>16),new p((65535&a)<<16|65535&n,s)}function qi(i,o,t,e,n){let a,s;a=(65535&i.I)+(65535&o.I)+(65535&t.I)+(65535&e.I)+(65535&n.I),s=(i.I>>>16)+(o.I>>>16)+(t.I>>>16)+(e.I>>>16)+(n.I>>>16)+(a>>>16);let u=(65535&s)<<16|65535&a;return a=(65535&i.N)+(65535&o.N)+(65535&t.N)+(65535&e.N)+(65535&n.N)+(s>>>16),s=(i.N>>>16)+(o.N>>>16)+(t.N>>>16)+(e.N>>>16)+(n.N>>>16)+(a>>>16),new p((65535&s)<<16|65535&a,u)}function Bt(i,o){return new p(i.N^o.N,i.I^o.I)}function Ki(i){let o=yt(i,19),t=yt(i,61),e=Ci(i,6);return new p(o.N^t.N^e.N,o.I^t.I^e.I)}function zi(i){let o=yt(i,1),t=yt(i,8),e=Ci(i,7);return new p(o.N^t.N^e.N,o.I^t.I^e.I)}function Yi(i){let o=yt(i,14),t=yt(i,18),e=yt(i,41);return new p(o.N^t.N^e.N,o.I^t.I^e.I)}var Xi=[new p(w[0],3609767458),new p(w[1],602891725),new p(w[2],3964484399),new p(w[3],2173295548),new p(w[4],4081628472),new p(w[5],3053834265),new p(w[6],2937671579),new p(w[7],3664609560),new p(w[8],2734883394),new p(w[9],1164996542),new p(w[10],1323610764),new p(w[11],3590304994),new p(w[12],4068182383),new p(w[13],991336113),new p(w[14],633803317),new p(w[15],3479774868),new p(w[16],2666613458),new p(w[17],944711139),new p(w[18],2341262773),new p(w[19],2007800933),new p(w[20],1495990901),new p(w[21],1856431235),new p(w[22],3175218132),new p(w[23],2198950837),new p(w[24],3999719339),new p(w[25],766784016),new p(w[26],2566594879),new p(w[27],3203337956),new p(w[28],1034457026),new p(w[29],2466948901),new p(w[30],3758326383),new p(w[31],168717936),new p(w[32],1188179964),new p(w[33],1546045734),new p(w[34],1522805485),new p(w[35],2643833823),new p(w[36],2343527390),new p(w[37],1014477480),new p(w[38],1206759142),new p(w[39],344077627),new p(w[40],1290863460),new p(w[41],3158454273),new p(w[42],3505952657),new p(w[43],106217008),new p(w[44],3606008344),new p(w[45],1432725776),new p(w[46],1467031594),new p(w[47],851169720),new p(w[48],3100823752),new p(w[49],1363258195),new p(w[50],3750685593),new p(w[51],3785050280),new p(w[52],3318307427),new p(w[53],3812723403),new p(w[54],2003034995),new p(w[55],3602036899),new p(w[56],1575990012),new p(w[57],1125592928),new p(w[58],2716904306),new p(w[59],442776044),new p(w[60],593698344),new p(w[61],3733110249),new p(w[62],2999351573),new p(w[63],3815920427),new p(3391569614,3928383900),new p(3515267271,566280711),new p(3940187606,3454069534),new p(4118630271,4000239992),new p(116418474,1914138554),new p(174292421,2731055270),new p(289380356,3203993006),new p(460393269,320620315),new p(685471733,587496836),new p(852142971,1086792851),new p(1017036298,365543100),new p(1126000580,2618297676),new p(1288033470,3409855158),new p(1501505948,4234509866),new p(1607167915,987167468),new p(1816402316,1246189591)];function ri(i){return i==="SHA-384"?[new p(3418070365,xt[0]),new p(1654270250,xt[1]),new p(2438529370,xt[2]),new p(355462360,xt[3]),new p(1731405415,xt[4]),new p(41048885895,xt[5]),new p(3675008525,xt[6]),new p(1203062813,xt[7])]:[new p(gt[0],4089235720),new p(gt[1],2227873595),new p(gt[2],4271175723),new p(gt[3],1595750129),new p(gt[4],2917565137),new p(gt[5],725511199),new p(gt[6],4215389547),new p(gt[7],327033209)]}function li(i,o){let t,e,n,a,s,u,d,f,C,_,x,M,F=[];for(t=o[0],e=o[1],n=o[2],a=o[3],s=o[4],u=o[5],d=o[6],f=o[7],x=0;x<80;x+=1)x<16?(M=2*x,F[x]=new p(i[M],i[M+1])):F[x]=Oi(Ki(F[x-2]),F[x-7],zi(F[x-15]),F[x-16]),C=qi(f,Yi(s),(R=u,b=d,new p((k=s).N&R.N^~k.N&b.N,k.I&R.I^~k.I&b.I)),Xi[x],F[x]),_=_t($i(t),Hi(t,e,n)),f=d,d=u,u=s,s=_t(a,C),a=n,n=e,e=t,t=_t(C,_);var k,R,b;return o[0]=_t(t,o[0]),o[1]=_t(e,o[1]),o[2]=_t(n,o[2]),o[3]=_t(a,o[3]),o[4]=_t(s,o[4]),o[5]=_t(u,o[5]),o[6]=_t(d,o[6]),o[7]=_t(f,o[7]),o}var Wi=class extends Tt{constructor(i,o,t){if(i!=="SHA-384"&&i!=="SHA-512")throw new Error(Ht);super(i,o,t);let e=t||{};this.g=this.Y,this.M=!0,this.T=-1,this.C=It(this.t,this.i,this.T),this.v=li,this.L=function(n){return n.slice()},this.B=ri,this.F=function(n,a,s,u){return function(d,f,C,_,x){let M,F,k=31+(f+129>>>10<<5),R=f+C;for(;d.length<=k;)d.push(0);for(d[f>>>5]|=128<<24-f%32,d[k]=4294967295&R,d[k-1]=R/jt|0,M=0;M<d.length;M+=32)_=li(d.slice(M,M+32),_);return F=x==="SHA-384"?[_[0].N,_[0].I,_[1].N,_[1].I,_[2].N,_[2].I,_[3].N,_[3].I,_[4].N,_[4].I,_[5].N,_[5].I]:[_[0].N,_[0].I,_[1].N,_[1].I,_[2].N,_[2].I,_[3].N,_[3].I,_[4].N,_[4].I,_[5].N,_[5].I,_[6].N,_[6].I,_[7].N,_[7].I],F}(n,a,s,u,i)},this.U=ri(i),this.m=1024,this.R=i==="SHA-384"?384:512,this.K=!1,e.hmacKey&&this.k(Mt("hmacKey",e.hmacKey,this.T))}},Qi=[new p(0,1),new p(0,32898),new p(2147483648,32906),new p(2147483648,2147516416),new p(0,32907),new p(0,2147483649),new p(2147483648,2147516545),new p(2147483648,32777),new p(0,138),new p(0,136),new p(0,2147516425),new p(0,2147483658),new p(0,2147516555),new p(2147483648,139),new p(2147483648,32905),new p(2147483648,32771),new p(2147483648,32770),new p(2147483648,128),new p(0,32778),new p(2147483648,2147483658),new p(2147483648,2147516545),new p(2147483648,32896),new p(0,2147483649),new p(2147483648,2147516424)],Ji=[[0,36,3,41,18],[1,44,10,45,2],[62,6,43,15,61],[28,55,25,21,56],[27,20,39,8,14]];function Ce(i){let o,t=[];for(o=0;o<5;o+=1)t[o]=[new p(0,0),new p(0,0),new p(0,0),new p(0,0),new p(0,0)];return t}function Zi(i){let o,t=[];for(o=0;o<5;o+=1)t[o]=i[o].slice();return t}function ce(i,o){let t,e,n,a,s=[],u=[];if(i!==null)for(e=0;e<i.length;e+=2)o[(e>>>1)%5][(e>>>1)/5|0]=Bt(o[(e>>>1)%5][(e>>>1)/5|0],new p(i[e+1],i[e]));for(t=0;t<24;t+=1){for(a=Ce(),e=0;e<5;e+=1)s[e]=(d=o[e][0],f=o[e][1],C=o[e][2],_=o[e][3],x=o[e][4],new p(d.N^f.N^C.N^_.N^x.N,d.I^f.I^C.I^_.I^x.I));for(e=0;e<5;e+=1)u[e]=Bt(s[(e+4)%5],ai(s[(e+1)%5],1));for(e=0;e<5;e+=1)for(n=0;n<5;n+=1)o[e][n]=Bt(o[e][n],u[e]);for(e=0;e<5;e+=1)for(n=0;n<5;n+=1)a[n][(2*e+3*n)%5]=ai(o[e][n],Ji[e][n]);for(e=0;e<5;e+=1)for(n=0;n<5;n+=1)o[e][n]=Bt(a[e][n],new p(~a[(e+1)%5][n].N&a[(e+2)%5][n].N,~a[(e+1)%5][n].I&a[(e+2)%5][n].I));o[0][0]=Bt(o[0][0],Qi[t])}var d,f,C,_,x;return o}function yi(i){let o,t,e=0,n=[0,0],a=[4294967295&i,i/jt&2097151];for(o=6;o>=0;o--)t=a[o>>2]>>>8*o&255,t===0&&e===0||(n[e+1>>2]|=t<<8*(e+1),e+=1);return e=e!==0?e:1,n[0]|=e,{value:e+1>4?n:[n[0]],binLen:8+8*e}}function he(i){return me(yi(i.binLen),i)}function si(i,o){let t,e=yi(o);e=me(e,i);let n=o>>>2,a=(n-e.value.length%n)%n;for(t=0;t<a;t++)e.value.push(0);return e.value}var tn=class extends Tt{constructor(i,o,t){let e=6,n=0;super(i,o,t);let a=t||{};if(this.numRounds!==1){if(a.kmacKey||a.hmacKey)throw new Error(ui);if(this.o==="CSHAKE128"||this.o==="CSHAKE256")throw new Error("Cannot set numRounds for CSHAKE variants")}switch(this.T=1,this.C=It(this.t,this.i,this.T),this.v=ce,this.L=Zi,this.B=Ce,this.U=Ce(),this.K=!1,i){case"SHA3-224":this.m=n=1152,this.R=224,this.M=!0,this.g=this.Y;break;case"SHA3-256":this.m=n=1088,this.R=256,this.M=!0,this.g=this.Y;break;case"SHA3-384":this.m=n=832,this.R=384,this.M=!0,this.g=this.Y;break;case"SHA3-512":this.m=n=576,this.R=512,this.M=!0,this.g=this.Y;break;case"SHAKE128":e=31,this.m=n=1344,this.R=-1,this.K=!0,this.M=!1,this.g=null;break;case"SHAKE256":e=31,this.m=n=1088,this.R=-1,this.K=!0,this.M=!1,this.g=null;break;case"KMAC128":e=4,this.m=n=1344,this.X(t),this.R=-1,this.K=!0,this.M=!1,this.g=this._;break;case"KMAC256":e=4,this.m=n=1088,this.X(t),this.R=-1,this.K=!0,this.M=!1,this.g=this._;break;case"CSHAKE128":this.m=n=1344,e=this.O(t),this.R=-1,this.K=!0,this.M=!1,this.g=null;break;case"CSHAKE256":this.m=n=1088,e=this.O(t),this.R=-1,this.K=!0,this.M=!1,this.g=null;break;default:throw new Error(Ht)}this.F=function(s,u,d,f,C){return function(_,x,M,F,k,R,b){let O,U,Y=0,dt=[],$t=k>>>5,Di=x>>>5;for(O=0;O<Di&&x>=k;O+=$t)F=ce(_.slice(O,O+$t),F),x-=k;for(_=_.slice(O),x%=k;_.length<$t;)_.push(0);for(O=x>>>3,_[O>>2]^=R<<O%4*8,_[$t-1]^=2147483648,F=ce(_,F);32*dt.length<b&&(U=F[Y%5][Y/5|0],dt.push(U.I),!(32*dt.length>=b));)dt.push(U.N),Y+=1,64*Y%k==0&&(ce(null,F),Y=0);return dt}(s,u,0,f,n,e,C)},a.hmacKey&&this.k(Mt("hmacKey",a.hmacKey,this.T))}O(i,o){let t=function(n){let a=n||{};return{funcName:Mt("funcName",a.funcName,1,{value:[],binLen:0}),customization:Mt("Customization",a.customization,1,{value:[],binLen:0})}}(i||{});o&&(t.funcName=o);let e=me(he(t.funcName),he(t.customization));if(t.customization.binLen!==0||t.funcName.binLen!==0){let n=si(e,this.m>>>3);for(let a=0;a<n.length;a+=this.m>>>5)this.U=this.v(n.slice(a,a+(this.m>>>5)),this.U),this.A+=this.m;return 4}return 31}X(i){let o=function(e){let n=e||{};return{kmacKey:Mt("kmacKey",n.kmacKey,1),funcName:{value:[1128353099],binLen:32},customization:Mt("Customization",n.customization,1,{value:[],binLen:0})}}(i||{});this.O(i,o.funcName);let t=si(he(o.kmacKey),this.m>>>3);for(let e=0;e<t.length;e+=this.m>>>5)this.U=this.v(t.slice(e,e+(this.m>>>5)),this.U),this.A+=this.m;this.H=!0}_(i){let o=me({value:this.h.slice(),binLen:this.u},function(t){let e,n,a=0,s=[0,0],u=[4294967295&t,t/jt&2097151];for(e=6;e>=0;e--)n=u[e>>2]>>>8*e&255,n===0&&a===0||(s[a>>2]|=n<<8*a,a+=1);return a=a!==0?a:1,s[a>>2]|=a<<8*a,{value:a+1>4?s:[s[0]],binLen:8+8*a}}(i.outputLen));return this.F(o.value,o.binLen,this.A,this.L(this.U),i.outputLen)}},pe=class{constructor(o,t,e){if(o=="SHA-1")this.P=new Ui(o,t,e);else if(o=="SHA-224"||o=="SHA-256")this.P=new ji(o,t,e);else if(o=="SHA-384"||o=="SHA-512")this.P=new Wi(o,t,e);else{if(o!="SHA3-224"&&o!="SHA3-256"&&o!="SHA3-384"&&o!="SHA3-512"&&o!="SHAKE128"&&o!="SHAKE256"&&o!="CSHAKE128"&&o!="CSHAKE256"&&o!="KMAC128"&&o!="KMAC256")throw new Error(Ht);this.P=new tn(o,t,e)}}update(o){return this.P.update(o),this}getHash(o,t){return this.P.getHash(o,t)}setHMACKey(o,t,e){this.P.setHMACKey(o,t,e)}getHMAC(o,t){return this.P.getHMAC(o,t)}};var en=(i,o)=>o.name;function nn(i,o){if(i&1&&V(0,"mat-progress-bar",3),i&2){let t=o.$implicit,e=h();y("value",e.fileProgressMap[t.name].progress/e.fileProgressMap[t.name].total*100)("mode","determinate")}}var xi=(()=>{class i{constructor(t){this.web=t,this.fileProgressMap={},this.fileList=[],this.fileType="",this.fileCategory="",this.analysisGroupId=0,this.fileUploaded=new ot,this.allowFileType=["csv","tsv","txt"]}uploadData(t){return kt(this,null,function*(){let e=t.target.files;if(e){this.fileList=[];for(let n=0;n<e.length;n++)this.fileList.push(e[n]),this.fileProgressMap[e[n].name]={progress:0,total:e[n].size};for(let n=0;n<e.length;n++)yield this.uploadFile(e[n])}})}getFileExntension(t){let e=t.name.split(".");return e.length>1?e[e.length-1]:""}uploadFile(t){return kt(this,null,function*(){let n=t.size,a=new pe("SHA-256","ARRAYBUFFER");if(this.fileType=this.getFileExntension(t),this.allowFileType.indexOf(this.fileType)!==-1)if(1048576>n){let s=yield t.arrayBuffer();a.update(s);let u=a.getHash("HEX"),d=yield this.web.uploadDataChunkComplete("",u,t,t.name).toPromise();this.fileProgressMap[t.name].progress=n,d?.completed_at&&this.web.bindUploadedFile(this.analysisGroupId,this.fileType,this.fileCategory,t.name,d?.id).subscribe(f=>{this.fileUploaded.emit(f)})}else{let s="",u=0;for(;n>u;){let d=u+1048576;d>=n&&(d=n);let f=yield t.slice(u,d).arrayBuffer();a.update(f);let C=new File([f],t.name,{type:t.type});console.log(C.size);let _=`bytes ${u}-${d-1}/${n}`;console.log(_);let x=yield this.web.uploadDataChunk(s,C,t.name,_).toPromise();x&&(s=x.url,u=x.offset,this.fileProgressMap[t.name].progress=u)}if(s!==""){let d=a.getHash("HEX"),f=yield this.web.uploadDataChunkComplete(s,d).toPromise();f?.completed_at&&this.web.bindUploadedFile(this.analysisGroupId,this.fileType,this.fileCategory,t.name,f?.id).subscribe(C=>{this.fileProgressMap[t.name].progress=n,this.fileUploaded.emit(C)})}}})}static{this.\u0275fac=function(e){return new(e||i)(G(it))}}static{this.\u0275cmp=j({type:i,selectors:[["app-upload-file"]],inputs:{fileType:"fileType",fileCategory:"fileCategory",analysisGroupId:"analysisGroupId"},outputs:{fileUploaded:"fileUploaded"},standalone:!0,features:[$],decls:8,vars:0,consts:[["file",""],["mat-icon-button","","type","button",3,"click"],["type","file","hidden","",3,"change"],[3,"value","mode"]],template:function(e,n){if(e&1){let a=B();r(0,"form")(1,"button",1),g("click",function(){v(a);let u=lt(5);return S(u.click())}),r(2,"mat-icon"),c(3,"upload"),l()(),r(4,"input",2,0),g("change",function(u){return v(a),S(n.uploadData(u))}),l()(),T(6,nn,1,2,"mat-progress-bar",3,en)}e&2&&(m(6),I(n.fileList))},dependencies:[vt,wt,se,z,K,q]})}}return i})();var on=["table"];function an(i,o){if(i&1&&(r(0,"mat-option",7),c(1),l()),i&2){let t=o.$implicit;y("value",t),m(),L(t)}}function rn(i,o){i&1&&(r(0,"th",16),c(1," Sample "),l())}function ln(i,o){if(i&1&&(r(0,"td",17),c(1),l()),i&2){let t=o.$implicit;m(),H(" ",t.value.Sample," ")}}function sn(i,o){i&1&&(r(0,"th",16),c(1," Condition "),l())}function cn(i,o){if(i&1){let t=B();r(0,"td",17)(1,"form",4)(2,"mat-form-field")(3,"input",18,1),g("change",function(n){v(t);let a=lt(4),s=h(2);return S(s.handleAutoCompleteChange(n,a.value))}),l(),r(5,"mat-label"),c(6),l()()()()}if(i&2){let t=o.$implicit;m(),y("formGroup",t),m(2),Ot("placeholder",t.value.Sample),m(3),L(t.value.Sample)}}function mn(i,o){i&1&&V(0,"tr",19)}function pn(i,o){i&1&&V(0,"tr",20)}function un(i,o){if(i&1&&(r(0,"table",8,0),Vt(2,10),E(3,rn,2,0,"th",11)(4,ln,2,1,"td",12),Nt(),Vt(5,13),E(6,sn,2,0,"th",11)(7,cn,7,3,"td",12),Nt(),E(8,mn,1,0,"tr",14)(9,pn,1,0,"tr",15),l()),i&2){let t=h();y("dataSource",t.annotationData),m(8),y("matHeaderRowDef",t.displayedColumns),m(),y("matRowDefColumns",t.displayedColumns)}}var gi=(()=>{class i{set annotation(t){t&&(this._annotation=t,this.annotationData=t.annotations.map(e=>this.fb.group({Sample:new A(e.Sample,P.required),Condition:new A(e.Condition,P.required)})),this.form.patchValue({columns:this.annotationData.map(e=>e.value.Sample)}))}get annotation(){return this._annotation}set projectFile(t){this._projectFile=t,this.web.getProjectFileColumns(t.id).subscribe(e=>{let n=[];e.forEach(a=>{n.includes(a)||n.push(a)}),this.columns=n})}get projectFile(){return this._projectFile}onSelectionChange(t){let e=t.source,n=-1,a=e.selected,s;for(let d=0;d<a.length;d++)if(!this.lastSelection.find(f=>f===a[d].value)){s=a[d];break}let u=e.options.toArray();n=u.indexOf(s),this.shiftPressed&&this.lastSelectedIndex>-1&&u.forEach((d,f)=>{this.isBetween(f,this.lastSelectedIndex,n)&&(console.log(d),d.select())}),this.lastSelection=this.form.value.columns?.slice(),this.lastSelectedIndex=n,this.table?.renderRows()}constructor(t,e,n){this.fb=t,this.web=e,this.dialogRef=n,this.columns=[],this.shiftPressed=!1,this.displayedColumns=["Sample","Condition"],this.form=this.fb.group({columns:new A([])}),this.annotationData=[],this.lastSelectedIndex=-1,this.lastSelection=[],window.addEventListener("keydown",a=>{a.key==="Shift"&&(this.shiftPressed=!0)}),window.addEventListener("keyup",a=>{a.key==="Shift"&&(this.shiftPressed=!1)}),this.form.controls.columns.valueChanges.subscribe(a=>{if(a){let s=a.map(u=>{let d=u.split(/\./g);return console.log(d),d.length>2?{Sample:u,Condition:d.slice(0,d.length-1).join(".")}:d.length===2?{Sample:u,Condition:d[0]}:{Sample:u,Condition:""}});for(let u=0;u<s.length;u++)this.annotationData.find(d=>d.value.Sample===s[u].Sample)||this.annotationData.push(this.fb.group({Sample:new A(s[u].Sample,P.required),Condition:new A(s[u].Condition,P.required)}));for(let u=0;u<this.annotationData.length;u++)this.annotationData[u].value.Sample&&(a.includes(this.annotationData[u].value.Sample)||this.annotationData.splice(u,1))}})}cancel(){this.dialogRef.close()}save(){let t=!0,e=this.annotationData.map(n=>(n.valid||(t=!1),n.value));t&&this.dialogRef.close(e)}handleAutoCompleteChange(t,e){console.log(t,e)}isBetween(t,e,n){return e<n?t>=e&&t<=n:t>=n&&t<=e}static{this.\u0275fac=function(e){return new(e||i)(G(Z),G(it),G(ct))}}static{this.\u0275cmp=j({type:i,selectors:[["app-analysis-group-sample-annotation-modal"]],viewQuery:function(e,n){if(e&1&&qt(on,5),e&2){let a;Kt(a=zt())&&(n.table=a.first)}},inputs:{annotation:"annotation",projectFile:"projectFile"},standalone:!0,features:[$],decls:16,vars:3,consts:[["table",""],["optionCondition",""],["mat-dialog-title",""],["mat-dialog-content",""],[3,"formGroup"],[2,"width","300px"],["formControlName","columns",3,"selectionChange","multiple"],[3,"value"],["mat-table","",3,"dataSource"],["mat-button","",3,"click"],["matColumnDef","Sample"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","Condition"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["matInput","","formControlName","Condition",2,"border-radius","0",3,"change","placeholder"],["mat-header-row",""],["mat-row",""]],template:function(e,n){e&1&&(r(0,"h2",2),c(1,"Sample Annotation"),l(),r(2,"div",3)(3,"form",4)(4,"mat-form-field",5)(5,"mat-select",6),g("selectionChange",function(s){return n.onSelectionChange(s)}),T(6,an,2,2,"mat-option",7,N),l(),r(8,"mat-label"),c(9,"Columns"),l()()(),E(10,un,10,3,"table",8),l(),r(11,"mat-dialog-actions")(12,"button",9),g("click",function(){return n.save()}),c(13,"Submit"),l(),r(14,"button",9),g("click",function(){return n.cancel()}),c(15,"Close"),l()()),e&2&&(m(3),y("formGroup",n.form),m(2),y("multiple",!0),m(),I(n.columns),m(4),D(n.annotationData.length>0?10:-1))},dependencies:[mt,pt,z,K,at,W,q,Q,J,et,St,st,tt,rt,Et,ut,X,Ie,Ne,Le,Pe,Ue,je,Be,Re,ke,Ve]})}}return i})();function dn(i,o){if(i&1&&(r(0,"mat-option",7),c(1),l()),i&2){let t=o.$implicit;y("value",t),m(),L(t)}}function _n(i,o){if(i&1&&(r(0,"mat-option",7),c(1),l()),i&2){let t=o.$implicit;y("value",t),m(),L(t)}}function fn(i,o){if(i&1&&(r(0,"mat-option",7),c(1),l()),i&2){let t=o.$implicit;y("value",t),m(),L(t)}}function hn(i,o){if(i&1&&(r(0,"mat-option",7),c(1),l()),i&2){let t=o.$implicit;y("value",t),m(),L(t)}}function Cn(i,o){if(i&1&&(r(0,"mat-option",7),c(1),l()),i&2){let t=o.$implicit;y("value",t),m(),L(t)}}function yn(i,o){if(i&1&&(r(0,"mat-option",7),c(1),l()),i&2){let t=o.$implicit;y("value",t),m(),L(t)}}function xn(i,o){if(i&1&&(r(0,"mat-form-field")(1,"mat-select",14),T(2,yn,2,2,"mat-option",7,N),l(),r(4,"mat-label"),c(5,"Comparison Label"),l()()),i&2){let t=h(2).$implicit,e=h(2);m(2),I(e.comparison_labels_map[t.value.comparison_col])}}function gn(i,o){i&1&&(r(0,"mat-form-field"),V(1,"input",15),r(2,"mat-label"),c(3,"Comparison Label"),l()())}function bn(i,o){if(i&1){let t=B();r(0,"mat-tab",4),Vt(1),r(2,"div")(3,"form",5)(4,"div")(5,"mat-form-field")(6,"mat-select",6),T(7,dn,2,2,"mat-option",7,N),l(),r(9,"mat-label"),c(10,"Condition A"),l()()(),r(11,"div")(12,"mat-form-field")(13,"mat-select",8),T(14,_n,2,2,"mat-option",7,N),l(),r(16,"mat-label"),c(17,"Condition B"),l()()(),r(18,"div")(19,"mat-form-field")(20,"mat-select",9),T(21,fn,2,2,"mat-option",7,N),l(),r(23,"mat-label"),c(24,"Fold Change Column"),l()()(),r(25,"div")(26,"mat-form-field")(27,"mat-select",10),T(28,hn,2,2,"mat-option",7,N),l(),r(30,"mat-label"),c(31,"P-Value Column"),l()()(),r(32,"div")(33,"mat-form-field")(34,"mat-select",11),T(35,Cn,2,2,"mat-option",7,N),l(),r(37,"mat-label"),c(38,"Comparison Column"),l()()(),c(39," If the comparison column has been selected, please select the comparison label column below. If not, please write the comparison label in the text box below. "),r(40,"div"),E(41,xn,6,0,"mat-form-field")(42,gn,4,0,"mat-form-field"),l()()(),r(43,"div",12)(44,"button",13),g("click",function(){v(t);let n=h().$implicit,a=h(2);return S(a.copyComparison(n))}),r(45,"mat-icon"),c(46,"content_copy"),l()(),r(47,"button",13),g("click",function(){v(t);let n=h().$index,a=h(2);return S(a.removeComparison(n))}),r(48,"mat-icon"),c(49,"remove"),l()()(),Nt(),l()}if(i&2){let t=h().$implicit,e=h(2);y("label",t.value.comparison_label),m(3),y("formGroup",t),m(4),I(e.conditions),m(7),I(e.conditions),m(7),I(e.columns),m(7),I(e.columns),m(7),I(e.columns),m(6),D(t.value.comparison_col?41:42)}}function wn(i,o){if(i&1&&E(0,bn,50,3,"mat-tab",4),i&2){let t=o.$implicit;D(t.value.comparison_label?0:-1)}}function vn(i,o){if(i&1&&(r(0,"mat-tab-group",2),T(1,wn,1,1,null,null,N),l()),i&2){let t=h();m(),I(t.form)}}var bi=(()=>{class i{set comparisonMatrix(t){this._comparisonMatrix=t,this.form=t.matrix.map(e=>this.fb.group({condition_A:new A(e.condition_A,P.required),condition_B:new A(e.condition_B,P.required),fold_change_col:new A(e.fold_change_col,P.required),p_value_col:new A(e.p_value_col,P.required),comparison_label:new A(e.comparison_label,P.required),comparison_col:new A(e.comparison_col)}));for(let e of this.form)e.controls.comparison_col.value&&this.web.getUniqueComparisonLabel(t.file,e.controls.comparison_col.value).subscribe(n=>{this.comparison_labels_map[e.controls.comparison_col.value]=n}),e.controls.comparison_col.valueChanges.subscribe(n=>{n&&this.web.getUniqueComparisonLabel(t.file,n).subscribe(a=>{this.comparison_labels_map[n]=a})}),e.controls.comparison_label.valueChanges.subscribe(n=>{n||e.controls.comparison_label.setValue("temp_title")})}get comparisonMatrix(){return this._comparisonMatrix}set projectFile(t){this._projectFile=t,this.web.getProjectFileColumns(t.id).subscribe(e=>{let n=[];e.forEach(a=>{n.includes(a)||n.push(a)}),this.columns=n})}get projectFile(){return this._projectFile}set sampleAnnotations(t){this._sampleAnnotations=t,t&&(this.conditions=[],t.annotations.forEach(e=>{console.log(e.Condition),this.conditions.includes(e.Condition)||this.conditions.push(e.Condition)}))}get sampleAnnotations(){return this._sampleAnnotations}constructor(t,e,n){this.web=t,this.fb=e,this.dialogRef=n,this.comparison_labels=[],this.comparison_labels_map={},this.columns=[],this.conditions=[],this.form=[]}addComparison(){let t=this.fb.group({condition_A:new A(null,P.required),condition_B:new A(null,P.required),fold_change_col:new A(null,P.required),p_value_col:new A(null,P.required),comparison_label:new A(`comparison_${this.form.length+1}`,P.required),comparison_col:new A(null)});this.form.push(t),t.controls.comparison_col.valueChanges.subscribe(e=>{e&&this.web.getUniqueComparisonLabel(this.comparisonMatrix.file,e).subscribe(n=>{this.comparison_labels_map[e]=n,this.comparison_labels=n})}),t.controls.comparison_label.valueChanges.subscribe(e=>{e||t.controls.comparison_label.setValue("temp_title")})}removeComparison(t){this.form.splice(t,1)}copyComparison(t){let e=this.fb.group({condition_A:new A(t.value.condition_A,P.required),condition_B:new A(t.value.condition_B,P.required),fold_change_col:new A(t.value.fold_change_col,P.required),p_value_col:new A(t.value.p_value_col,P.required),comparison_label:new A(`comparison_${this.form.length+1}`,P.required),comparison_col:new A(t.value.comparison_col)});this.form.push(e),e.controls.comparison_col.valueChanges.subscribe(n=>{n&&this.web.getUniqueComparisonLabel(this.comparisonMatrix.file,n).subscribe(a=>{this.comparison_labels=a})}),e.controls.comparison_label.valueChanges.subscribe(n=>{n||e.controls.comparison_label.setValue("temp_title")})}save(){let t=!0;this.form.forEach(e=>{e.valid||(t=!1)}),t&&this.dialogRef.close(this.form.map(e=>e.value))}cancel(){this.dialogRef.close()}static{this.\u0275fac=function(e){return new(e||i)(G(it),G(Z),G(ct))}}static{this.\u0275cmp=j({type:i,selectors:[["app-analysis-group-comparison-matrix-modal"]],inputs:{comparisonMatrix:"comparisonMatrix",projectFile:"projectFile",sampleAnnotations:"sampleAnnotations"},standalone:!0,features:[$],decls:11,vars:1,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["mat-stretch-tabs","false"],["mat-button","",3,"click"],[3,"label"],[2,"display","flex","flex-direction","column","gap","10px","overflow-y","hidden",3,"formGroup"],["formControlName","condition_A"],[3,"value"],["formControlName","condition_B"],["formControlName","fold_change_col"],["formControlName","p_value_col"],["formControlName","comparison_col"],[2,"display","flex","flex-direction","row","gap","10px"],["mat-icon-button","","color","warn",3,"click"],["formControlName","comparison_label"],["matInput","","type","text","formControlName","comparison_label"]],template:function(e,n){e&1&&(r(0,"h2",0),c(1,"Analysis Group Comparison Matrix"),l(),r(2,"div",1),E(3,vn,3,0,"mat-tab-group",2),l(),r(4,"mat-dialog-actions")(5,"button",3),g("click",function(){return n.addComparison()}),c(6," Add Comparison "),l(),r(7,"button",3),g("click",function(){return n.save()}),c(8," Submit "),l(),r(9,"button",3),g("click",function(){return n.cancel()}),c(10," Close "),l()()),e&2&&(m(3),D(n.form.length>0?3:-1))},dependencies:[mt,pt,vt,wt,z,K,at,W,q,Q,J,et,St,st,tt,rt,$e,He,ut,X],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}"]})}}return i})();var wi=(()=>{class i{constructor(t,e,n,a,s){this.fb=t,this.dialogRef=e,this.web=n,this.ws=a,this.sb=s,this.analysisGroupIDs=[],this.form=this.fb.group({search:new A("",P.required),searchMode:new A("full",P.required),foldChange:new A(.6,P.required),pValue:new A(1.31,P.required)}),this.selectedProjects=[],this.ws.searchWSConnection?.subscribe(u=>{if(u&&u.type==="search_status")switch(u.status){case"complete":this.sb.open(`${location.host}/#/search-session/${u.id}`,"Dismiss",{duration:1e4}),this.dialogRef.close(u.id);break}})}search(){this.form.invalid||(this.selectedProjects.length===0?this.form.value.search&&this.form.value.foldChange&&this.form.value.pValue&&this.form.value.searchMode&&this.web.createSearch(this.analysisGroupIDs,this.form.value.search,this.web.searchSessionID,this.form.value.foldChange,this.form.value.pValue,this.form.value.searchMode).subscribe(t=>{this.sb.open("Search queued","Dismiss",{duration:2e3})}):this.web.getAnalysisGroupsFromProjects(this.selectedProjects).subscribe(t=>{t&&this.form.value.search&&this.form.value.foldChange&&this.form.value.pValue&&this.form.value.searchMode&&this.web.createSearch(t.map(e=>e.id),this.form.value.search,this.web.searchSessionID,this.form.value.foldChange,this.form.value.pValue,this.form.value.searchMode).subscribe(e=>{this.sb.open("Search queued","Dismiss",{duration:2e3})})}))}cancel(){this.dialogRef.close()}handleMultipleProjectSelection(t){this.selectedProjects=t}static{this.\u0275fac=function(e){return new(e||i)(G(Z),G(ct),G(it),G(le),G(ae))}}static{this.\u0275cmp=j({type:i,selectors:[["app-search-modal"]],inputs:{analysisGroupIDs:"analysisGroupIDs"},standalone:!0,features:[$],decls:56,vars:2,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[2,"display","flex","flex-direction","column","gap","1px",3,"formGroup"],["matInput","","formControlName","search","id","search","type","text","placeholder","Search Term"],["formControlName","searchMode"],["value","gene"],["value","uniprot"],["value","pi"],["value","full"],["matInput","","type","number","formControlName","foldChange","placeholder","Log2 Fold Change"],["matInput","","type","number","formControlName","pValue","placeholder","P-Value"],[3,"selectedProjects","multipleSelection"],["mat-button","",3,"click"]],template:function(e,n){e&1&&(r(0,"h2",0),c(1,"Data Search"),l(),r(2,"div",1)(3,"form",2)(4,"mat-form-field"),V(5,"input",3),r(6,"mat-label"),c(7,"Search Term"),l()(),r(8,"p")(9,"b"),c(10,"Search Multiple Terms"),l(),V(11,"br"),c(12," In order to search with multiple terms, enclose each term in single quotes and separate them with "),r(13,"b"),c(14,"OR"),l(),c(15,". "),l(),r(16,"mat-form-field")(17,"mat-select",4)(18,"mat-option",5),c(19,"Gene Name"),l(),r(20,"mat-option",6),c(21,"UniProt Accession ID"),l(),r(22,"mat-option",7),c(23,"Primary IDs"),l(),r(24,"mat-option",8),c(25,"Full Text"),l()(),r(26,"mat-label"),c(27,"Search Mode"),l()(),r(28,"mat-form-field"),V(29,"input",9),r(30,"mat-label"),c(31,"Log2 Fold Change"),l()(),r(32,"mat-form-field"),V(33,"input",10),r(34,"mat-label"),c(35,"-Log10(P-Value)"),l()()(),V(36,"hr"),r(37,"p")(38,"b"),c(39,"Search by currently selected analysis groups or by selected projects below"),l(),V(40,"br"),c(41," By selecting the one or more projects below, the currently selected analysis groups will be ignored. "),l(),r(42,"mat-accordion")(43,"mat-expansion-panel")(44,"mat-expansion-panel-header")(45,"mat-panel-title"),c(46," Filter by Project "),l(),r(47,"mat-panel-description"),c(48," Optional "),l()(),r(49,"app-project-search",11),g("selectedProjects",function(s){return n.handleMultipleProjectSelection(s)}),l()()(),V(50,"hr"),l(),r(51,"mat-dialog-actions")(52,"button",12),g("click",function(){return n.search()}),c(53,"Search"),l(),r(54,"button",12),g("click",function(){return n.cancel()}),c(55,"Close"),l()()),e&2&&(m(3),y("formGroup",n.form),m(46),y("multipleSelection",!0))},dependencies:[mt,pt,tt,rt,et,z,K,at,Se,W,q,Q,J,ut,X,St,st,ie,Jt,te,Zt,ee,Te]})}}return i})();function Fn(i,o){if(i&1&&(r(0,"mat-option",5),c(1),l()),i&2){let t=o.$implicit;y("value",t),m(),L(t)}}function Dn(i,o){if(i&1&&(r(0,"mat-option",5),c(1),l()),i&2){let t=o.$implicit;y("value",t),m(),L(t)}}function An(i,o){if(i&1&&(r(0,"mat-option",5),c(1),l()),i&2){let t=o.$implicit;y("value",t),m(),L(t)}}function En(i,o){if(i&1&&(r(0,"mat-option",5),c(1),l()),i&2){let t=o.$implicit;y("value",t),m(),L(t)}}function Gn(i,o){if(i&1&&(r(0,"mat-option",5),c(1),l()),i&2){let t=o.$implicit;y("value",t),m(),L(t)}}function Tn(i,o){if(i&1&&(r(0,"mat-option",5),c(1),l()),i&2){let t=o.$implicit;y("value",t),m(),L(t)}}function In(i,o){if(i&1&&(r(0,"mat-option",5),c(1),l()),i&2){let t=o.$implicit;y("value",t),m(),L(t)}}function kn(i,o){if(i&1&&(r(0,"mat-form-field")(1,"mat-select",8),T(2,En,2,2,"mat-option",5,N),l(),r(4,"mat-label"),c(5,"Mod Position in Peptide Column"),l()(),r(6,"mat-form-field")(7,"mat-select",9),T(8,Gn,2,2,"mat-option",5,N),l(),r(10,"mat-label"),c(11,"Mod Position in Protein Column"),l()(),r(12,"mat-form-field")(13,"mat-select",10),T(14,Tn,2,2,"mat-option",5,N),l(),r(16,"mat-label"),c(17,"Localization Probability Column"),l()(),r(18,"mat-form-field")(19,"mat-select",11),T(20,In,2,2,"mat-option",5,N),l(),r(22,"mat-label"),c(23,"Peptide Sequence Column"),l()()),i&2){let t=h(3);m(2),I(t.columns),m(6),I(t.columns),m(6),I(t.columns),m(6),I(t.columns)}}function Vn(i,o){if(i&1&&(r(0,"form",3)(1,"mat-form-field")(2,"mat-select",4),T(3,Fn,2,2,"mat-option",5,N),l(),r(5,"mat-label"),c(6,"Primary ID Column"),l()(),r(7,"mat-form-field")(8,"mat-select",6),T(9,Dn,2,2,"mat-option",5,N),l(),r(11,"mat-label"),c(12,"Gene Name Column"),l()(),r(13,"mat-form-field")(14,"mat-select",7),T(15,An,2,2,"mat-option",5,N),l(),r(17,"mat-label"),c(18,"UniProt Accession ID Column"),l()(),E(19,kn,24,0),l()),i&2){let t=h(2);y("formGroup",t.formDFColumn),m(3),I(t.columns),m(6),I(t.columns),m(6),I(t.columns),m(4),D(t.analysisGroupType&&t.analysisGroupType==="ptm"?19:-1)}}function Nn(i,o){if(i&1&&(r(0,"mat-option",5),c(1),l()),i&2){let t=o.$implicit;y("value",t),m(),L(t)}}function Ln(i,o){if(i&1&&(r(0,"mat-option",5),c(1),l()),i&2){let t=o.$implicit;y("value",t),m(),L(t)}}function Pn(i,o){if(i&1&&(r(0,"mat-option",5),c(1),l()),i&2){let t=o.$implicit;y("value",t),m(),L(t)}}function Rn(i,o){if(i&1&&(r(0,"form",3)(1,"mat-form-field")(2,"mat-select",4),T(3,Nn,2,2,"mat-option",5,N),l(),r(5,"mat-label"),c(6,"Primary ID Column"),l()(),r(7,"mat-form-field")(8,"mat-select",6),T(9,Ln,2,2,"mat-option",5,N),l(),r(11,"mat-label"),c(12,"Gene Name Column"),l()(),r(13,"mat-form-field")(14,"mat-select",7),T(15,Pn,2,2,"mat-option",5,N),l(),r(17,"mat-label"),c(18,"UniProt Accession ID Column"),l()()()),i&2){let t=h(2);y("formGroup",t.formSearchedColumn),m(3),I(t.columns),m(6),I(t.columns),m(6),I(t.columns)}}function Bn(i,o){if(i&1&&(r(0,"mat-option",5),c(1),l()),i&2){let t=o.$implicit;y("value",t),m(),L(t)}}function Un(i,o){if(i&1&&(r(0,"mat-option",5),c(1),l()),i&2){let t=o.$implicit;y("value",t),m(),L(t)}}function jn(i,o){if(i&1&&(r(0,"mat-option",5),c(1),l()),i&2){let t=o.$implicit;y("value",t),m(),L(t)}}function Hn(i,o){if(i&1&&(r(0,"mat-option",5),c(1),l()),i&2){let t=o.$implicit;y("value",t),m(),L(t)}}function $n(i,o){if(i&1&&(r(0,"mat-option",5),c(1),l()),i&2){let t=o.$implicit;y("value",t),m(),L(t)}}function On(i,o){if(i&1&&(r(0,"form",3)(1,"mat-form-field")(2,"mat-select",4),T(3,Bn,2,2,"mat-option",5,N),l(),r(5,"mat-label"),c(6,"Primary ID Column"),l()(),r(7,"mat-form-field")(8,"mat-select",6),T(9,Un,2,2,"mat-option",5,N),l(),r(11,"mat-label"),c(12,"Gene Name Column"),l()(),r(13,"mat-form-field")(14,"mat-select",7),T(15,jn,2,2,"mat-option",5,N),l(),r(17,"mat-label"),c(18,"UniProt Accession ID Column"),l()(),r(19,"mat-form-field")(20,"mat-select",12),T(21,Hn,2,2,"mat-option",5,N),l(),r(23,"mat-label"),c(24,"Copy Number Rank Column"),l()(),r(25,"mat-form-field")(26,"mat-select",13),T(27,$n,2,2,"mat-option",5,N),l(),r(29,"mat-label"),c(30,"Copy Number Column"),l()()()),i&2){let t=h(2);y("formGroup",t.formSearchedColumn),m(3),I(t.columns),m(6),I(t.columns),m(6),I(t.columns),m(6),I(t.columns),m(6),I(t.columns)}}function qn(i,o){if(i&1&&E(0,Vn,20,2,"form",3)(1,Rn,19,1,"form",3)(2,On,31,1,"form",3),i&2){let t=h();D(t.file.file_category==="df"?0:t.file.file_category==="searched"?1:t.file.file_category==="copy_number"?2:-1)}}var vi=(()=>{class i{set file(t){this._file=t,t.extra_data&&(t.file_category==="df"?(this.formDFColumn.controls.primary_id_col.setValue(t.extra_data.primary_id_col),this.formDFColumn.controls.gene_name_col.setValue(t.extra_data.gene_name_col),this.formDFColumn.controls.uniprot_id_col.setValue(t.extra_data.uniprot_id_col),this.formDFColumn.controls.peptide_seq_col.setValue(t.extra_data.peptide_seq_col),this.formDFColumn.controls.modification_position_in_peptide_col.setValue(t.extra_data.modification_position_in_peptide_col),this.formDFColumn.controls.modification_position_in_protein_col.setValue(t.extra_data.modification_position_in_protein_col),this.formDFColumn.controls.localization_prob_col.setValue(t.extra_data.localization_prob_col)):t.file_category==="searched"?(this.formSearchedColumn.controls.primary_id_col.setValue(t.extra_data.primary_id_col),this.formSearchedColumn.controls.gene_name_col.setValue(t.extra_data.gene_name_col),this.formSearchedColumn.controls.uniprot_id_col.setValue(t.extra_data.uniprot_id_col)):t.file_category==="copy_number"&&(this.formCopyNumberColumn.controls.primary_id_col.setValue(t.extra_data.primary_id_col),this.formCopyNumberColumn.controls.gene_name_col.setValue(t.extra_data.gene_name_col),this.formCopyNumberColumn.controls.uniprot_id_col.setValue(t.extra_data.uniprot_id_col),this.formCopyNumberColumn.controls.rank_col.setValue(t.extra_data.rank_col),this.formCopyNumberColumn.controls.copy_number_col.setValue(t.extra_data.copy_number_col))),this.web.getProjectFileColumns(t.id).subscribe(e=>{this.columns=e})}get file(){return this._file}constructor(t,e,n){this.fb=t,this.matDialogRef=e,this.web=n,this._file=void 0,this.analysisGroupType=void 0,this.formDFColumn=this.fb.group({primary_id_col:new A("",P.required),gene_name_col:new A(""),uniprot_id_col:new A(""),peptide_seq_col:new A(""),modification_position_in_peptide_col:new A(""),modification_position_in_protein_col:new A(""),localization_prob_col:new A("")}),this.formSearchedColumn=this.fb.group({primary_id_col:new A("",P.required),gene_name_col:new A(""),uniprot_id_col:new A("")}),this.formCopyNumberColumn=this.fb.group({primary_id_col:new A("",P.required),gene_name_col:new A(""),uniprot_id_col:new A(""),rank_col:new A(""),copy_number_col:new A("")}),this.columns=[]}save(){let t={file_category:this.file.file_category,extra_data:{}};this.file.file_category==="df"?(this.formDFColumn.controls.uniprot_id_col.value&&(t.extra_data.uniprot_id_col=this.formDFColumn.controls.uniprot_id_col.value),this.formDFColumn.controls.primary_id_col.value&&(t.extra_data.primary_id_col=this.formDFColumn.controls.primary_id_col.value),this.formDFColumn.controls.gene_name_col.value&&(t.extra_data.gene_name_col=this.formDFColumn.controls.gene_name_col.value),this.formDFColumn.controls.modification_position_in_peptide_col.value&&(t.extra_data.modification_position_in_peptide_col=this.formDFColumn.controls.modification_position_in_peptide_col.value),this.formDFColumn.controls.modification_position_in_protein_col.value&&(t.extra_data.modification_position_in_protein_col=this.formDFColumn.controls.modification_position_in_protein_col.value),this.formDFColumn.controls.localization_prob_col.value&&(t.extra_data.localization_prob_col=this.formDFColumn.controls.localization_prob_col.value),this.formDFColumn.controls.peptide_seq_col.value&&(t.extra_data.peptide_seq_col=this.formDFColumn.controls.peptide_seq_col.value)):this.file.file_category==="searched"&&(this.formSearchedColumn.controls.uniprot_id_col.value&&(t.extra_data.uniprot_id_col=this.formSearchedColumn.controls.uniprot_id_col.value),this.formSearchedColumn.controls.primary_id_col.value&&(t.extra_data.primary_id_col=this.formSearchedColumn.controls.primary_id_col.value),this.formSearchedColumn.controls.gene_name_col.value&&(t.extra_data.gene_name_col=this.formSearchedColumn.controls.gene_name_col.value)),this.matDialogRef.close(t)}cancel(){this.matDialogRef.close()}static{this.\u0275fac=function(e){return new(e||i)(G(Z),G(ct),G(it))}}static{this.\u0275cmp=j({type:i,selectors:[["app-file-extra-data-modal"]],inputs:{analysisGroupType:"analysisGroupType",file:"file"},standalone:!0,features:[$],decls:9,vars:1,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["mat-button","",3,"click"],[2,"display","flex","flex-direction","column","gap","10px",3,"formGroup"],["formControlName","primary_id_col"],[3,"value"],["formControlName","gene_name_col"],["formControlName","uniprot_id_col"],["formControlName","modification_position_in_peptide_col"],["formControlName","modification_position_in_protein_col"],["formControlName","localization_prob_col"],["formControlName","peptide_seq_col"],["formControlName","rank_col"],["formControlName","copy_number_col"]],template:function(e,n){e&1&&(r(0,"h2",0),c(1,"File Extra Data"),l(),r(2,"div",1),E(3,qn,3,1),l(),r(4,"mat-dialog-actions")(5,"button",2),g("click",function(){return n.save()}),c(6,"Submit"),l(),r(7,"button",2),g("click",function(){return n.cancel()}),c(8,"Close"),l()()),e&2&&(m(3),D(n.file?3:-1))},dependencies:[mt,pt,z,K,W,q,Q,J,tt,st,St,et,ut,X]})}}return i})();var zn=Ai(Ei());fe.plotlyjs=zn;var Si=(()=>{class i{set curtainData(t){this._curtainData=t,this.drawVolcanoPlot()}get curtainData(){return this._curtainData}constructor(t,e){this.accounts=t,this.graph=e,this.selected=new ot,this._curtainData=void 0,this.graphData=[],this.graphLayout={height:700,width:700,margin:{r:null,l:null,b:null,t:null},xaxis:{title:"<b>Log2FC</b>",tickmode:"linear",ticklen:5,showgrid:!1,visible:!0,tickfont:{size:14,color:"black"}},yaxis:{title:"<b>-log10(p-value)</b>",tickmode:"linear",ticklen:5,showgrid:!1,visible:!0,showticklabels:!0,zeroline:!0,tickfont:{size:14,color:"black"}},annotations:[],showlegend:!0,legend:{orientation:"h"},title:{text:"",font:{size:24,family:"Arial, sans-serif",color:"black"}}},this.revision=0,this.config={toImageButtonOptions:{format:"svg",filename:this.graphLayout.title.text,height:this.graphLayout.height,width:this.graphLayout.width,scale:1}},this.colorMap={},this.graph.redrawTrigger.subscribe(()=>{this.drawVolcanoPlot()})}drawVolcanoPlot(){if(!this.curtainData&&!this.curtainData.settings)return;console.log(this.curtainData),this.graphLayout.title.text=this.curtainData.settings.title,this.colorMap=this.curtainData.settings.colorMap;let t=Object.keys(this.colorMap),e=this.curtainData.data.filter(b=>b["Fold Change"]!==null&&b["Fold Change"]!==void 0&&!isNaN(b["Fold Change"])),n=this.curtainData.data.filter(b=>b["P-value"]!==null&&b["P-value"]!==void 0&&!isNaN(b["P-value"])),a=Math.min(...e.map(b=>b["Fold Change"])),s=Math.max(...e.map(b=>b["Fold Change"])),u=0,d=Math.max(...n.map(b=>b["P-value"]));this.graphLayout.xaxis.range=[a-.5,s+.5],this.graphLayout.yaxis.range=[u,d-u*.5];let f=this.curtainData.settings.volcanoAxis;f.minX&&(this.graphLayout.xaxis.range[0]=f.minX),f.maxX&&(this.graphLayout.xaxis.range[1]=f.maxX),f.minY&&(this.graphLayout.yaxis.range[0]=f.minY),f.maxY&&(this.graphLayout.yaxis.range[1]=f.maxY),f.x&&(this.graphLayout.xaxis.title=`<b>${f.x}</b>`),f.y&&(this.graphLayout.yaxis.title=`<b>${f.y}</b>`);let C={};C.Background={x:[],y:[],mode:"markers",type:"scatter",name:"Background",text:[],data:[],marker:{size:this.curtainData.settings.scatterPlotMarkerSize,color:"#a4a2a2",opacity:.3}};for(let b of this.curtainData.selections)C[b]={x:[],y:[],mode:"markers",type:"scattergl",name:b,text:[],data:[],marker:{size:this.curtainData.settings.scatterPlotMarkerSize,color:this.curtainData.settings.colorMap[b]}};this.curtainData.data.forEach(b=>{if(b["Primary ID"]in this.curtainData.selection_map){let O=this.curtainData.selection_map[b["Primary ID"]];for(let U of this.curtainData.selections)O[U]&&(C[U].x.push(b["Fold Change"]),C[U].y.push(b["P-value"]),C[U].text.push(`${b["Gene Names"]}(${b["Primary ID"]})`),C[U].data.push(b))}else if(this.curtainData.settings.backGroundColorGrey)C.Background.x.push(b["Fold Change"]),C.Background.y.push(b["P-value"]),C.Background.text.push(`${b["Gene Names"]}(${b["Primary ID"]})`),C.Background.data.push(b);else{let O=this.significantGroup(b["Fold Change"],b["P-value"]),U=t.find(Y=>Y.startsWith(`${O[0]} (${b.Comparison})`));U&&(C[U]||(C[U]={x:[],y:[],mode:"markers",type:"scatter",name:U,text:[],data:[],marker:{size:this.curtainData.settings.scatterPlotMarkerSize,color:this.curtainData.settings.colorMap[U]}}),C[U].x.push(b["Fold Change"]),C[U].y.push(b["P-value"]),C[U].text.push(`${b["Gene Names"]}(${b["Primary ID"]})`),C[U].data.push(b))}}),this.graphData=[];for(let b in C)this.graphData.push(C[b]);this.graphData=this.graphData.reverse();let _=[];_.push({type:"line",x0:-this.curtainData.settings.log2FCCutoff,y0:0,x1:-this.curtainData.settings.log2FCCutoff,y1:this.graphLayout.yaxis.range[1],line:{color:"rgb(21,4,4)",width:1,dash:"dot"}}),_.push({type:"line",x0:this.curtainData.settings.log2FCCutoff,x1:this.curtainData.settings.log2FCCutoff,y0:0,y1:this.graphLayout.yaxis.range[1],line:{color:"rgb(21,4,4)",width:1,dash:"dot"}});let x=this.graphLayout.xaxis.range[0]-1;this.curtainData.settings.volcanoAxis.minX&&(x=this.curtainData.settings.volcanoAxis.minX-1);let M=this.graphLayout.xaxis.range[1]+1;if(this.curtainData.settings.volcanoAxis.maxX&&(M=this.curtainData.settings.volcanoAxis.maxX+1),_.push({type:"line",x0:x,x1:M,y0:-Math.log10(this.curtainData.settings.pCutoff),y1:-Math.log10(this.curtainData.settings.pCutoff),line:{color:"rgb(21,4,4)",width:1,dash:"dot"}}),this.graphLayout.shapes=_,this.curtainData.settings.volcanoPlotGrid&&(this.graphLayout.yaxis.showgrid=this.curtainData.settings.volcanoPlotGrid.y,this.graphLayout.xaxis.showgrid=this.curtainData.settings.volcanoPlotGrid.x),this.curtainData.settings.volcanoPlotDimension&&(this.curtainData.settings.volcanoPlotDimension.height&&(this.graphLayout.height=this.curtainData.settings.volcanoPlotDimension.height),this.curtainData.settings.volcanoPlotDimension.width&&(this.graphLayout.width=this.curtainData.settings.volcanoPlotDimension.width),this.curtainData.settings.volcanoPlotDimension.margin))for(let b in this.curtainData.settings.volcanoPlotDimension.margin)this.curtainData.settings.volcanoPlotDimension.margin[b]&&(this.graphLayout.margin[b]=this.curtainData.settings.volcanoPlotDimension.margin[b]);if(this.curtainData.settings.volcanoPlotYaxisPosition&&(this.curtainData.settings.volcanoPlotYaxisPosition.includes("left")&&this.graphLayout.shapes.push({type:"line",x0:this.graphLayout.xaxis.range[0],x1:this.graphLayout.xaxis.range[0],y0:this.graphLayout.yaxis.range[0],y1:this.graphLayout.yaxis.range[1],line:{color:"rgb(21,4,4)",width:1}}),this.curtainData.settings.volcanoPlotYaxisPosition.includes("middle")?this.graphLayout.xaxis.zerolinecolor="#000000":this.graphLayout.xaxis.zerolinecolor="#ffffff"),this.graphLayout.annotations=[],this.curtainData.settings.textAnnotation)for(let b in this.curtainData.settings.textAnnotation)this.curtainData.settings.textAnnotation[b].data.showannotation===!0&&this.graphLayout.annotations.push(this.curtainData.settings.textAnnotation[b].data);this.config={toImageButtonOptions:{format:"svg",filename:this.graphLayout.title.text,height:this.graphLayout.height,width:this.graphLayout.width,scale:1,margin:this.graphLayout.margin}};let F=document.getElementsByTagName("body")[0],R=window.getComputedStyle(F).backgroundColor;if(this.accounts.userAccount.darkMode){this.graphLayout.plot_bgcolor=R,this.graphLayout.paper_bgcolor=R,this.graphLayout.font={color:"white",size:14},this.graphLayout.xaxis.tickfont.color="white",this.graphLayout.yaxis.tickfont.color="white";for(let b of this.graphLayout.shapes)b.line.color="white";this.graphLayout.yaxis.showgrid&&(this.graphLayout.yaxis.gridcolor="white"),this.graphLayout.xaxis.showgrid&&(this.graphLayout.xaxis.gridcolor="white");for(let b of this.graphLayout.annotations)b.font.color="white",b.arrowcolor="white"}else this.graphLayout.plot_bgcolor="#FFFFFF",this.graphLayout.paper_bgcolor="#FFFFFF",this.graphLayout.font={color:"black",size:14};if(this.curtainData.settings.volcanoAdditionalShapes)for(let b of this.curtainData.settings.volcanoAdditionalShapes)this.graphLayout.shapes.push(b);this.revision+=1,console.log("cutoff",_),console.log(this.graphData)}significantGroup(t,e){let n=-Math.log10(this.curtainData.settings.pCutoff),a=[],s="";return n>e?(a.push("P-value > "+this.curtainData.settings.pCutoff),s="P-value > "):(a.push("P-value <= "+this.curtainData.settings.pCutoff),s="P-value <= "),Math.abs(t)>this.curtainData.settings.log2FCCutoff?(a.push("FC > "+this.curtainData.settings.log2FCCutoff),s+="FC > "):(a.push("FC <= "+this.curtainData.settings.log2FCCutoff),s+="FC <= "),[a.join(";"),s]}selectData(t){if("points"in t){let e=[];for(let n of t.points)e.push(n.data.data[n.pointIndex]);this.selected.emit(e)}}static{this.\u0275fac=function(e){return new(e||i)(G(re),G(qe))}}static{this.\u0275cmp=j({type:i,selectors:[["app-volcano-plot"]],inputs:{curtainData:"curtainData"},outputs:{selected:"selected"},standalone:!0,features:[$],decls:1,vars:5,consts:[[3,"selected","plotlyClick","data","config","layout","revision","updateOnlyWithRevision"]],template:function(e,n){e&1&&(r(0,"plotly-plot",0),g("selected",function(s){return n.selectData(s)})("plotlyClick",function(s){return n.selectData(s)}),l()),e&2&&y("data",n.graphData)("config",n.config)("layout",n.graphLayout)("revision",n.revision)("updateOnlyWithRevision",!0)},dependencies:[fe,Oe]})}}return i})();var ue=class{constructor(o){this.sourceFiles=o,this.metadata=o.map(t=>t.metadata_columns).flat()}getAllUniqueColumnPositionsSorted(){return[...new Set(this.metadata.map(o=>o.column_position))].sort()}getColumnsByPosition(o){return this.metadata.filter(t=>t.column_position===o)}composeTable(){let o=[],t=this.getAllUniqueColumnPositionsSorted(),e={};for(let n of this.sourceFiles){let a=[n.name];for(let s of t){let u=n.metadata_columns.find(d=>d.column_position===s);u?.value?a.push(u.value):a.push(""),u&&(e[s]=`${u.type.toLowerCase()}[${u.name.toLowerCase()}]`)}o.push(a)}return o.unshift(["source name",...t.map(n=>e[n])]),o}convertToTSV(){return this.composeTable().map(t=>t.join("	")).join(`
`)}};function Yn(i,o){if(i&1&&(r(0,"mat-option",8),c(1),l()),i&2){let t=o.$implicit;y("value",t),m(),H(" ",t," ")}}function Xn(i,o){if(i&1&&T(0,Yn,2,2,"mat-option",8,N),i&2){let t=h();I(t.metadataCharacteristics)}}function Wn(i,o){if(i&1&&(r(0,"mat-option",8),c(1),l()),i&2){let t=o.$implicit;y("value",t),m(),H(" ",t," ")}}function Qn(i,o){if(i&1&&T(0,Wn,2,2,"mat-option",8,N),i&2){let t=h();I(t.metadataComment)}}function Jn(i,o){if(i&1&&(r(0,"mat-option",8),c(1),l()),i&2){let t=o.$implicit;y("value",t),m(),H(" ",t," ")}}function Zn(i,o){if(i&1&&T(0,Jn,2,2,"mat-option",8,N),i&2){let t=h();I(t.metadataNameAutocomplete)}}function to(i,o){if(i&1&&(r(0,"mat-option",8),c(1),l()),i&2){let t=o.$implicit,e=h(3);y("value",e.displayData(t)),m(),H(" ",e.displayData(t)," ")}}function eo(i,o){if(i&1&&(r(0,"mat-form-field"),V(1,"input",12),r(2,"mat-label"),c(3,"Metadata Value"),l()(),r(4,"mat-autocomplete",null,2),T(6,to,2,2,"mat-option",8,N),Lt(8,"async"),l()),i&2){let t=lt(5),e=h(2);m(),y("matAutocomplete",t),m(5),I(Pt(8,1,e.filteredResults))}}function io(i,o){i&1&&(r(0,"mat-form-field"),V(1,"textarea",13),r(2,"mat-label"),c(3,"Metadata Value"),l()())}function no(i,o){if(i&1&&E(0,eo,9,3)(1,io,4,0,"mat-form-field"),i&2){let t=h();D(t.metadataNameAutocomplete.includes(t.form.value.metadataName)?0:1)}}function oo(i,o){if(i&1&&(r(0,"mat-option",8),c(1),l()),i&2){let t=o.$implicit;y("value",t),m(),H(" ",t," ")}}var ye=(()=>{class i{set metadataType(t){this.form.controls.metadataType.setValue(t)}set metadataName(t){this.form.controls.metadataName.setValue(t)}constructor(t,e,n){this.dialog=t,this.fb=e,this.web=n,this.metadataTypeAutocomplete=["Characteristics","Comment","Factor value","Material type","Assay name","Technology type"],this.metadataNameAutocomplete=["Disease","Tissue","Subcellular location","Organism"],this.metadataCharacteristics=["Disease","Tissue","Subcellular location","Organism","Cell type","Cell line","Developmental stage","Ancestry category","Sex","Age","Biological replicate"],this.metadataComment=["Data file","File uri","Technical replicate","Fraction identifier","Label","Cleavage agent details","Instrument","Modification parameters","Dissociation method","Precursor mass tolerance","Fragment mass tolerance",""],this.form=this.fb.group({metadataType:"Characteristics",metadataName:"Tissue",metadataValue:""}),this.filteredResults=bt([]),this.readonlyType=!1,this.readonlyName=!1}ngOnInit(){this.filteredResults=this.form.controls.metadataValue.valueChanges.pipe(ge(""),xe(t=>t?t.length>=2:!1),be(t=>t?this.form.controls.metadataName.value?.toLowerCase()==="subcellular location"?this.web.getSubcellularLocations(void 0,5,0,t).pipe(ft(e=>e.results)):this.form.controls.metadataName.value?.toLowerCase()==="disease"?this.web.getHumandDiseases(void 0,5,0,t).pipe(ft(e=>e.results)):this.form.controls.metadataName.value?.toLowerCase()==="tissue"?this.web.getTissues(void 0,5,0,t).pipe(ft(e=>e.results)):this.form.controls.metadataName.value?.toLowerCase()==="organism"?this.web.getSpecies(void 0,5,0,t).pipe(ft(e=>e.results)):bt([]):bt([])))}close(){this.dialog.close()}submit(){this.dialog.close(this.form.value)}displayData(t){return t?"identifier"in t?t.identifier:"official_name"in t?t.official_name:t.location_identifier:""}static{this.\u0275fac=function(e){return new(e||i)(G(ct),G(Z),G(it))}}static{this.\u0275cmp=j({type:i,selectors:[["app-analysis-group-metadata-creation-dialog"]],inputs:{readonlyType:"readonlyType",readonlyName:"readonlyName",metadataType:"metadataType",metadataName:"metadataName"},standalone:!0,features:[$],decls:27,vars:8,consts:[["autoMetadataName","matAutocomplete"],["autoMetadataType","matAutocomplete"],["autoMetadataValue","matAutocomplete"],["mat-dialog-title",""],["mat-dialog-content",""],[2,"display","flex","flex-direction","column","gap","20px",3,"formGroup"],["matInput","","formControlName","metadataName",3,"matAutocomplete","readonly"],["matInput","","formControlName","metadataType",3,"matAutocomplete","readonly"],[3,"value"],["mat-dialog-actions",""],["mat-button","",3,"click"],["mat-button","",3,"click","disabled"],["matInput","","formControlName","metadataValue",3,"matAutocomplete"],["matInput","","formControlName","metadataValue"]],template:function(e,n){if(e&1){let a=B();r(0,"h1",3),c(1,"Adding New Metadata"),l(),r(2,"div",4)(3,"form",5)(4,"mat-form-field"),V(5,"input",6),r(6,"mat-label"),c(7,"Metadata Name"),l(),r(8,"mat-autocomplete",null,0),E(10,Xn,2,0)(11,Qn,2,0)(12,Zn,2,0),l()(),E(13,no,2,1),r(14,"mat-form-field"),V(15,"input",7),r(16,"mat-label"),c(17,"Metadata Type"),l(),r(18,"mat-autocomplete",null,1),T(20,oo,2,2,"mat-option",8,N),l()()()(),r(22,"div",9)(23,"button",10),g("click",function(){return v(a),S(n.close())}),c(24,"Cancel"),l(),r(25,"button",11),g("click",function(){return v(a),S(n.submit())}),c(26,"Submit"),l()()}if(e&2){let a=lt(9),s=lt(19);m(3),y("formGroup",n.form),m(2),y("matAutocomplete",a)("readonly",n.readonlyName),m(5),D(n.form.value.metadataType==="Characteristics"?10:n.form.value.metadataType==="Comment"?11:12),m(3),D(n.form.value.metadataName?13:-1),m(2),y("matAutocomplete",s)("readonly",n.readonlyType),m(5),I(n.metadataTypeAutocomplete),m(5),y("disabled",!n.form.valid)}},dependencies:[mt,pt,z,K,at,W,q,Q,J,Yt,ne,st,et,rt,oe,X,ut,tt]})}}return i})();var Mi=(()=>{class i{constructor(t,e){this.dialog=t,this.fb=e,this.form=this.fb.group({name:["",P.required],description:[""]})}close(){this.dialog.close()}submit(){this.form.invalid||this.dialog.close(this.form.value)}static{this.\u0275fac=function(e){return new(e||i)(G(ct),G(Z))}}static{this.\u0275cmp=j({type:i,selectors:[["app-analysis-group-sample-file"]],standalone:!0,features:[$],decls:17,vars:1,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[2,"display","flex","flex-direction","column","gap","20px",3,"formGroup"],["matInput","","formControlName","name"],["matInput","","formControlName","description"],["mat-dialog-actions",""],["mat-button","",3,"click"]],template:function(e,n){e&1&&(r(0,"h1",0),c(1,"Adding Sample File"),l(),r(2,"div",1)(3,"form",2)(4,"mat-form-field"),V(5,"input",3),r(6,"mat-label"),c(7,"Sample Name"),l()(),r(8,"mat-form-field"),V(9,"textarea",4),r(10,"mat-label"),c(11,"Sample Description"),l()()()(),r(12,"div",5)(13,"button",6),g("click",function(){return n.close()}),c(14,"Cancel"),l(),r(15,"button",6),g("click",function(){return n.submit()}),c(16,"Submit"),l()()),e&2&&(m(3),y("formGroup",n.form))},dependencies:[mt,pt,ut,X,z,K,at,W,q,Q,J,et,tt,rt]})}}return i})();var de=(i,o)=>o.id;function ao(i,o){i&1&&c(0,"(value modified)")}function ro(i,o){if(i&1&&(r(0,"mat-option",14),c(1),l()),i&2){let t=o.$implicit,e=h(3);y("value",e.displayData(t)),m(),H(" ",e.displayData(t)," ")}}function lo(i,o){if(i&1){let t=B();r(0,"button",16),g("click",function(){v(t);let n=h(2).$implicit,a=h();return a.metadataDeleted.emit(n),S(a.markedForDeletion.push(n))}),r(1,"mat-icon"),c(2,"delete"),l()()}if(i&2){let t=h(3);y("disabled",!t.canEdit)("matTooltip","Mark for deletion")}}function so(i,o){if(i&1){let t=B();r(0,"button",16),g("click",function(){v(t);let n=h(2).$implicit,a=h();return S(a.undoDeletion(n))}),r(1,"mat-icon"),c(2,"undo"),l()()}if(i&2){let t=h(3);y("disabled",!t.canEdit)("matTooltip","Undo deletion mark")}}function co(i,o){if(i&1&&(r(0,"form",11)(1,"mat-form-field",12)(2,"textarea",13),c(3,`
            `),l(),r(4,"mat-label"),c(5),l(),r(6,"mat-hint"),E(7,ao,1,0),l()(),r(8,"mat-autocomplete",null,1),T(10,ro,2,2,"mat-option",14,N),Lt(12,"async"),l(),E(13,lo,3,2,"button",15)(14,so,3,2,"button",15),l()),i&2){let t=lt(9),e=h().$implicit,n=h();y("formGroup",n.metadataFormMap[e.id]),m(2),y("readonly",!n.canEdit)("disabled",n.markedForDeletion.includes(e))("matAutocomplete",t),m(3),L(e.name),m(2),D(n.metadataFormMap[e.id].dirty?7:-1),m(3),I(Pt(12,7,n.autoCompleteMap[e.id])),m(3),D(n.markedForDeletion.includes(e)?14:13)}}function mo(i,o){if(i&1&&E(0,co,15,9,"form",11),i&2){let t=o.$implicit,e=h();D(e.metadataFormMap[t.id]?0:-1)}}function po(i,o){if(i&1&&(r(0,"form",17)(1,"mat-form-field",21),V(2,"input",22),r(3,"mat-label"),c(4,"Source File Sample Name"),l()(),r(5,"mat-form-field",21),V(6,"textarea",23),r(7,"mat-label"),c(8,"Source File Sample Description"),l()()()),i&2){let t=h().$implicit,e=h(2);y("formGroup",e.sourcefileFormMap[t.id])}}function uo(i,o){if(i&1){let t=B();r(0,"button",24),g("click",function(){v(t);let n=h().$implicit,a=h(2);return S(a.removeSampleFile(n.id))}),r(1,"mat-icon"),c(2,"delete"),l()()}if(i&2){let t=h(3);y("disabled",!t.canEdit)("matTooltip","Remove this source file")}}function _o(i,o){i&1&&c(0,"(value modified)")}function fo(i,o){i&1&&(r(0,"mat-icon"),c(1,"delete"),l())}function ho(i,o){i&1&&(r(0,"mat-icon"),c(1,"undo"),l())}function Co(i,o){if(i&1&&(r(0,"mat-option",14),c(1),l()),i&2){let t=o.$implicit,e=h(5);y("value",e.displayData(t)),m(),H(" ",e.displayData(t)," ")}}function yo(i,o){if(i&1){let t=B();r(0,"form",25)(1,"mat-form-field",21),V(2,"input",26),r(3,"mat-label"),c(4),l(),r(5,"mat-hint"),c(6),E(7,_o,1,0),l(),r(8,"button",27),g("click",function(){v(t);let n=h().$implicit,a=h(3);return S(a.markForDeleteOrUndo(n))}),E(9,fo,2,0,"mat-icon")(10,ho,2,0,"mat-icon"),l(),r(11,"mat-autocomplete",null,3),T(13,Co,2,2,"mat-option",14,N),Lt(15,"async"),l()(),r(16,"button",28)(17,"mat-icon"),c(18,"drag_handle"),l()()()}if(i&2){let t=lt(12),e=h().$implicit,n=h(3);y("formGroup",n.metadataFormMap[e.id])("cdkDragData",e),m(2),y("matAutocomplete",t),m(2),L(e.name),m(2),H("",e.type," "),m(),D(n.metadataFormMap[e.id].dirty?7:-1),m(2),D(n.metadataFormMap[e.id].controls.value.disabled?10:9),m(4),I(Pt(15,7,n.autoCompleteMap[e.id]))}}function xo(i,o){if(i&1&&E(0,yo,19,9,"form",25),i&2){let t=o.$implicit,e=h(3);D(e.metadataFormMap[t.id]?0:-1)}}function go(i,o){}function bo(i,o){if(i&1){let t=B();r(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title"),c(3),l(),r(4,"mat-panel-description"),c(5),l()(),r(6,"div",4)(7,"mat-menu",null,2)(9,"button",9),g("click",function(){let n=v(t).$implicit,a=h(2);return S(a.createMetadataFileSpecific("disease",n.id))}),c(10,"Disease"),l(),r(11,"button",9),g("click",function(){let n=v(t).$implicit,a=h(2);return S(a.createMetadataFileSpecific("tissue",n.id))}),c(12,"Tissue"),l(),r(13,"button",9),g("click",function(){let n=v(t).$implicit,a=h(2);return S(a.createMetadataFileSpecific("subcellular location",n.id))}),c(14,"Subcellular location"),l(),r(15,"button",9),g("click",function(){let n=v(t).$implicit,a=h(2);return S(a.createMetadataFileSpecific("organism",n.id))}),c(16,"Organism"),l(),r(17,"button",9),g("click",function(){let n=v(t).$implicit,a=h(2);return S(a.createMetadataFileSpecific(null,n.id))}),c(18,"Create custom metadata field"),l()(),r(19,"div",5),E(20,po,9,1,"form",17),r(21,"div",12)(22,"div",5)(23,"button",18)(24,"mat-icon"),c(25,"add"),l()(),E(26,uo,3,2,"button",19),l(),r(27,"h5"),c(28,"Metadata Annotation"),l(),r(29,"div",20),g("cdkDropListDropped",function(n){let a=v(t).$implicit,s=h(2);return S(s.drop(n,a))}),T(30,xo,1,1,null,null,de),l()()()(),r(32,"div",4),T(33,go,0,0,null,null,de),l()()}if(i&2){let t=o.$implicit,e=lt(8),n=h(2);m(3),H(" ",t.name," "),m(2),H(" ",t.description," "),m(15),D(n.sourcefileFormMap[t.id]?20:-1),m(3),y("disabled",!n.canEdit)("matTooltip","Add new metadata annotation")("matMenuTriggerFor",e),m(3),D(n.canEdit?26:-1),m(4),I(t.metadata_columns),m(3),I(t.metadata_columns)}}function wo(i,o){if(i&1&&(r(0,"mat-accordion",10),T(1,bo,35,7,"mat-expansion-panel",null,de),l()),i&2){let t=h();m(),I(t.sourceFiles)}}var Fi=(()=>{class i{set metadata(t){this._metadata=t.filter(e=>!e.source_file);for(let e of this._metadata)this.metadataFormMap[e.id]=this.fb.group({value:[e.value],name:[e.name],type:[e.type]}),this.metadataFormMap[e.id].valueChanges.subscribe(n=>{n.value&&this.updateValueField(e,n.value)})}get metadata(){return this._metadata}set sourceFiles(t){this._sourceFiles=t,this.sourceFileMap={};for(let e of t){this.sourceFileMap[e.id]=e,this.sourcefileFormMap[e.id]=this.fb.group({name:[e.name],description:[e.description]});for(let n of e.metadata_columns)this.metadataFormMap[n.id]=this.fb.group({value:[n.value],name:[n.name],type:[n.type]}),this.metadataFormMap[n.id].valueChanges.subscribe(a=>{a.value&&this.updateValueField(n,a.value)})}}get sourceFiles(){return this._sourceFiles}constructor(t,e,n){this.web=t,this.dialog=e,this.fb=n,this.displayedColumns=["metadataType","metadataName","metadataValue"],this.analysis_group_id=0,this._metadata=[],this.metadataFormMap={},this.sourcefileFormMap={},this._sourceFiles=[],this.metadataChange=new ot,this.metadataDeleted=new ot,this.sourceFilesChanged=new ot,this.sourceFileMetadataDeleted=new ot,this.reorderMetadataSourceFiles=new ot,this.markedForDeletion=[],this.canEdit=!1,this.autoCompleteMap={},this.sourceFileMap={}}updateValueField(t,e){if(this.autoCompleteMap[t.id]||(this.autoCompleteMap[t.id]=bt([])),e.length<2){this.autoCompleteMap[t.id]=bt([]);return}t.name.toLowerCase()==="subcellular location"?this.autoCompleteMap[t.id]=this.web.getSubcellularLocations(void 0,5,0,e).pipe(ft(n=>n.results)):t.name.toLowerCase()==="disease"?this.autoCompleteMap[t.id]=this.web.getHumandDiseases(void 0,5,0,e).pipe(ft(n=>n.results)):t.name.toLowerCase()==="tissue"?this.autoCompleteMap[t.id]=this.web.getTissues(void 0,5,0,e).pipe(ft(n=>n.results)):t.name.toLowerCase()==="organism"?this.autoCompleteMap[t.id]=this.web.getSpecies(void 0,5,0,e).pipe(ft(n=>n.results)):this.autoCompleteMap[t.id]=bt([])}ngOnInit(){}createMetadata(t=null){let e=this.dialog.open(ye);if(t)switch(e.componentInstance.readonlyType=!0,e.componentInstance.readonlyName=!0,t){case"subcellular location":e.componentInstance.metadataName="Subcellular location",e.componentInstance.metadataType="Characteristics";break;case"disease":e.componentInstance.metadataName="Disease",e.componentInstance.metadataType="Characteristics";break;case"tissue":e.componentInstance.metadataName="Tissue",e.componentInstance.metadataType="Characteristics";break;case"organism":e.componentInstance.metadataName="Organism",e.componentInstance.metadataType="Characteristics";break}e.afterClosed().subscribe(n=>{n&&this.web.createMetaDataColumn(this.analysis_group_id,n).subscribe(a=>{this.metadata.push(...a),this.metadataChange.emit(this.metadata);for(let s of a)this.metadataFormMap[s.id]=this.fb.group({value:[s.value],name:[s.name],type:[s.type]}),this.metadataFormMap[s.id].valueChanges.subscribe(u=>{u.value&&this.updateValueField(s,u.value)})})})}undoDeletion(t){this.markedForDeletion=this.markedForDeletion.filter(e=>e!==t),this.metadataDeleted.emit(t)}displayData(t){return t?"identifier"in t?t.identifier:"official_name"in t?t.official_name:t.location_identifier:""}addSampleFile(){this.dialog.open(Mi).afterClosed().subscribe(e=>{e&&e.name&&this.web.createSourceFile(this.analysis_group_id,e.name,e.description).subscribe(n=>{this.sourceFiles.push(n),this.sourcefileFormMap[n.id]=this.fb.group({name:[n.name],description:[n.description]}),this.sourceFilesChanged.emit(this.sourceFiles)})})}removeSampleFile(t){this.dialog.open(Rt).afterClosed().subscribe(n=>{n&&this.web.deleteSourceFile(t).subscribe(()=>{this.sourceFiles=this.sourceFiles.filter(a=>a.id!==t),this.sourceFilesChanged.emit(this.sourceFiles)})})}createMetadataFileSpecific(t=null,e){let n=this.dialog.open(ye);if(t)switch(n.componentInstance.readonlyType=!0,n.componentInstance.readonlyName=!0,t){case"subcellular location":n.componentInstance.metadataName="Subcellular location",n.componentInstance.metadataType="Characteristics";break;case"disease":n.componentInstance.metadataName="Disease",n.componentInstance.metadataType="Characteristics";break;case"tissue":n.componentInstance.metadataName="Tissue",n.componentInstance.metadataType="Characteristics";break;case"organism":n.componentInstance.metadataName="Organism",n.componentInstance.metadataType="Characteristics";break}n.afterClosed().subscribe(a=>{a&&this.web.createMetaDataColumn(this.analysis_group_id,a,e).subscribe(s=>{for(let u of s){let d=u.source_file?.toString();d&&(this.sourceFileMap[d].metadata_columns.push(u),this.sourceFileMap[d].metadata_columns=[...this.sourceFileMap[d].metadata_columns],this.metadataFormMap[u.id]=this.fb.group({value:[u.value],name:[u.name],type:[u.type]}),this.metadataFormMap[u.id].valueChanges.subscribe(f=>{f.value&&this.updateValueField(u,f.value)}))}})})}updateMetadata(t){this.web.updateMetaDataColumn(t.id,void 0,void 0,t.value).subscribe(()=>{t.source_file&&(this.sourceFileMap[t.source_file].metadata_columns=this.sourceFileMap[t.source_file].metadata_columns.map(e=>e.id===t.id?t:e))})}markForDeleteOrUndo(t){let n=this.sourceFiles.map(s=>s.metadata_columns).flat().filter(s=>s.column_position===t.column_position);this.metadataFormMap[t.id].controls.value.disabled?(this.metadataFormMap[t.id].controls.value.enable(),this.markedForDeletion.includes(t)&&(this.markedForDeletion=this.markedForDeletion.filter(s=>s!==t))):(this.metadataFormMap[t.id].controls.value.disable(),this.markedForDeletion.includes(t)||this.markedForDeletion.push(t));for(let s of n)s!==t&&(this.markedForDeletion=this.markedForDeletion.filter(d=>d!==s),this.metadataFormMap[t.id].controls.value.disabled?this.metadataFormMap[s.id].controls.value.disable():this.metadataFormMap[s.id].controls.value.enable());this.sourceFileMetadataDeleted.emit(t)}drop(t,e){let n=t.previousIndex,a=t.currentIndex,s=t.item.data,u=[],d=e.metadata_columns[a].column_position;this.sourceFiles.forEach(f=>{if(Xe(f.metadata_columns,n,a),f.metadata_columns[a].column_position=d,u.push(f.metadata_columns[a]),a>n)for(let C=n;C<=a;C++)f.metadata_columns[C].column_position-=1,u.push(f.metadata_columns[C]);else for(let C=a+1;C<=n;C++)f.metadata_columns[C].column_position+=1,u.push(f.metadata_columns[C])}),this.reorderMetadataSourceFiles.emit(u)}exportSDRF(){let e=new ue(this.sourceFiles).convertToTSV(),n=new Blob([e],{type:"text/plain;charset=utf-8"}),a=window.URL.createObjectURL(n),s=document.createElement("a");s.href=a,s.download="analysis_group_metadata.tsv",document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(a)}static{this.\u0275fac=function(e){return new(e||i)(G(it),G(Xt),G(Z))}}static{this.\u0275cmp=j({type:i,selectors:[["app-analysis-group-general-metadata"]],inputs:{analysis_group_id:"analysis_group_id",metadata:"metadata",sourceFiles:"sourceFiles",canEdit:"canEdit"},outputs:{metadataChange:"metadataChange",metadataDeleted:"metadataDeleted",sourceFilesChanged:"sourceFilesChanged",sourceFileMetadataDeleted:"sourceFileMetadataDeleted",reorderMetadataSourceFiles:"reorderMetadataSourceFiles"},standalone:!0,features:[$],decls:26,vars:4,consts:[["metadataMenu","matMenu"],["autoMetadataValue","matAutocomplete"],["metadataMenuFileSpecific","matMenu"],["autoMetadataSourceFileValue","matAutocomplete"],[2,"display","flex","flex-direction","column","gap","20px"],[2,"display","flex","gap","20px"],["mat-flat-button","","type","button","color","primary",3,"disabled","matMenuTriggerFor"],["mat-flat-button","","type","button","color","primary",3,"click","disabled"],["mat-flat-button","","type","button","color","warn",3,"click"],["mat-menu-item","",3,"click"],["multi",""],[2,"display","flex","gap","20px",3,"formGroup"],[2,"flex-grow","1"],["matInput","","formControlName","value",3,"readonly","disabled","matAutocomplete"],[3,"value"],["mat-icon-button","","type","button",3,"disabled","matTooltip"],["mat-icon-button","","type","button",3,"click","disabled","matTooltip"],[2,"width","300px",3,"formGroup"],["type","button","mat-icon-button","",3,"disabled","matTooltip","matMenuTriggerFor"],["type","button","mat-icon-button","",3,"disabled","matTooltip"],["cdkDropList","",2,"display","flex","flex-direction","column","gap","20px",3,"cdkDropListDropped"],[2,"width","100%"],["matInput","","formControlName","name"],["matInput","","formControlName","description"],["type","button","mat-icon-button","",3,"click","disabled","matTooltip"],["cdkDrag","",3,"formGroup","cdkDragData"],["matInput","","formControlName","value",3,"matAutocomplete"],["type","button","mat-icon-button","","matSuffix","",3,"click"],["mat-icon-button","","cdkDragHandle",""]],template:function(e,n){if(e&1){let a=B();r(0,"div",4)(1,"h3"),c(2,"Metadata"),l(),r(3,"div",4),T(4,mo,1,1,null,null,de),l(),r(6,"div",5)(7,"button",6),c(8,"Add Metadata"),l(),r(9,"button",7),g("click",function(){return v(a),S(n.addSampleFile())}),c(10,"Add Sample File"),l(),r(11,"button",8),g("click",function(){return v(a),S(n.exportSDRF())}),c(12,"Export SDRF"),l()(),r(13,"mat-menu",null,0)(15,"button",9),g("click",function(){return v(a),S(n.createMetadata("disease"))}),c(16,"Disease"),l(),r(17,"button",9),g("click",function(){return v(a),S(n.createMetadata("tissue"))}),c(18,"Tissue"),l(),r(19,"button",9),g("click",function(){return v(a),S(n.createMetadata("subcellular location"))}),c(20,"Subcellular location"),l(),r(21,"button",9),g("click",function(){return v(a),S(n.createMetadata("organism"))}),c(22,"Organism"),l(),r(23,"button",9),g("click",function(){return v(a),S(n.createMetadata())}),c(24,"Create custom metadata field"),l()(),E(25,wo,3,0,"mat-accordion",10),l()}if(e&2){let a=lt(14);m(4),I(n.metadata),m(3),y("disabled",!n.canEdit)("matMenuTriggerFor",a),m(2),y("disabled",!n.canEdit),m(16),D(n.sourceFiles.length>0?25:-1)}},dependencies:[X,wt,vt,Et,K,at,W,q,rt,et,tt,Yt,ne,st,oe,Ge,ze,Ke,Ye,ie,Jt,ee,te,Zt,Me,z,Q,J,Fe,Je,Qe,We]})}}return i})();var vo=["generalMetadata"];function So(i,o){if(i&1){let t=B();r(0,"div",1)(1,"app-volcano-plot",4),g("selected",function(n){v(t);let a=h();return S(a.handleVolcanoSelection(n))}),l()()}if(i&2){let t=h();m(),y("curtainData",t.curtainData)}}function Mo(i,o){if(i&1&&(r(0,"p")(1,"b"),c(2,"Associated Project: "),l(),r(3,"a",19),c(4),l()()),i&2){let t=h(2);m(3),we("href","/#/project/",t.analysisGroup.project,"",_e),m(),L(t.associatedProject.name)}}function Fo(i,o){if(i&1&&(r(0,"p")(1,"b"),c(2,"Curtain Link: "),l(),r(3,"a",19),c(4),l()()),i&2){let t=h(2);m(3),Ot("href",t.analysisGroup.curtain_link,_e),m(),L(t.analysisGroup.curtain_link)}}function Do(i,o){if(i&1){let t=B();V(0,"mat-divider"),r(1,"app-analysis-group-general-metadata",20,0),g("reorderMetadataSourceFiles",function(n){v(t);let a=h(2);return S(a.reorderMetadataColumn(n))})("sourceFilesChanged",function(n){v(t);let a=h(2);return S(a.analysisGroup.source_files=n)})("metadataDeleted",function(n){v(t);let a=h(2);return S(a.updateDeletionList(n))})("sourceFileMetadataDeleted",function(n){v(t);let a=h(2);return S(a.updateDeletionListSourceFile(n))}),l()}if(i&2){let t=h(2);m(),y("sourceFiles",t.analysisGroup.source_files)("canEdit",t.canEdit)("analysis_group_id",t.analysisGroup.id)("metadata",t.analysisGroup.metadata_columns)}}function Ao(i,o){if(i&1&&(r(0,"p"),c(1),l(),V(2,"mat-progress-bar",21)),i&2){let t=h(2);m(),L(t.composingCurtainProgress.message),m(),y("value",t.composingCurtainProgress.progress)("mode","determinate")("color","primary")}}function Eo(i,o){if(i&1){let t=B();r(0,"button",22),g("click",function(){v(t);let n=h(2);return S(n.composeDataFromCurtain())}),c(1,"Use Curtain Link For Data"),l()}if(i&2){let t=h(2);y("disabled",!t.canEdit)}}function Go(i,o){if(i&1&&c(0),i&2){let t=h(2);H(": ",t.analysisGroupDF.name,"")}}function To(i,o){if(i&1){let t=B();r(0,"app-upload-file",23),g("fileUploaded",function(n){v(t);let a=h(2);return S(a.handleFileUploaded(n,"df"))}),l()}if(i&2){let t=h(2);y("analysisGroupId",t.analysisGroup.id)("fileCategory","df")}}function Io(i,o){if(i&1){let t=B();r(0,"button",24),g("click",function(){v(t);let n=h(3);return S(n.deleteFile(n.analysisGroupDF))}),r(1,"mat-icon"),c(2,"delete"),l()(),r(3,"button",25),g("click",function(){v(t);let n=h(3);return S(n.openExtraDataModal(n.analysisGroupDF))}),c(4,"Extra Data"),l()}if(i&2){let t=h(3);m(3),y("disabled",!t.accounts.loggedIn)}}function ko(i,o){if(i&1){let t=B();r(0,"button",24),g("click",function(){v(t);let n=h(2);return S(n.downloadFile(n.analysisGroupDF))}),r(1,"mat-icon"),c(2,"download"),l()(),E(3,Io,5,1)}if(i&2){let t=h(2);m(3),D(t.canEdit?3:-1)}}function Vo(i,o){if(i&1&&c(0),i&2){let t=h(2);H(": ",t.analysisGroupSearched.name,"")}}function No(i,o){if(i&1){let t=B();r(0,"app-upload-file",23),g("fileUploaded",function(n){v(t);let a=h(2);return S(a.handleFileUploaded(n,"searched"))}),l()}if(i&2){let t=h(2);y("analysisGroupId",t.analysisGroup.id)("fileCategory","searched")}}function Lo(i,o){if(i&1){let t=B();r(0,"button",24),g("click",function(){v(t);let n=h(3);return S(n.deleteFile(n.analysisGroupSearched))}),r(1,"mat-icon"),c(2,"delete"),l()(),r(3,"button",25),g("click",function(){v(t);let n=h(3);return S(n.openExtraDataModal(n.analysisGroupSearched))}),c(4,"Extra Data"),l()}if(i&2){let t=h(3);m(3),y("disabled",!t.accounts.loggedIn)}}function Po(i,o){if(i&1){let t=B();r(0,"button",24),g("click",function(){v(t);let n=h(2);return S(n.downloadFile(n.analysisGroupSearched))}),r(1,"mat-icon"),c(2,"download"),l()(),E(3,Lo,5,1)}if(i&2){let t=h(2);m(3),D(t.canEdit?3:-1)}}function Ro(i,o){if(i&1&&c(0),i&2){let t=h(2);H(": ",t.analysisGroupCopyNumber.name,"")}}function Bo(i,o){if(i&1){let t=B();r(0,"app-upload-file",23),g("fileUploaded",function(n){v(t);let a=h(2);return S(a.handleFileUploaded(n,"copy_number"))}),l()}if(i&2){let t=h(2);y("analysisGroupId",t.analysisGroup.id)("fileCategory","copy_number")}}function Uo(i,o){if(i&1){let t=B();r(0,"button",24),g("click",function(){v(t);let n=h(3);return S(n.deleteFile(n.analysisGroupCopyNumber))}),r(1,"mat-icon"),c(2,"delete"),l()(),r(3,"button",25),g("click",function(){v(t);let n=h(3);return S(n.openExtraDataModal(n.analysisGroupCopyNumber))}),c(4,"Extra Data"),l()}if(i&2){let t=h(3);m(3),y("disabled",!t.canEdit)}}function jo(i,o){if(i&1){let t=B();r(0,"button",24),g("click",function(){v(t);let n=h(2);return S(n.downloadFile(n.analysisGroupCopyNumber))}),r(1,"mat-icon"),c(2,"download"),l()(),E(3,Uo,5,1)}if(i&2){let t=h(2);m(3),D(t.canEdit?3:-1)}}function Ho(i,o){if(i&1&&c(0),i&2){let t=h(3);H("(",t.sampleAnnotations.annotations.length,")")}}function $o(i,o){if(i&1){let t=B();r(0,"button",25),g("click",function(){v(t);let n=h(2);return S(n.setAnnotationModal(n.analysisGroupSearched))}),c(1,"Plot Sample Annotation "),E(2,Ho,1,1),l()}if(i&2){let t=h(2);y("disabled",!t.canEdit),m(2),D(t.sampleAnnotations?2:-1)}}function Oo(i,o){if(i&1&&c(0),i&2){let t=h(3);H("(",t.comparisonMatrix.matrix.length,")")}}function qo(i,o){if(i&1){let t=B();r(0,"button",25),g("click",function(){v(t);let n=h(2);return S(n.setComparisonMatrixModal(n.sampleAnnotations,n.analysisGroupSearched,n.analysisGroupDF))}),c(1,"Comparison Matrix "),E(2,Oo,1,1),l()}if(i&2){let t=h(2);y("disabled",!t.canEdit),m(2),D(t.comparisonMatrix?2:-1)}}function Ko(i,o){if(i&1){let t=B();E(0,Mo,5,3,"p")(1,Fo,5,2,"p"),r(2,"form",5),g("ngSubmit",function(){v(t);let n=h();return S(n.updateAnalysisGroup())}),r(3,"mat-form-field",3),V(4,"input",6),r(5,"mat-label"),c(6,"Analysis Group Name"),l()(),r(7,"mat-form-field",3),V(8,"textarea",7),r(9,"mat-label"),c(10,"Analysis Group Description"),l()(),E(11,Do,3,4),V(12,"mat-divider"),r(13,"div",8)(14,"mat-form-field",3),V(15,"input",9),r(16,"mat-label"),c(17,"Curtain Link"),l()(),r(18,"button",10),g("click",function(){v(t);let n=h();return S(n.refreshCurtainLink())}),r(19,"mat-icon"),c(20,"refresh"),l()()(),E(21,Ao,3,4),r(22,"div",8)(23,"button",11),c(24,"Update Analysis Group"),l(),E(25,Eo,2,1,"button",12),l()(),r(26,"div",13)(27,"div")(28,"p"),c(29,"Differential Analysis File "),E(30,Go,1,1),l()(),E(31,To,1,2,"app-upload-file",14)(32,ko,4,1),l(),r(33,"div",13)(34,"div")(35,"p"),c(36,"Searched File "),E(37,Vo,1,1),l()(),E(38,No,1,2,"app-upload-file",14)(39,Po,4,1),l(),r(40,"div",13)(41,"div")(42,"p"),c(43,"Copy Number File "),E(44,Ro,1,1),l()(),E(45,Bo,1,2,"app-upload-file",14)(46,jo,4,1),l(),r(47,"div",15),E(48,$o,3,2,"button",16)(49,qo,3,2,"button",16),r(50,"button",17),g("click",function(){v(t);let n=h();return S(n.openSearchModal())}),r(51,"mat-icon"),c(52,"search"),l()(),r(53,"button",18),g("click",function(){v(t);let n=h();return S(n.deleteAnalysisGroup())}),r(54,"mat-icon"),c(55,"delete"),l()()()}if(i&2){let t=h();D(t.associatedProject?0:-1),m(),D(t.analysisGroup.curtain_link?1:-1),m(),y("formGroup",t.form),m(2),y("readonly",!t.canEdit),m(4),y("readonly",!t.canEdit),m(3),D(t.analysisGroup?11:-1),m(4),y("readonly",!t.canEdit),m(3),y("disabled",!t.canEdit),m(3),D(t.composingCurtainProgress.started?21:-1),m(2),y("disabled",!t.canEdit),m(2),D(t.analysisGroup.curtain_link?25:-1),m(5),D(t.analysisGroupDF?30:-1),m(),D(t.canEdit?31:-1),m(),D(t.analysisGroupDF?32:-1),m(5),D(t.analysisGroupSearched?37:-1),m(),D(t.canEdit?38:-1),m(),D(t.analysisGroupSearched?39:-1),m(5),D(t.analysisGroupCopyNumber?44:-1),m(),D(t.canEdit?45:-1),m(),D(t.analysisGroupCopyNumber?46:-1),m(2),D(t.analysisGroupSearched?48:-1),m(),D(t.sampleAnnotations&&t.analysisGroupSearched&&t.analysisGroupDF?49:-1),m(4),y("disabled",!t.canEdit)}}var sl=(()=>{class i{set analysisGroup(t){this._analysisGroup=t,t&&this.accounts.getAnalysisGroupPermissions(t.id).subscribe(e=>{this.canEdit=e.edit}),this.curtainData=void 0,t&&(t.curtain_link&&this.getCurtainData(),this.dataService.analysisGroupChoices.forEach(e=>{e.value===t.analysis_group_type&&(this.analysisType=e.label)}),this.titleService.setTitle(`AG - ${t.name}`),this.web.getProject(t.project).subscribe(e=>{this.associatedProject=e}),this.form.controls.name.setValue(t.name),this.form.controls.description.setValue(t.description),this.form.controls.curtain_link.setValue(t.curtain_link),this.getFiles(t))}getFiles(t){this.web.getAnalysisGroupFiles(t.id).subscribe(e=>{this.analysisGroupDF=e.find(n=>n.file_category==="df"),this.analysisGroupSearched=e.find(n=>n.file_category==="searched"),this.analysisGroupSearched&&this.web.getProjectFileSampleAnnotations(this.analysisGroupSearched.id).subscribe(n=>{this.sampleAnnotations=n}),this.analysisGroupDF&&this.web.getProjectFileComparisonMatrix(this.analysisGroupDF.id).subscribe(n=>{this.comparisonMatrix=n})})}get analysisGroup(){return this._analysisGroup}constructor(t,e,n,a,s,u,d,f){this.sb=t,this.dataService=e,this.titleService=n,this.fb=a,this.web=s,this.matDialog=u,this.accounts=d,this.ws=f,this.analysisType="proteomics",this.reorderMetadataColumnSourceFile=[],this.canEdit=!1,this.composingCurtainProgress={progress:0,message:"",completed:!1,error:!1,started:!1},this.deleted=new ot,this.updated=new ot,this.form=this.fb.group({name:new A({value:"",disabled:!1},{validators:[P.required]}),description:new A({value:"",disabled:!1},{validators:[P.required]}),curtain_link:new A({value:"",disabled:!1})}),this.metadataDeletionList=[],this.ws.curtainWSConnection?.subscribe(C=>{if(C.analysis_group_id===this.analysisGroup?.id){if(C.type==="curtain_status")switch(C.status){case"started":this.sb.open("Curtain link retrieval started","Dismiss",{duration:5e3});break;case"complete":this.sb.open("Curtain link retrieval complete","Dismiss",{duration:5e3}),this.getCurtainData();break}else if(C.type==="curtain_compose_status")switch(C.status){case"started":this.sb.open("Composing data from Curtain started","Dismiss",{duration:5e3}),this.composingCurtainProgress.progress=30,this.composingCurtainProgress.message="Removed analysis group associated data if exist";break;case"complete":this.sb.open("Composing data from Curtain completed. Please manually set Condition A and Condition B in Comparison Matrix.","Dismiss"),this.composingCurtainProgress.progress=100,this.composingCurtainProgress.message="Composing data from Curtain completed. Please manually set Condition A and Condition B in Comparison Matrix.",this.composingCurtainProgress.completed=!0,this.web.getAnalysisGroup(this.analysisGroup.id).subscribe(_=>{this.analysisGroup=_});break;case"error":this.sb.open("Error composing data from Curtain","Dismiss",{duration:5e3}),this.composingCurtainProgress.error=!0;break}}})}updateAnalysisGroup(){return kt(this,null,function*(){if(this.form.invalid)return;if(this.metadataDeletionList.length>0){for(let e of this.metadataDeletionList)if(yield this.web.deleteMetaDataColumn(e.id).toPromise(),this.sb.open(`Metadata column ${e.name} deleted`,"Dismiss",{duration:5e3}),e.source_file&&this.generalMetadata&&this.generalMetadata.sourceFiles.map(a=>a.metadata_columns).flat().filter(a=>a.column_position===e.column_position).length===1){let a=this.generalMetadata.sourceFiles.find(s=>s.id===e.source_file);a&&(a.metadata_columns=a.metadata_columns.filter(s=>s.column_position!==e.column_position))}}if(this.generalMetadata)for(let e in this.generalMetadata.metadataFormMap)this.generalMetadata.metadataFormMap[e].dirty&&(yield this.web.updateMetaDataColumn(parseInt(e),void 0,void 0,this.generalMetadata.metadataFormMap[e].value.value).toPromise(),this.generalMetadata.metadataFormMap[e].markAsPristine(),this.sb.open(`Metadata column ${this.generalMetadata.metadataFormMap[e].value.name} updated`,"Dismiss",{duration:5e3}));let t=yield this.web.updateAnalysisGroup(this.analysisGroup.id,this.form.value.name,this.form.value.description,this.form.value.curtain_link,this.web.searchSessionID).toPromise();this.metadataDeletionList=[],this.updated.emit(t)})}getCurtainData(){this.analysisGroup&&(this.sb.open("Retrieving curtain visualization","Dismiss",{duration:5e3}),this.web.getCurtainLinkData(this.analysisGroup.id).subscribe(t=>{this.curtainData=t,this.sb.open("Curtain visualization retrieved","Dismiss",{duration:5e3})},t=>{this.sb.open("Error retrieving curtain visualization","Dismiss",{duration:5e3}),this.curtainData=void 0}))}handleFileUploaded(t,e){e==="searched"?(this.analysisGroupSearched=t,this.web.getProjectFileSampleAnnotations(t.id).subscribe(n=>{this.sampleAnnotations=n}),this.sb.open("Searched File uploaded","Dismiss",{duration:5e3})):e==="df"?(this.analysisGroupDF=t,this.web.getProjectFileComparisonMatrix(this.analysisGroupDF.id).subscribe(n=>{this.comparisonMatrix=n}),this.sb.open("Differential Analysis File uploaded","Dismiss",{duration:5e3})):e==="copy_number"&&(this.analysisGroupCopyNumber=t,this.sb.open("Copy Number Analysis File uploaded","Dismiss",{duration:5e3}))}setAnnotationModal(t){let e=this.matDialog.open(gi);e.componentInstance.projectFile=t,this.sampleAnnotations&&(e.componentInstance.annotation=this.sampleAnnotations),e.afterClosed().subscribe(n=>{n&&(console.log(this.sampleAnnotations),this.sampleAnnotations?this.web.updateSampleAnnotation(this.sampleAnnotations.id,this.sampleAnnotations.name,n).subscribe(a=>{this.sampleAnnotations=a,this.sb.open("Sample annotation updated","Dismiss",{duration:5e3})}):this.web.createSampleAnnotation(this.analysisGroup.id,this.analysisGroup?.name+" sample annotation",n,this.analysisGroupSearched.id).subscribe(a=>{this.sampleAnnotations=a,this.sb.open("Sample annotation created","Dismiss",{duration:5e3})}))})}setComparisonMatrixModal(t,e,n){let a=this.matDialog.open(bi);a.componentInstance.sampleAnnotations=t,a.componentInstance.projectFile=n,this.comparisonMatrix&&(a.componentInstance.comparisonMatrix=this.comparisonMatrix),a.afterClosed().subscribe(s=>{s&&(this.comparisonMatrix?this.web.updateComparisonMatrix(this.comparisonMatrix.id,this.comparisonMatrix.name,s).subscribe(u=>{this.comparisonMatrix=u,this.sb.open("Comparison matrix updated","Dismiss",{duration:5e3})}):this.web.createComparisonMatrix(this.analysisGroup.id,this.analysisGroup?.name+" comparison matrix",s,n.id).subscribe(u=>{this.comparisonMatrix=u,this.sb.open("Comparison matrix created","Dismiss",{duration:5e3})}))})}deleteAnalysisGroup(){this.matDialog.open(Rt).afterClosed().subscribe(t=>{t&&this.web.deleteAnalysisGroup(this.analysisGroup.id).subscribe(()=>{this.deleted.emit(!0),this.sb.open("Analysis Group deleted","Dismiss",{duration:5e3})})})}openSearchModal(){let t=this.matDialog.open(wi);t.componentInstance.analysisGroupIDs=[this.analysisGroup.id],t.afterClosed().subscribe(e=>{e&&window.open(`/#/search-session/${e}`,"_blank")})}openExtraDataModal(t){let e=this.matDialog.open(vi);e.componentInstance.analysisGroupType=this.analysisGroup?.analysis_group_type,e.componentInstance.file=t,e.afterClosed().subscribe(n=>{n&&this.web.updateProjectFileExtraData(t.id,n.extra_data).subscribe(a=>{t.file_category==="df"?(this.analysisGroupDF=a,this.sb.open("Differential Analysis extra data updated","Dismiss",{duration:5e3})):t.file_category==="searched"?(this.analysisGroupSearched=a,this.sb.open("Searched extra data updated","Dismiss",{duration:5e3})):t.file_category==="copy_number"&&(this.analysisGroupCopyNumber=a,this.sb.open("Copy Number extra data updated","Dismiss",{duration:5e3}))})})}refreshCurtainLink(){this.analysisGroup&&this.web.searchSessionID&&this.web.refreshCurtainLink(this.analysisGroup.id,this.web.searchSessionID).subscribe(t=>{this.analysisGroup=t,this.sb.open("Curtain data content refreshed","Dismiss",{duration:5e3})})}handleVolcanoSelection(t){console.log(t)}composeDataFromCurtain(){this.composingCurtainProgress={progress:0,message:"",completed:!1,error:!1},this.analysisGroup&&this.web.searchSessionID&&(this.composingCurtainProgress.started=!0,this.web.composeAnalysisGroupFilesFromCurtainData(this.analysisGroup.id,this.web.searchSessionID).subscribe(t=>{this.composingCurtainProgress.progress=10,this.composingCurtainProgress.message="Data composition started",this.sb.open("Data composition started","Dismiss",{duration:5e3})}))}deleteFile(t){this.matDialog.open(Rt).afterClosed().subscribe(e=>{e&&this.web.deleteProjectFile(t.id).subscribe(()=>{t.file_category==="df"?(this.analysisGroupDF=void 0,this.sb.open("Differential Analysis File deleted","Dismiss",{duration:5e3})):t.file_category==="searched"?(this.analysisGroupSearched=void 0,this.sb.open("Searched File deleted","Dismiss",{duration:5e3})):t.file_category==="copy_number"&&(this.analysisGroupCopyNumber=void 0,this.sb.open("Copy Number Analysis File deleted","Dismiss",{duration:5e3}))})})}downloadFile(t){this.web.getFileDownloadToken(t.id).subscribe(e=>{window.open(`${this.web.baseURL}/api/project_files/download/?token=${e.token}`)})}updateDeletionList(t){this.metadataDeletionList.includes(t)?this.metadataDeletionList=this.metadataDeletionList.filter(e=>e!==t):this.metadataDeletionList.push(t)}updateDeletionListSourceFile(t){if(this.generalMetadata){let n=(this.generalMetadata?.sourceFiles.map(a=>a.metadata_columns).flat()).filter(a=>a.column_position===t.column_position);if(this.metadataDeletionList.includes(t))this.metadataDeletionList=this.metadataDeletionList.filter(a=>a.id!==t.id);else{this.metadataDeletionList.push(t);for(let a of n)a!==t&&(this.metadataDeletionList=this.metadataDeletionList.filter(s=>s.id!==a.id))}}console.log(this.metadataDeletionList)}reorderMetadataColumn(t){this.analysisGroup&&this.web.reorganizeColumns(t,this.analysisGroup.id).subscribe(e=>{this.sb.open("Metadata columns reordered","Dismiss",{duration:5e3})})}static{this.\u0275fac=function(e){return new(e||i)(G(ae),G(Qt),G(ve),G(Z),G(it),G(Xt),G(re),G(le))}}static{this.\u0275cmp=j({type:i,selectors:[["app-analysis-group-view"]],viewQuery:function(e,n){if(e&1&&qt(vo,5),e&2){let a;Kt(a=zt())&&(n.generalMetadata=a.first)}},inputs:{analysisGroup:"analysisGroup"},outputs:{deleted:"deleted",updated:"updated"},standalone:!0,features:[$],decls:4,vars:2,consts:[["generalMetadata",""],[2,"display","flex","flex-direction","row","justify-content","center","flex-wrap","wrap"],[2,"display","flex","flex-direction","row","justify-content","center","padding","50px"],[2,"width","100%"],[3,"selected","curtainData"],[2,"display","flex","flex-direction","column","gap","20px","padding","20px",3,"ngSubmit","formGroup"],["matInput","","formControlName","name","type","text","placeholder","Analysis Group Name",3,"readonly"],["matInput","","formControlName","description","placeholder","Analysis Group Description",3,"readonly"],[2,"display","flex","flex-direction","row","gap","10px"],["matInput","","formControlName","curtain_link","type","text","placeholder","Curtain Link",3,"readonly"],["mat-icon-button","","type","button",3,"click","disabled"],["mat-flat-button","","color","primary","type","submit",3,"disabled"],["mat-flat-button","","color","primary","type","button",3,"disabled"],[2,"display","flex","flex-direction","row","gap","20px","align-items","center"],[3,"analysisGroupId","fileCategory"],[2,"display","flex","flex-direction","row","gap","20px","padding","20px"],["mat-flat-button","","color","primary",3,"disabled"],["mat-icon-button","","color","accent",3,"click"],["mat-icon-button","",3,"click","disabled"],["target","_blank",3,"href"],[3,"reorderMetadataSourceFiles","sourceFilesChanged","metadataDeleted","sourceFileMetadataDeleted","sourceFiles","canEdit","analysis_group_id","metadata"],[3,"value","mode","color"],["mat-flat-button","","color","primary","type","button",3,"click","disabled"],[3,"fileUploaded","analysisGroupId","fileCategory"],["mat-icon-button","",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"]],template:function(e,n){e&1&&(E(0,So,2,1,"div",1),r(1,"div",2)(2,"div",3),E(3,Ko,56,23),l()()),e&2&&(D(n.curtainData?0:-1),m(3),D(n.analysisGroup?3:-1))},dependencies:[Et,K,at,W,q,X,et,wt,rt,tt,z,Q,J,xi,vt,Si,se,Fi,Wt]})}}return i})();export{Zo as a,sl as b};
